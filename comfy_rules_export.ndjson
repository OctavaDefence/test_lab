{"id":"61624960-281c-11ed-b3cc-e55402ad270e","updated_at":"2023-03-29T14:10:06.368Z","updated_by":"elastic","created_at":"2022-08-30T04:29:47.887Z","created_by":"elastic","name":"Elastic Agent offline OLD","tags":["Octava"],"interval":"5m","enabled":false,"revision":9,"description":"The Elastuc Agent connected more than an hour ago","risk_score":21,"severity":"low","license":"","output_index":"","meta":{"from":"48h","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"author":["Octava"],"false_positives":[],"from":"now-173100s","rule_id":"5d8af1b3-7445-49e4-9b47-a7f579df1024","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1489","name":"Service Stop","subtechnique":[],"id":"T1489"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0040","name":"Impact","id":"TA0040"}}],"to":"now","references":[],"version":9,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","data_view_id":".fleet-agents","query":"last_checkin<now-1h","filters":[],"actions":[]}
{"id":"7005c240-5b6a-11ed-af7b-4b4586cb86d2","updated_at":"2023-03-31T07:56:24.291Z","updated_by":"elastic","created_at":"2022-11-03T11:27:02.825Z","created_by":"elastic","name":"Unauthorized access to restricted network share files","tags":[],"interval":"5m","enabled":false,"revision":4,"description":"Unauthorized access to restricted network share files\nЗафіксовано нелегітимний доступ користувача \"winlog.event_data.SubjectUserName\" до обмеженої у доступі мережевої директорії \"winlog.event_data.ObjectName\".","risk_score":47,"severity":"medium","license":"","output_index":"","meta":{"from":"1m","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":[],"false_positives":[],"from":"now-360s","rule_id":"0eff64da-b54c-4b25-bff5-a50e02bbad4a","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[],"to":"now","references":[],"version":4,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"event.code:4663 AND winlog.event_data.ObjectName:(*\\\\DFS\\\\\\!Reporting\\\\Payment_changes* OR *\\\\DFS\\\\HR\\\\Comp\\&ben\\\\*)","filters":[],"threshold":{"field":["winlog.event_data.SubjectUserName"],"value":1,"cardinality":[]},"actions":[]}
{"id":"88694200-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-16T12:59:29.358Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.297Z","created_by":"elastic","name":"External Alerts [Duplicate]","tags":["Elastic","Network","Windows","APM","macOS","Linux"],"interval":"5m","enabled":false,"revision":100,"description":"Generates a detection alert for each external alert written to the configured indices. Enabling this rule allows you to immediately begin investigating external alerts in the app.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":".siem-signals-default","rule_name_override":"message","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-6m","rule_id":"4d90c8bb-0a1d-4935-a7e0-f4d753119910","max_signals":10000,"risk_score_mapping":[{"field":"event.risk_score","value":"","operator":"equals"}],"severity_mapping":[{"severity":"low","field":"event.severity","value":"21","operator":"equals"},{"severity":"medium","field":"event.severity","value":"47","operator":"equals"},{"severity":"high","field":"event.severity","value":"73","operator":"equals"},{"severity":"critical","field":"event.severity","value":"99","operator":"equals"}],"threat":[],"to":"now","references":[],"version":100,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["apm-*-transaction*","traces-apm*","auditbeat-*","filebeat-*","logs-*","packetbeat-*","winlogbeat-*"],"query":"event.kind:alert and not event.module:(endgame or endpoint)\n","actions":[]}
{"id":"d4846dd0-2ad6-11ed-a8e8-c984bd92df8f","updated_at":"2023-03-16T08:53:49.135Z","updated_by":"elastic","created_at":"2022-09-02T15:49:29.520Z","created_by":"elastic","name":"Fortigate IPS Internal Detection to External Direction","tags":["Octava"],"interval":"5m","enabled":false,"revision":8,"description":"Fortigate IPS detection where source IP address from private networks (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/24) to public networks","risk_score":21,"severity":"low","license":"","output_index":"","timeline_id":"300afc76-072d-4261-864d-4149714bf3f1","timeline_title":"Comprehensive Network Timeline","meta":{"from":"3m","kibana_siem_app_url":"https://192.168.101.14:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava"],"false_positives":[],"from":"now-480s","rule_id":"d48b5c13-5745-4ba5-a704-15296bfe115e","max_signals":100,"risk_score_mapping":[],"severity_mapping":[{"severity":"low","field":"fortinet.firewall.severity","value":"low","operator":"equals"},{"severity":"medium","field":"fortinet.firewall.severity","value":"medium","operator":"equals"},{"severity":"high","field":"fortinet.firewall.severity","value":"high","operator":"equals"},{"severity":"critical","field":"fortinet.firewall.severity","value":"critical","operator":"equals"}],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1203","name":"Exploitation for Client Execution","subtechnique":[],"id":"T1203"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002","name":"Execution","id":"TA0002"}}],"to":"now","references":[],"version":8,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"fortinet.firewall.subtype:\"ips\" and source.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and not fortinet.firewall.severity:\"low\" and not destination.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16)","filters":[],"actions":[]}
{"id":"72338e30-2ad7-11ed-a8e8-c984bd92df8f","updated_at":"2023-03-17T07:15:53.895Z","updated_by":"elastic","created_at":"2022-09-02T15:53:54.069Z","created_by":"elastic","name":"Fortigate Virus Internal Detection to External Direction","tags":["Octava"],"interval":"5m","enabled":false,"revision":4,"description":"Fortigate Virus detection where source IP address from private networks (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/24) to public networks","risk_score":21,"severity":"low","license":"","output_index":"","timeline_id":"300afc76-072d-4261-864d-4149714bf3f1","timeline_title":"Comprehensive Network Timeline","meta":{"from":"3m","kibana_siem_app_url":"https://192.168.101.14:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava"],"false_positives":[],"from":"now-480s","rule_id":"023e9394-6252-4b2f-8560-5abbbfd29a63","max_signals":100,"risk_score_mapping":[],"severity_mapping":[{"severity":"low","field":"fortinet.firewall.crlevel","value":"low","operator":"equals"},{"severity":"medium","field":"fortinet.firewall.crlevel","value":"medium","operator":"equals"},{"severity":"high","field":"fortinet.firewall.crlevel","value":"high","operator":"equals"},{"severity":"critical","field":"fortinet.firewall.crlevel","value":"critical","operator":"equals"}],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1203","name":"Exploitation for Client Execution","subtechnique":[],"id":"T1203"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002","name":"Execution","id":"TA0002"}}],"to":"now","references":[],"version":4,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"fortinet.firewall.subtype:\"virus\" and source.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and not destination.ip:(10.0.0.0/8 or 172.16.0.0/12 or 192.168.0.0/16) and fortinet.firewall.crlevel:*","filters":[],"actions":[]}
{"id":"c49bd550-152e-11ee-ad8e-610914274334","updated_at":"2023-06-27T21:08:30.683Z","updated_by":"elastic","created_at":"2023-06-27T21:08:30.683Z","created_by":"elastic","name":"First Time Seen AWS Secret Value Accessed in Secrets Manager","tags":["Elastic","Cloud","AWS","Amazon Web Services","Continuous Monitoring","SecOps","Data Protection","Credential Access","Investigation Guide"],"interval":"10m","enabled":false,"revision":0,"description":"An adversary equipped with compromised credentials may attempt to access the secrets in secrets manager to steal certificates, credentials, or other sensitive material.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n\n### Investigating First Time Seen AWS Secret Value Accessed in Secrets Manager\n\nAWS Secrets Manager is a service that enables the replacement of hardcoded credentials in code, including passwords, with an API call to Secrets Manager to retrieve the secret programmatically.\n\nThis rule looks for the retrieval of credentials using `GetSecretValue` action in Secrets Manager programmatically. This is a [New Terms](https://www.elastic.co/guide/en/security/master/rules-ui-create.html#create-new-terms-rule) rule indicating this is the first time a specific user identity has successfuly retrieved a secret value from Secrets Manager.\n\n#### Possible investigation steps\n\n- Identify the account and its role in the environment, and inspect the related policy.\n- Identify the applications that should use this account.\n- Investigate other alerts associated with the user account during the past 48 hours.\n- Investigate abnormal values in the `user_agent.original` field by comparing them with the intended and authorized usage and historical data. Suspicious user agent values include non-SDK, AWS CLI, custom user agents, etc.\n- Assess whether this behavior is prevalent in the environment by looking for similar occurrences involving other users.\n- Contact the account owner and confirm whether they are aware of this activity.\n- Considering the source IP address and geolocation of the user who issued the command:\n    - Do they look normal for the calling user?\n    - If the source is an EC2 IP address, is it associated with an EC2 instance in one of your accounts or is the source IP from an EC2 instance that's not under your control?\n    - If it is an authorized EC2 instance, is the activity associated with normal behavior for the instance role or roles? Are there any other alerts or signs of suspicious activity involving this instance?\n- Review IAM permission policies for the user identity and specific secrets accessed.\n- Examine the request parameters. These might indicate the source of the program or the nature of its tasks.\n- If you suspect the account has been compromised, scope potentially compromised assets by tracking servers, services, and data accessed by the account in the last 24 hours.\n\n### False positive analysis\n\n- False positives may occur due to the intended usage of the service. Tuning is needed in order to have higher confidence. Consider adding exceptions — preferably with a combination of user agent and IP address conditions.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Disable or limit the account during the investigation and response.\n- Identify the possible impact of the incident and prioritize accordingly; the following actions can help you gain context:\n    - Identify the account role in the cloud environment.\n    - Assess the criticality of affected services and servers.\n    - Work with your IT team to identify and minimize the impact on users.\n    - Identify if the attacker is moving laterally and compromising other accounts, servers, or services.\n    - Identify any regulatory or legal ramifications related to this activity.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Rotate secrets or delete API keys as needed to revoke the attacker's access to the environment. Work with your IT teams to minimize the impact on business operations during these actions.\n- Check if unauthorized new users were created, remove unauthorized new accounts, and request password resets for other IAM users.\n- Consider enabling multi-factor authentication for users.\n- Review the permissions assigned to the implicated user to ensure that the least privilege principle is being followed.\n- Implement security best practices [outlined](https://aws.amazon.com/premiumsupport/knowledge-center/security-best-practices/) by AWS.\n- Take the actions needed to return affected systems, data, or services to their normal operational levels.\n- Identify the initial vector abused by the attacker and take action to prevent reinfection via the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).","license":"Elastic License v2","output_index":"","timestamp_override":"event.ingested","author":["Nick Jones","Elastic"],"false_positives":["Verify whether the user identity, user agent, and/or hostname should be using GetSecretString API for the specified SecretId. If known behavior is causing false positives, it can be exempted from the rule."],"from":"now-60m","rule_id":"a00681e3-9ed6-447c-ab2c-be648821c622","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","name":"Credential Access","reference":"https://attack.mitre.org/tactics/TA0006/"},"technique":[{"id":"T1528","name":"Steal Application Access Token","reference":"https://attack.mitre.org/techniques/T1528/"}]}],"to":"now","references":["https://docs.aws.amazon.com/secretsmanager/latest/apireference/API_GetSecretValue.html","http://detectioninthe.cloud/credential_access/access_secret_in_secrets_manager/"],"version":205,"exceptions_list":[],"immutable":false,"related_integrations":[{"integration":"cloudtrail","package":"aws","version":"^1.5.0"}],"required_fields":[{"ecs":true,"name":"event.action","type":"keyword"},{"ecs":true,"name":"event.dataset","type":"keyword"},{"ecs":true,"name":"event.outcome","type":"keyword"},{"ecs":true,"name":"event.provider","type":"keyword"},{"ecs":true,"name":"user_agent.name","type":"keyword"}],"setup":"The AWS Fleet integration, Filebeat module, or similarly structured data is required to be compatible with this rule.","type":"new_terms","query":"event.dataset:aws.cloudtrail and event.provider:secretsmanager.amazonaws.com and\n    event.action:GetSecretValue and event.outcome:success and\n    not user_agent.name: (\"Chrome\" or \"Firefox\" or \"Safari\" or \"Edge\" or \"Brave\" or \"Opera\" or \"aws-cli\")\n","new_terms_fields":["aws.cloudtrail.user_identity.access_key_id","aws.cloudtrail.request_parameters"],"history_window_start":"now-15d","index":["filebeat-*","logs-aws*"],"language":"kuery","actions":[]}
{"id":"c82a7a50-152e-11ee-ad8e-610914274334","updated_at":"2023-06-27T21:08:36.610Z","updated_by":"elastic","created_at":"2023-06-27T21:08:36.610Z","created_by":"elastic","name":"Interactive Terminal Spawned via Python","tags":["Elastic","Host","Linux","Threat Detection","Execution","Elastic Endgame"],"interval":"5m","enabled":false,"revision":0,"description":"Identifies when a terminal (tty) is spawned via Python. Attackers may upgrade a simple reverse shell to a fully interactive tty after obtaining initial access to a host.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":"","timeline_id":"e70679c2-6cde-4510-9764-4823df18f7db","timeline_title":"Comprehensive Process Timeline","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"d76b02ef-fc95-4001-9297-01cb7412232f","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","name":"Execution","reference":"https://attack.mitre.org/tactics/TA0002/"},"technique":[{"id":"T1059","name":"Command and Scripting Interpreter","reference":"https://attack.mitre.org/techniques/T1059/","subtechnique":[{"id":"T1059.006","name":"Python","reference":"https://attack.mitre.org/techniques/T1059/006/"}]}]}],"to":"now","references":[],"version":104,"exceptions_list":[],"immutable":false,"related_integrations":[{"package":"endpoint","version":"^8.2.0"}],"required_fields":[{"ecs":true,"name":"event.type","type":"keyword"},{"ecs":true,"name":"host.os.type","type":"keyword"},{"ecs":true,"name":"process.entity_id","type":"keyword"},{"ecs":true,"name":"process.executable","type":"keyword"},{"ecs":true,"name":"process.name","type":"keyword"},{"ecs":true,"name":"process.parent.entity_id","type":"keyword"}],"setup":"","type":"eql","language":"eql","index":["logs-endpoint.events.*"],"query":"sequence with maxspan=1m\n  [process where host.os.type == \"linux\" and event.type == \"start\" and process.name : \"python*\"] by process.entity_id\n  [process where host.os.type == \"linux\" and event.type == \"start\" and \n   process.executable : \"/bin/*sh\"\n  ] by process.parent.entity_id\n","actions":[]}
{"id":"7e413420-16b8-11ee-ad8e-610914274334","updated_at":"2023-06-29T20:06:54.595Z","updated_by":"kriuchkovdmy","created_at":"2023-06-29T20:06:54.595Z","created_by":"kriuchkovdmy","name":"Potential Persistence Through Run Control Detected","tags":["Domain: Endpoint","OS: Linux","Use Case: Threat Detection","Tactic: Persistence","Data Source: Elastic Endgame"],"interval":"5m","enabled":false,"revision":0,"description":"This rule monitors the creation/alteration of the rc.local file by a previously unknown process executable through the use of the new terms rule type. The /etc/rc.local file is used to start custom applications, services, scripts or commands during start-up. The rc.local file has mostly been replaced by Systemd. However, through the \"systemd-rc-local-generator\", rc.local files can be converted to services that run at boot. Adversaries may alter rc.local to execute malicious code at start-up, and gain persistence onto the system.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":"","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"0f4d35e4-925e-4959-ab24-911be207ee6f","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0003","name":"Persistence","reference":"https://attack.mitre.org/tactics/TA0003/"},"technique":[{"id":"T1037","name":"Boot or Logon Initialization Scripts","reference":"https://attack.mitre.org/techniques/T1037/","subtechnique":[{"id":"T1037.004","name":"RC Scripts","reference":"https://attack.mitre.org/techniques/T1037/004/"}]}]}],"to":"now","references":["https://www.intezer.com/blog/malware-analysis/hiddenwasp-malware-targeting-linux-systems/","https://pberba.github.io/security/2022/02/06/linux-threat-hunting-for-persistence-initialization-scripts-and-shell-configuration/#8-boot-or-logon-initialization-scripts-rc-scripts","https://www.cyberciti.biz/faq/how-to-enable-rc-local-shell-script-on-systemd-while-booting-linux-system/"],"version":103,"exceptions_list":[],"immutable":false,"related_integrations":[{"package":"endpoint","version":"^8.2.0"}],"required_fields":[{"ecs":true,"name":"event.category","type":"keyword"},{"ecs":true,"name":"event.type","type":"keyword"},{"ecs":true,"name":"file.extension","type":"keyword"},{"ecs":true,"name":"file.path","type":"keyword"},{"ecs":true,"name":"host.os.type","type":"keyword"}],"setup":"","type":"new_terms","query":"host.os.type : \"linux\" and event.category : \"file\" and \nevent.type : (\"change\" or \"file_modify_event\" or \"creation\" or \"file_create_event\") and\nfile.path : \"/etc/rc.local\" and not file.extension : \"swp\"\n","new_terms_fields":["host.id","process.executable"],"history_window_start":"now-7d","index":["logs-endpoint.events.*","auditbeat-*","endgame-*"],"language":"kuery","actions":[]}
{"id":"8b6e28b0-16b8-11ee-ad8e-610914274334","updated_at":"2023-06-29T20:07:16.521Z","updated_by":"kriuchkovdmy","created_at":"2023-06-29T20:07:16.521Z","created_by":"kriuchkovdmy","name":"Enumeration of Kernel Modules","tags":["Domain: Endpoint","OS: Linux","Use Case: Threat Detection","Tactic: Discovery"],"interval":"5m","enabled":false,"revision":0,"description":"Loadable Kernel Modules (or LKMs) are pieces of code that can be loaded and unloaded into the kernel upon demand. They extend the functionality of the kernel without the need to reboot the system. This identifies attempts to enumerate information about a kernel module.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":"","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Security tools and device drivers may run these programs in order to enumerate kernel modules. Use of these programs by ordinary users is uncommon. These can be exempted by process name or username."],"from":"now-9m","rule_id":"2d8043ed-5bda-4caf-801c-c1feb7410504","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0007","name":"Discovery","reference":"https://attack.mitre.org/tactics/TA0007/"},"technique":[{"id":"T1082","name":"System Information Discovery","reference":"https://attack.mitre.org/techniques/T1082/"}]}],"to":"now","references":[],"version":104,"exceptions_list":[],"immutable":false,"related_integrations":[{"package":"endpoint","version":"^8.2.0"}],"required_fields":[{"ecs":true,"name":"event.type","type":"keyword"},{"ecs":true,"name":"host.os.type","type":"keyword"},{"ecs":true,"name":"process.args","type":"keyword"},{"ecs":true,"name":"process.group_leader.name","type":"keyword"},{"ecs":true,"name":"process.name","type":"keyword"},{"ecs":true,"name":"process.parent.name","type":"keyword"},{"ecs":true,"name":"process.parent.user.id","type":"keyword"}],"setup":"","type":"eql","language":"eql","index":["logs-endpoint.events.*"],"query":"process where host.os.type == \"linux\" and event.type == \"start\" and \n((process.name == \"kmod\" and process.args == \"list\") or (process.name == \"modinfo\" and process.parent.user.id != \"0\") or \n(process.name == \"depmod\" and process.args in (\"--all\", \"-a\") and process.parent.user.id != \"0\") \nor process.name == \"lsmod\") and not process.parent.name : (\"vboxmanage\", \"virtualbox\", \"prime-offload\", \"vboxdrv.sh\") and not \nprocess.group_leader.name : \"qualys-cloud-agent\"\n","actions":[]}
{"id":"bf0f2b60-16b8-11ee-ad8e-610914274334","updated_at":"2023-06-29T20:08:43.298Z","updated_by":"kriuchkovdmy","created_at":"2023-06-29T20:08:43.298Z","created_by":"kriuchkovdmy","name":"Kernel Module Removal","tags":["Domain: Endpoint","OS: Linux","Use Case: Threat Detection","Tactic: Defense Evasion","Data Source: Elastic Endgame"],"interval":"5m","enabled":false,"revision":0,"description":"Kernel modules are pieces of code that can be loaded and unloaded into the kernel upon demand. They extend the functionality of the kernel without the need to reboot the system. This rule identifies attempts to remove a kernel module.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":"","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["There is usually no reason to remove modules, but some buggy modules require it. These can be exempted by username. Note that some Linux distributions are not built to support the removal of modules at all."],"from":"now-9m","rule_id":"cd66a5af-e34b-4bb0-8931-57d0a043f2ef","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0005","name":"Defense Evasion","reference":"https://attack.mitre.org/tactics/TA0005/"},"technique":[{"id":"T1562","name":"Impair Defenses","reference":"https://attack.mitre.org/techniques/T1562/","subtechnique":[{"id":"T1562.001","name":"Disable or Modify Tools","reference":"https://attack.mitre.org/techniques/T1562/001/"}]}]},{"framework":"MITRE ATT&CK","tactic":{"id":"TA0003","name":"Persistence","reference":"https://attack.mitre.org/tactics/TA0003/"},"technique":[{"id":"T1547","name":"Boot or Logon Autostart Execution","reference":"https://attack.mitre.org/techniques/T1547/","subtechnique":[{"id":"T1547.006","name":"Kernel Modules and Extensions","reference":"https://attack.mitre.org/techniques/T1547/006/"}]}]}],"to":"now","references":["http://man7.org/linux/man-pages/man8/modprobe.8.html"],"version":104,"exceptions_list":[],"immutable":false,"related_integrations":[{"package":"endpoint","version":"^8.2.0"}],"required_fields":[{"ecs":true,"name":"event.action","type":"keyword"},{"ecs":true,"name":"host.os.type","type":"keyword"},{"ecs":true,"name":"process.args","type":"keyword"},{"ecs":true,"name":"process.name","type":"keyword"}],"setup":"","type":"eql","language":"eql","index":["logs-endpoint.events.*","endgame-*"],"query":"process where host.os.type == \"linux\" and event.action == \"exec\" and process.name == \"rmmod\" or\n(process.name == \"modprobe\" and process.args in (\"--remove\", \"-r\"))\n","actions":[]}
{"id":"d60cd510-64ca-11ed-9fb3-a93e216213bd","updated_at":"2023-06-08T21:03:44.311Z","updated_by":"elastic","created_at":"2022-11-15T09:49:45.807Z","created_by":"elastic","name":"Multiple forwarded violated policy email","tags":["octava","test","SOAR-UA-34","Custom Rules"],"interval":"5h","enabled":true,"revision":4,"description":"Multiple forwarded violated policy email","risk_score":47,"severity":"medium","note":"Виявлено 2 або більше відправки підозрілого електронного листа з домену comfy.ua, тема якого містить маркер SPAM.\nТема листа: {{email.subject}}\nEvents:\ntime_occured, time_ingested, email_from, email_to\n{{@timestamp}}, {{event.ingested}}, {{email.from.address}}, {{email.to.address}}","license":"","output_index":"","meta":{"from":"24h","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava"],"false_positives":[],"from":"now-104400s","rule_id":"0271038d-57e9-45f1-9965-8dc0e3e1ffca","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"reference":"https://attack.mitre.org/tactics/TA0001","name":"Initial Access","id":"TA0001"},"technique":[{"reference":"https://attack.mitre.org/techniques/T1566","name":"Phishing","id":"T1566","subtechnique":[]}]}],"to":"now","references":[],"version":4,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"event.dataset:\"exchange.tracking\" AND email.subject:(*SPAM*) AND source.domain:\"comfy.ua\" AND event.action:\"DELIVER\" AND NOT email.subject:(*SOAR*)","filters":[],"threshold":{"field":["email.subject"],"value":2,"cardinality":[]},"actions":[]}
{"id":"8b3c0560-2627-11ed-a6d5-7b380a06d8af","updated_at":"2023-06-08T21:03:44.309Z","updated_by":"elastic","created_at":"2022-08-27T16:44:40.961Z","created_by":"elastic","name":"SSH failed authentication attempts ","tags":["Linux","Authentication","Octava Defence","prod","Custom Rules"],"interval":"5m","enabled":true,"revision":10,"description":"Protocol SSH multiple (10 times) failed authentication attempts from one IP address within 30 min ","risk_score":47,"severity":"medium","license":"","output_index":"","meta":{"from":"25m","kibana_siem_app_url":"https://192.168.101.14:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava"],"false_positives":[],"from":"now-1800s","rule_id":"f749294b-ce83-4c2f-8131-5e201a1c80d2","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"reference":"https://attack.mitre.org/tactics/TA0006","name":"Credential Access","id":"TA0006"},"technique":[{"reference":"https://attack.mitre.org/techniques/T1110","name":"Brute Force","id":"T1110","subtechnique":[]}]}],"to":"now","references":[],"version":10,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","traces-apm*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","winlogbeat-*"],"query":"event.module:\"system\" AND system.auth.ssh.event:(\"Failed\" OR \"Invalid\")","filters":[],"threshold":{"field":["source.ip"],"value":10,"cardinality":[]},"actions":[]}
{"id":"8877c0f0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:39.870Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.412Z","created_by":"elastic","name":"Potential JAVA/JNDI Exploitation Attempt [Duplicate]","tags":["Elastic","Host","Linux","macOS","Threat Detection","Execution"],"interval":"5m","enabled":true,"revision":102,"description":"Identifies an outbound network connection by JAVA to LDAP, RMI or DNS standard ports followed by a suspicious JAVA child processes. This may indicate an attempt to exploit a JAVA/NDI (Java Naming and Directory Interface) injection vulnerability.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":".siem-signals-default","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"81526b80-8d96-4fe1-996d-13bea6dc2786","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1059/","name":"Command and Scripting Interpreter","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1059/007/","name":"JavaScript","id":"T1059.007"}],"id":"T1059"},{"reference":"https://attack.mitre.org/techniques/T1203/","name":"Exploitation for Client Execution","id":"T1203"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002/","name":"Execution","id":"TA0002"}}],"to":"now","references":["https://www.lunasec.io/docs/blog/log4j-zero-day/","https://github.com/christophetd/log4shell-vulnerable-app","https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE.pdf","https://www.elastic.co/security-labs/detecting-log4j2-with-elastic-security","https://www.elastic.co/security-labs/analysis-of-log4shell-cve-2021-45046"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-endpoint.events.*"],"query":"sequence by host.id with maxspan=1m\n [network where event.action == \"connection_attempted\" and\n  process.name : \"java\" and\n  /*\n     outbound connection attempt to\n     LDAP, RMI or DNS standard ports\n     by JAVA process\n   */\n  destination.port in (1389, 389, 1099, 53, 5353)] by process.pid\n [process where event.type == \"start\" and\n\n  /* Suspicious JAVA child process */\n  process.parent.name : \"java\" and\n   process.name : (\"sh\",\n                   \"bash\",\n                   \"dash\",\n                   \"ksh\",\n                   \"tcsh\",\n                   \"zsh\",\n                   \"curl\",\n                   \"perl*\",\n                   \"python*\",\n                   \"ruby*\",\n                   \"php*\",\n                   \"wget\")] by process.parent.pid\n","actions":[]}
{"id":"14b593e0-d962-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.145Z","updated_by":"elastic","created_at":"2023-04-12T18:44:39.586Z","created_by":"elastic","name":"Enumeration of Privileged Local Groups Membership [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Discovery","Investigation Guide"],"interval":"5m","enabled":true,"revision":104,"description":"Identifies instances of an unusual process enumerating built-in Windows privileged local groups membership like Administrators or Remote Desktop users.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n\n### Investigating Enumeration of Privileged Local Groups Membership\n\nAfter successfully compromising an environment, attackers may try to gain situational awareness to plan their next steps. This can happen by running commands to enumerate network resources, users, connections, files, and installed security software.\n\nThis rule looks for the enumeration of privileged local groups' membership by suspicious processes, and excludes known legitimate utilities and programs installed. Attackers can use this information to decide the next steps of the attack, such as mapping targets for credential compromise and other post-exploitation activities.\n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/master/invest-guide-run-osquery.html) introduced in Elastic stack version 8.5.0. Older Elastic stacks versions will see unrendered markdown in this guide.\n\n#### Possible investigation steps\n\n- Identify the process, host and user involved on the event.\n- Investigate the process execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Investigate any abnormal account behavior, such as command executions, file creations or modifications, and network connections.\n- Examine the host for derived artifacts that indicates suspicious activities:\n  - Analyze the process executable using a private sandboxed analysis system.\n  - Observe and collect information about the following activities in both the sandbox and the alert subject host:\n    - Attempts to contact external domains and addresses.\n      - Use the Elastic Defend network events to determine domains and addresses contacted by the subject process by filtering by the process' `process.entity_id`.\n      - Examine the DNS cache for suspicious or anomalous entries.\n        - !{osquery{\"query\":\"SELECT * FROM dns_cache\", \"label\":\"Osquery - Retrieve DNS Cache\"}}\n    - Use the Elastic Defend registry events to examine registry keys accessed, modified, or created by the related processes in the process tree.\n    - Examine the host services for suspicious or anomalous entries.\n      - !{osquery{\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services\",\"label\":\"Osquery - Retrieve All Services\"}}\n      - !{osquery{\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services WHERE NOT (user_account LIKE '%LocalSystem' OR user_account LIKE '%LocalService' OR user_account LIKE '%NetworkService' OR user_account == null)\",\"label\":\"Osquery - Retrieve Services Running on User Accounts\"}}\n      - !{osquery{\"query\":\"SELECT concat('https://www.virustotal.com/gui/file/', sha1) AS VtLink, name, description, start_type, status, pid, services.path FROM services JOIN authenticode ON services.path = authenticode.path OR services.module_path = authenticode.path JOIN hash ON services.path = hash.path WHERE authenticode.result != 'trusted'\",\"label\":\"Osquery - Retrieve Service Unsigned Executables with Virustotal Link\"}}\n  - Retrieve the files' SHA-256 hash values using the PowerShell `Get-FileHash` cmdlet and search for the existence and reputation of the hashes in resources like VirusTotal, Hybrid-Analysis, CISCO Talos, Any.run, etc.\n- Investigate potentially compromised accounts. Analysts can do this by searching for login events (for example, 4624) to the target host after the registry modification.\n\n### False positive analysis\n\n- Discovery activities are not inherently malicious if they occur in isolation. As long as the analyst did not identify suspicious activity related to the user or host, such alerts can be dismissed.\n- If this rule is noisy in your environment due to expected activity, consider adding exceptions — preferably with a combination of user and command line conditions.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved hosts to prevent further post-compromise behavior.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n\nThe 'Audit Security Group Management' audit policy must be configured (Success).\nSteps to implement the logging policy with with Advanced Audit Configuration:\n\n```\nComputer Configuration >\nPolicies >\nWindows Settings >\nSecurity Settings >\nAdvanced Audit Policies Configuration >\nAudit Policies >\nAccount Management >\nAudit Security Group Management (Success)\n```\n\nMicrosoft introduced the [event used](https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4799) in this detection rule on Windows 10 and Windows Server 2016 or later operating systems.\n\nIf enabling an EQL rule on a non-elastic-agent index (such as beats) for versions <8.2, events will not define `event.ingested` and default fallback for EQL rules was not added until 8.2, so you will need to add a custom pipeline to populate `event.ingested` to @timestamp for this rule to work.","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"2cb19c93-62dd-47ac-b15d-4763dbed4b6b","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1069/","name":"Permission Groups Discovery","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1069/001/","name":"Local Groups","id":"T1069.001"}],"id":"T1069"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0007/","name":"Discovery","id":"TA0007"}}],"to":"now","references":[],"version":104,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["winlogbeat-*","logs-system.*","logs-windows.*"],"query":"iam where event.action == \"user-member-enumerated\" and\n\n  /* excluding machine account */\n  not winlog.event_data.SubjectUserName: (\"*$\", \"LOCAL SERVICE\", \"NETWORK SERVICE\") and\n\n  /* noisy and usual legit processes excluded */\n  not winlog.event_data.CallerProcessName:\n               (\"-\",\n                \"?:\\\\Windows\\\\System32\\\\VSSVC.exe\",\n                \"?:\\\\Windows\\\\System32\\\\SearchIndexer.exe\",\n                \"?:\\\\Windows\\\\System32\\\\CompatTelRunner.exe\",\n                \"?:\\\\Windows\\\\System32\\\\oobe\\\\msoobe.exe\",\n                \"?:\\\\Windows\\\\System32\\\\net1.exe\",\n                \"?:\\\\Windows\\\\System32\\\\svchost.exe\",\n                \"?:\\\\Windows\\\\System32\\\\Netplwiz.exe\",\n                \"?:\\\\Windows\\\\System32\\\\msiexec.exe\",\n                \"?:\\\\Windows\\\\SysWOW64\\\\msiexec.exe\",\n                \"?:\\\\Windows\\\\System32\\\\CloudExperienceHostBroker.exe\",\n                \"?:\\\\Windows\\\\System32\\\\wbem\\\\WmiPrvSE.exe\",\n                \"?:\\\\Windows\\\\System32\\\\SrTasks.exe\",\n                \"?:\\\\Windows\\\\System32\\\\lsass.exe\",\n                \"?:\\\\Windows\\\\System32\\\\diskshadow.exe\",\n                \"?:\\\\Windows\\\\System32\\\\dfsrs.exe\",\n                \"?:\\\\Program Files\\\\*.exe\",\n                \"?:\\\\Program Files (x86)\\\\*.exe\",\n                \"?:\\\\WindowsAzure\\\\*\\\\WaAppAgent.exe\",\n                \"?:\\\\Windows\\\\System32\\\\vssadmin.exe\",\n                \"?:\\\\Windows\\\\VeeamVssSupport\\\\VeeamGuestHelper.exe\",\n                \"?:\\\\Windows\\\\System32\\\\dllhost.exe\",\n                \"?:\\\\Windows\\\\System32\\\\mmc.exe\",\n                \"?:\\\\Windows\\\\System32\\\\SettingSyncHost.exe\",\n                \"?:\\\\Windows\\\\ImmersiveControlPanel\\\\SystemSettings.exe\",\n                \"?:\\\\Windows\\\\System32\\\\SystemSettingsAdminFlows.exe\",\n                \"?:\\\\Windows\\\\Temp\\\\rubrik_vmware???\\\\snaptool.exe\",\n                \"?:\\\\Windows\\\\System32\\\\inetsrv\\\\w3wp.exe\",\n                \"?:\\\\$WINDOWS.~BT\\\\Sources\\\\*.exe\",\n                \"?:\\\\Windows\\\\System32\\\\wsmprovhost.exe\",\n                \"?:\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\x64\\\\3\\\\x3jobt3?.exe\",\n                \"?:\\\\Windows\\\\System32\\\\mstsc.exe\",\n                \"?:\\\\Windows\\\\System32\\\\esentutl.exe\",\n                \"?:\\\\Windows\\\\System32\\\\RecoveryDrive.exe\",\n                \"?:\\\\Windows\\\\System32\\\\SystemPropertiesComputerName.exe\") and\n\n  /* privileged local groups */\n  (group.name:(\"*admin*\",\"RemoteDesktopUsers\") or\n   winlog.event_data.TargetSid:(\"S-1-5-32-544\",\"S-1-5-32-555\"))\n","actions":[]}
{"id":"ed8092b0-5e7e-11ed-af7b-4b4586cb86d2","updated_at":"2023-06-08T21:05:11.367Z","updated_by":"elastic","created_at":"2022-11-07T09:31:16.441Z","created_by":"elastic","name":"Wireless WPA2 multiple failed authentication attempts from one device","tags":["octava","test","Custom Rules"],"interval":"5m","enabled":true,"revision":11,"description":"Wireless WPA2 multiple failed authentication attempts from one device","risk_score":47,"severity":"medium","note":"Зафіксовано 100 або більше неуспішних спроб підключення за годину пристрою з MAC адресою {{fortinet.firewall.stamac}} в мережі WiFi WPA2 Personal.\nEvents:\ntime_occured, time_ingested, wifi_ap, wifi_ssid, source_mac\n{{@timestamp}}, {{event.ingested}}, {{fortinet.firewall.ap}}, {{fortinet.firewall.ssid}}, {{fortinet.firewall.stamac}}","license":"","output_index":"","meta":{"from":"55m","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava"],"false_positives":[],"from":"now-3600s","rule_id":"72137805-c6b9-40f4-9694-a727554f773c","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"reference":"https://attack.mitre.org/tactics/TA0006","name":"Credential Access","id":"TA0006"},"technique":[{"reference":"https://attack.mitre.org/techniques/T1110","name":"Brute Force","id":"T1110","subtechnique":[]}]}],"to":"now","references":[],"version":11,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"fortinet.firewall.action:\"WPA-invalid-2/4-key-msg\"","filters":[],"threshold":{"field":["event.ap.store_city"],"value":100,"cardinality":[]},"actions":[]}
{"id":"0c7d3cd0-2640-11ed-a6d5-7b380a06d8af","updated_at":"2023-06-08T21:03:44.312Z","updated_by":"elastic","created_at":"2022-08-27T19:40:04.848Z","created_by":"elastic","name":"Multiple locked-out of one account","tags":["Authentication","Windows","Octava Defence","prod","Custom Rules"],"interval":"5m","enabled":true,"revision":9,"description":"Multiple (5 times) locked-out of one account within 1 hour","risk_score":47,"severity":"medium","license":"","output_index":"","meta":{"from":"55m","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava"],"false_positives":[],"from":"now-3600s","rule_id":"5e5c2bfa-f229-4442-bef0-e00e8f1b003f","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","reference":"https://attack.mitre.org/tactics/TA0006","name":"Credential Access"},"technique":[{"id":"T1110","reference":"https://attack.mitre.org/techniques/T1110","name":"Brute Force","subtechnique":[]}]}],"to":"now","references":[],"version":9,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"event.code:\"4740\"","filters":[],"threshold":{"field":["host.name","winlog.event_data.TargetUserName"],"value":5,"cardinality":[]},"actions":[]}
{"id":"887bb890-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:39.868Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.370Z","created_by":"elastic","name":"Setuid / Setgid Bit Set via chmod [Duplicate]","tags":["Elastic","Host","Linux","macOS","Threat Detection","Privilege Escalation"],"interval":"5m","enabled":true,"revision":101,"description":"An adversary may add the setuid or setgid bit to a file or directory in order to run a file with the privileges of the owning user or group. An adversary can take advantage of this to either do a shell escape or exploit a vulnerability in an application with the setuid or setgid bit to get code running in a different user’s context. Additionally, adversaries can use this mechanism on their own malware to make sure they're able to execute in elevated contexts in the future.","risk_score":21,"severity":"low","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"d70a72d4-ca6f-4c4c-891b-c951389c34a0","max_signals":33,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1548/","name":"Abuse Elevation Control Mechanism","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1548/001/","name":"Setuid and Setgid","id":"T1548.001"}],"id":"T1548"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0004/","name":"Privilege Escalation","id":"TA0004"}},{"framework":"MITRE ATT&CK","technique":[],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}}],"to":"now","references":[],"version":101,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"lucene","index":["auditbeat-*","logs-endpoint.events.*"],"query":"event.category:process AND event.type:(start OR process_started) AND\n process.name:chmod AND process.args:(\"+s\" OR \"u+s\" OR /4[0-9]{3}/ OR g+s OR /2[0-9]{3}/) AND\n NOT process.args:\n           (\n             /.*\\/Applications\\/VirtualBox.app\\/.+/ OR\n             /\\/usr\\/local\\/lib\\/python.+/ OR\n             /\\/var\\/folders\\/.+\\/FP.*nstallHelper/ OR\n             /\\/Library\\/Filesystems\\/.+/ OR\n             /\\/usr\\/lib\\/virtualbox\\/.+/ OR\n             /\\/Library\\/Application.*/ OR\n             \"/run/postgresql\" OR\n             \"/var/crash\" OR\n             \"/var/run/postgresql\" OR\n             /\\/usr\\/bin\\/.+/ OR /\\/usr\\/local\\/share\\/.+/ OR\n             /\\/Applications\\/.+/ OR /\\/usr\\/libexec\\/.+/ OR\n             \"/var/metrics\" OR /\\/var\\/lib\\/dpkg\\/.+/ OR\n             /\\/run\\/log\\/journal\\/.*/ OR\n             \\/Users\\/*\\/.minikube\\/bin\\/docker-machine-driver-hyperkit\n           ) AND\n NOT process.parent.executable:\n           (\n             /\\/var\\/lib\\/docker\\/.+/ OR\n             \"/System/Library/PrivateFrameworks/PackageKit.framework/Versions/A/XPCServices/package_script_service.xpc/Contents/MacOS/package_script_service\" OR\n             \"/var/lib/dpkg/info/whoopsie.postinst\"\n           )\n","actions":[]}
{"id":"252c7f70-6f0b-11ed-b6ee-234327f60bd6","updated_at":"2023-06-08T21:03:44.307Z","updated_by":"elastic","created_at":"2022-11-28T10:55:18.506Z","created_by":"elastic","name":"Unauthorized access to restricted network share files [Comp&ben]","tags":["SOAR-UA-23","Custom Rules"],"interval":"5m","enabled":true,"revision":7,"description":"Unauthorized access to restricted network share files [Comp&ben]","risk_score":21,"severity":"low","license":"","output_index":"","meta":{"from":"1m","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":[],"false_positives":[],"from":"now-360s","rule_id":"3dde17e9-e238-46e7-8205-c9e8b1a8ed8d","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[],"to":"now","references":[],"version":7,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"((event.code:5140 AND winlog.event_data.ShareLocalPath:(*E* AND *DFS* AND *HR*) AND NOT winlog.event_data.SubjectUserName:*$ AND NOT winlog.event_data.SubjectUserName:\"fdlp-service-scan\") OR (event.code:4663 AND winlog.event_data.ObjectName:(*E* AND *HR* AND *Comp&ben*)))","filters":[],"threshold":{"field":["winlog.event_data.SubjectUserName"],"value":2,"cardinality":[{"field":"event.code","value":2}]},"actions":[]}
{"id":"83481db0-d961-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-06-01T21:21:18.598Z","updated_by":"elastic","created_at":"2023-04-12T18:40:36.323Z","created_by":"elastic","name":"Multiple Users Failing To Authenticate From Host Using NTLM [Duplicate]","tags":["Octava"],"interval":"5m","enabled":true,"revision":7,"description":"The following analytic identifies one source endpoint failing to authenticate with multiple users using the NTLM protocol. This behavior could represent an adversary performing a Password Spraying attack against an Active Directory environment using NTLM to obtain initial access or elevate privileges.","risk_score":73,"severity":"high","license":"","output_index":"","meta":{"from":"25m","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"author":[],"false_positives":[],"from":"now-1800s","rule_id":"f4e774d6-32f6-4387-a1ab-1518b9f2655f","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[],"to":"now","references":[],"version":7,"exceptions_list":[{"id":"3ebbbb10-00c2-11ee-82b6-b1835b5ce684","list_id":"0cd2bb26-20e5-4b41-a193-ce83f8ecb017","type":"detection","namespace_type":"single"}],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"kuery","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"event.code:\"4776\" and not winlog.event_data.Status:\"0x0\" and not user.name:*$ and not (host.name:\"LT-EXCH1.aku.com\" and winlog.event_data.Workstation:\"WORKSTATION\") and not (winlog.event_data.Workstation:\"LT-EXCH3\" and host.name:\"lt-exch3.aku.com\") and not (host.name:\"lt-exch3.aku.com\" and winlog.event_data.Workstation:\"WORKSTATION\") and not (host.name:\"LT-EXCH1.aku.com\" and winlog.event_data.Workstation:\"LT-EXCH1\")","filters":[],"threshold":{"field":["host.name","winlog.event_data.Workstation"],"value":10,"cardinality":[{"field":"user.name","value":10}]},"actions":[]}
{"id":"887c2dc0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T15:34:55.595Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.442Z","created_by":"elastic","name":"Sudoers File Modification [Duplicate]","tags":["Elastic","Host","Linux","macOS","Threat Detection","Privilege Escalation"],"interval":"5m","enabled":true,"revision":101,"description":"A sudoers file specifies the commands that users or groups can run and from which terminals. Adversaries can take advantage of these configurations to execute commands as other users or spawn processes with higher privileges.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"b3f44bc5-7f1b-45ed-9497-c8b45c84fe5f","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1548/","name":"Abuse Elevation Control Mechanism","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1548/003/","name":"Sudo and Sudo Caching","id":"T1548.003"}],"id":"T1548"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0004/","name":"Privilege Escalation","id":"TA0004"}}],"to":"now","references":[],"version":101,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*"],"query":"event.category:file and event.type:change and file.path:(/etc/sudoers* or /private/etc/sudoers*)\n","actions":[]}
{"id":"898a4260-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.888Z","updated_by":"elastic","created_at":"2023-03-15T15:32:04.141Z","created_by":"elastic","name":"Persistence via KDE AutoStart Script or Desktop File Modification [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Persistence","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Identifies the creation or modification of a K Desktop Environment (KDE) AutoStart script or desktop file that will execute upon each user logon. Adversaries may abuse this method for persistence.","risk_score":47,"severity":"medium","note":"","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"46bc7cb8-3235-4c96-bb70-f144a3422eb7","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1547/","name":"Boot or Logon Autostart Execution","id":"T1547"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}}],"to":"now","references":["https://userbase.kde.org/System_Settings/Autostart","https://www.amnesty.org/en/latest/research/2020/09/german-made-finspy-spyware-found-in-egypt-and-mac-and-linux-versions-revealed/","https://www.intezer.com/blog/research/operation-electrorat-attacker-creates-fake-companies-to-drain-your-crypto-wallets/"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"file where event.type != \"deletion\" and\n  file.extension in (\"sh\", \"desktop\") and\n  file.path :\n    (\n      \"/home/*/.config/autostart/*\", \"/root/.config/autostart/*\",\n      \"/home/*/.kde/Autostart/*\", \"/root/.kde/Autostart/*\",\n      \"/home/*/.kde4/Autostart/*\", \"/root/.kde4/Autostart/*\",\n      \"/home/*/.kde/share/autostart/*\", \"/root/.kde/share/autostart/*\",\n      \"/home/*/.kde4/share/autostart/*\", \"/root/.kde4/share/autostart/*\",\n      \"/home/*/.local/share/autostart/*\", \"/root/.local/share/autostart/*\",\n      \"/home/*/.config/autostart-scripts/*\", \"/root/.config/autostart-scripts/*\",\n      \"/etc/xdg/autostart/*\", \"/usr/share/autostart/*\"\n    ) and\n    not process.name in (\"yum\", \"dpkg\", \"install\", \"dnf\", \"teams\", \"yum-cron\", \"dnf-automatic\")\n","actions":[]}
{"id":"88b05d20-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:42.911Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.679Z","created_by":"elastic","name":"Reverse Shell Created via Named Pipe [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Execution","Investigation Guide","Elastic Endgame"],"interval":"5m","enabled":true,"revision":3,"description":"Identifies a reverse shell via the abuse of named pipes on Linux with the help of OpenSSL or Netcat. First in, first out (FIFO) files are special files for reading and writing to by Linux processes. For this to work, a named pipe is created and passed to a Linux shell where the use of a network connection tool such as Netcat or OpenSSL has been established. The stdout and stderr are captured in the named pipe from the network connection and passed back to the shell for execution.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":"","author":["Elastic"],"false_positives":["Netcat and OpenSSL are common tools used for establishing network connections and creating encryption keys. While they are popular, capturing the stdout and stderr in a named pipe pointed to a shell is anomalous."],"from":"now-9m","rule_id":"93ea4b94-6457-4e93-b8d8-9badbacd7d24","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1059/","name":"Command and Scripting Interpreter","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1059/004/","name":"Unix Shell","id":"T1059.004"}],"id":"T1059"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002/","name":"Execution","id":"TA0002"}}],"to":"now","references":["https://int0x33.medium.com/day-43-reverse-shell-with-openssl-1ee2574aa998","https://blog.gregscharf.com/2021/03/22/tar-in-cronjob-to-privilege-escalation/","https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#openssl"],"version":3,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"sequence by host.id with maxspan = 5s\n    [process where event.type == \"start\" and process.executable : (\"/usr/bin/mkfifo\",\"/usr/bin/mknod\") and process.args:(\"/tmp/*\",\"$*\")]\n    [process where process.executable : (\"/bin/sh\",\"/bin/bash\") and process.args:(\"-i\") or\n        (process.executable: (\"/usr/bin/openssl\") and process.args: (\"-connect\"))]\n    [process where (process.name:(\"nc\",\"ncat\",\"netcat\",\"netcat.openbsd\",\"netcat.traditional\") or\n                    (process.name: \"openssl\" and process.executable: \"/usr/bin/openssl\"))]\n","actions":[]}
{"id":"898a9080-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:39.871Z","updated_by":"elastic","created_at":"2023-03-15T15:32:04.145Z","created_by":"elastic","name":"Sensitive Files Compression [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Collection","Credential Access","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Identifies the use of a compression utility to collect known files containing sensitive information, such as credentials and system configurations.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"e25db0cd-f6d5-4d81-af54-0e1007b68a95","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1552/","name":"Unsecured Credentials","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1552/001/","name":"Credentials In Files","id":"T1552.001"}],"id":"T1552"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0006/","name":"Credential Access","id":"TA0006"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1560/","name":"Archive Collected Data","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1560/001/","name":"Archive via Utility","id":"T1560.001"}],"id":"T1560"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0009/","name":"Collection","id":"TA0009"}}],"to":"now","references":["https://www.trendmicro.com/en_ca/research/20/l/teamtnt-now-deploying-ddos-capable-irc-bot-tntbotinger.html"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"event.category:process and event.type:start and\n  process.name:(zip or tar or gzip or hdiutil or 7z) and\n  process.args:\n    (\n      /root/.ssh/id_rsa or\n      /root/.ssh/id_rsa.pub or\n      /root/.ssh/id_ed25519 or\n      /root/.ssh/id_ed25519.pub or\n      /root/.ssh/authorized_keys or\n      /root/.ssh/authorized_keys2 or\n      /root/.ssh/known_hosts or\n      /root/.bash_history or\n      /etc/hosts or\n      /home/*/.ssh/id_rsa or\n      /home/*/.ssh/id_rsa.pub or\n      /home/*/.ssh/id_ed25519 or\n      /home/*/.ssh/id_ed25519.pub or\n      /home/*/.ssh/authorized_keys or\n      /home/*/.ssh/authorized_keys2 or\n      /home/*/.ssh/known_hosts or\n      /home/*/.bash_history or\n      /root/.aws/credentials or\n      /root/.aws/config or\n      /home/*/.aws/credentials or\n      /home/*/.aws/config or\n      /root/.docker/config.json or\n      /home/*/.docker/config.json or\n      /etc/group or\n      /etc/passwd or\n      /etc/shadow or\n      /etc/gshadow\n    )\n","actions":[]}
{"id":"59d15f50-5e7d-11ed-af7b-4b4586cb86d2","updated_at":"2023-06-08T21:03:44.315Z","updated_by":"elastic","created_at":"2022-11-07T09:19:59.941Z","created_by":"elastic","name":"Wireless EAP multiple failed authentication attempts of one domain user account","tags":["octava","test","Custom Rules"],"interval":"5m","enabled":true,"revision":3,"description":"Wireless EAP multiple failed authentication attempts of one domain user account","risk_score":47,"severity":"medium","note":"Зафіксовано 5 або більше неуспішних спроб автентифікації користувача {{source.user.name}} в мережі WiFi WPA2 Enterprise.\nEvents:\ntime_occured, time_ingested, wifi_ap, wifi_ssid, source_mac, user, user_displayname, user_division, user_department, user_title, user_mobile\n{{@timestamp}}, {{event.ingested}}, {{fortinet.firewall.ap}}, {{fortinet.firewall.ssid}},  {{fortinet.firewall.stamac}}, {{source.user.name}}, user_division, user_department, user_title, user_mobile,","license":"","output_index":"","meta":{"from":"55m","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava"],"false_positives":[],"from":"now-3600s","rule_id":"d01f48e7-6a59-4828-a41a-2e41b4e4d794","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","reference":"https://attack.mitre.org/tactics/TA0006","name":"Credential Access"},"technique":[{"id":"T1110","reference":"https://attack.mitre.org/techniques/T1110","name":"Brute Force","subtechnique":[]}]}],"to":"now","references":[],"version":3,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"fortinet.firewall.security:(\"WPA2 Enterprise\") AND fortinet.firewall.action:\"RADIUS-auth-failure\"","filters":[],"threshold":{"field":["source.user.name"],"value":5,"cardinality":[]},"actions":[]}
{"id":"a5dc18f0-27cc-11ed-a6d5-7b380a06d8af","updated_at":"2023-06-08T21:03:44.316Z","updated_by":"elastic","created_at":"2022-08-29T18:59:03.410Z","created_by":"elastic","name":"ESET Outbreak of malware signature","tags":["Octava Defence","prod","Custom Rules"],"interval":"5m","enabled":true,"revision":9,"description":"One Malware signature detected on multiple(10) computers within 24 hours","risk_score":47,"severity":"medium","license":"","output_index":"","meta":{"from":"24h","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava"],"false_positives":[],"from":"now-86700s","rule_id":"89ec4fa3-e498-4ab9-8ecc-fa4b081f1833","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","reference":"https://attack.mitre.org/tactics/TA0002","name":"Execution"},"technique":[{"id":"T1203","reference":"https://attack.mitre.org/techniques/T1203","name":"Exploitation for Client Execution","subtechnique":[]}]}],"to":"now","references":[],"version":9,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"event.module:\"eset\" AND event.type:\"file\" AND NOT \"Potentially unwanted application\"  AND NOT (rule.name:*Adware* AND file.path:http*)","filters":[],"threshold":{"field":["rule.name"],"value":2,"cardinality":[{"field":"host.hostname","value":2}]},"actions":[]}
{"id":"7dc984d0-5083-11ed-b5fa-0d281afe1344","updated_at":"2023-06-08T21:05:11.367Z","updated_by":"elastic","created_at":"2022-10-20T14:28:40.480Z","created_by":"elastic","name":"MSSQL multiple failed authentication attempts of one domain user account","tags":["Octava","Windows","MSSQL","Custom Rules"],"interval":"5m","enabled":true,"revision":4,"description":"MSSQL multiple failed authentication attempts of one domain user account","risk_score":47,"severity":"medium","license":"","output_index":"","meta":{"from":"2h","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":[],"false_positives":[],"from":"now-7500s","rule_id":"be94da4d-13e0-45e5-a18e-96b97dba8242","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"tactic":{"id":"TA0006","reference":"https://attack.mitre.org/tactics/TA0006","name":"Credential Access"},"framework":"MITRE ATT&CK","technique":[{"id":"T1110","reference":"https://attack.mitre.org/techniques/T1110","name":"Brute Force","subtechnique":[{"id":"T1110.001","reference":"https://attack.mitre.org/techniques/T1110/001","name":"Password Guessing"}]}]}],"to":"now","references":[],"version":4,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"agent.name:\"DWH-SQLC\" AND event.code:\"18456\" AND winlog.event_data.param1:AKU0*","filters":[],"threshold":{"field":["winlog.event_data.param1"],"value":5,"cardinality":[]},"actions":[]}
{"id":"2f768d60-54f6-11ed-b5fa-0d281afe1344","updated_at":"2023-06-08T21:03:44.311Z","updated_by":"elastic","created_at":"2022-10-26T06:19:45.761Z","created_by":"elastic","name":"Data loss violation due to dismissed staff","tags":["octava","Custom Rules"],"interval":"5m","enabled":true,"revision":3,"description":"Data loss violation due to dismissed staff","risk_score":47,"severity":"medium","note":"Зафіксовано подію рівня HIGH в системі Forcepoint DLP щодо звільненого співробітника.\n\ntime_occured, time_ingested, host, file, user, user_displayname, user_division, user_department, user_title, user_mobile\n{{@timestamp}}, {{event.ingested}}, {{cef.extensions.sourceHost}}, {{event.original}}, {{user.name}}, {{user_division}}, {{user_department}}, {{user_title}}, {{user_mobile}}","license":"","output_index":"","meta":{"from":"3m","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava Defence"],"false_positives":[],"from":"now-480s","rule_id":"d427c059-e11e-40e0-b08f-27f9d14c8b73","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"reference":"https://attack.mitre.org/tactics/TA0010","name":"Exfiltration","id":"TA0010"},"technique":[{"reference":"https://attack.mitre.org/techniques/T1052","name":"Exfiltration Over Physical Medium","id":"T1052","subtechnique":[]}]}],"to":"now","references":[],"version":3,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"event.dataset:\"cef.log\" AND cef.device.vendor:\"Forcepoint\" AND cef.extensions.severityType:\"HIGH\"","filters":[],"threshold":{"field":["user.name"],"value":1,"cardinality":[]},"actions":[]}
{"id":"24d74f60-7b94-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-06-08T21:03:44.312Z","updated_by":"elastic","created_at":"2022-12-14T09:46:12.720Z","created_by":"elastic","name":"Wireless rogue access point with enterprise ssid ComfyShops","tags":["SOAR-UA-31","Custom Rules"],"interval":"5m","enabled":true,"revision":4,"description":"Wireless rogue access point with enterprise ssid ComfyShops","risk_score":47,"severity":"medium","license":"","output_index":"","meta":{"from":"3m","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":[],"false_positives":[],"from":"now-480s","rule_id":"4a3934eb-b672-473b-9871-1f68aa46ac66","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","reference":"https://attack.mitre.org/tactics/TA0006","name":"Credential Access"},"technique":[{"id":"T1040","reference":"https://attack.mitre.org/techniques/T1040","name":"Network Sniffing","subtechnique":[]}]}],"to":"now","references":[],"version":4,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"fortinet.firewall.action:*rogue* AND fortinet.firewall.ssid:ComfyShops AND fortinet.firewall.action:\"rogue-ap-detected\"","filters":[],"threshold":{"field":["fortinet.firewall.bssid"],"value":1,"cardinality":[]},"actions":[]}
{"id":"e3298e40-9333-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-06-08T21:03:44.311Z","updated_by":"elastic","created_at":"2023-01-13T11:17:38.602Z","created_by":"elastic","name":"Multiple failed authentication of one azure user account","tags":["SOAR-СY-01","Octava Defence","Custom Rules"],"interval":"5m","enabled":true,"revision":2,"description":"Multiple failed authentication of one azure user account","risk_score":73,"severity":"high","note":"Зафіксовано 4 або більше подій неуспішної автентифікації користувача {{user.name}} протягом 1 години в Azure AD.\nПодії:\ntime_occured, time_ingested, category, app, agent_os, agent_name, source_ip, Country, username, user_displayname, user_division, user_department, user_title, user_mobile\n{{@timestamp}}, {{event.ingested}}, {{azure.signinlogs.category}}, {{azure.signinlogs.properties.app_display_name}}, {{user_agent.os.full}}, {{user_agent.name}}, {{source.ip}}, {{source.geo.country_name}}, {{user.name}}, {user_displayname}, {user_division}, {user_department}, {user_title}, {user_mobile}, {rule.name}, {file.path}","license":"","output_index":"","meta":{"from":"55m","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava Defence"],"false_positives":[],"from":"now-3600s","rule_id":"d8c80d2f-4838-47b0-b86e-ab9e2e556b73","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","reference":"https://attack.mitre.org/tactics/TA0006","name":"Credential Access"},"technique":[{"id":"T1110","reference":"https://attack.mitre.org/techniques/T1110","name":"Brute Force","subtechnique":[]}]}],"to":"now","references":[],"version":2,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"event.dataset:\"azure.signinlogs\" AND event.outcome:\"failure\"","filters":[],"threshold":{"field":["user.name"],"value":4,"cardinality":[]},"actions":[]}
{"id":"81a4ff90-d962-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-13T12:54:02.450Z","updated_by":"elastic","created_at":"2023-04-12T18:47:42.349Z","created_by":"elastic","name":"A scheduled task was created [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Persistence"],"interval":"5m","enabled":true,"revision":5,"description":"Indicates the creation of a scheduled task using Windows event logs. Adversaries can use these to establish persistence, move laterally, and/or escalate privileges.","risk_score":21,"severity":"low","license":"Elastic License v2","output_index":"","meta":{"from":"4m"},"timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Legitimate scheduled tasks may be created during installation of new software."],"from":"now-540s","rule_id":"c4c72f08-ee99-4ab1-b1aa-3211e55e1071","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"},"technique":[{"reference":"https://attack.mitre.org/techniques/T1053/","name":"Scheduled Task/Job","id":"T1053","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1053/005/","name":"Scheduled Task","id":"T1053.005"}]}]}],"to":"now","references":["https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4698"],"version":5,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["winlogbeat-*","logs-system.*","logs-windows.*"],"query":"iam where event.action == \"scheduled-task-created\" and\n\n /* excluding tasks created by the computer account */\n not user.name : \"*$\" and\n\n /* TaskContent is not parsed, exclude by full taskname noisy ones */\n not winlog.event_data.TaskName :\n             (\"\\\\OneDrive Standalone Update Task-S-1-5-21*\",\n              \"\\\\OneDrive Standalone Update Task-S-1-12-1-*\",\n              \"\\\\Hewlett-Packard\\\\HP Web Products Detection\",\n              \"\\\\Hewlett-Packard\\\\HPDeviceCheck\",\n               \"\\\\User_Feed_Synchronization-*\")\n","filters":[],"actions":[]}
{"id":"a2226fb0-601c-11ed-af7b-4b4586cb86d2","updated_at":"2023-06-08T21:03:44.309Z","updated_by":"elastic","created_at":"2022-11-09T10:52:41.908Z","created_by":"elastic","name":"Unauthorized access using domain technical accounts","tags":["SOAR-UA-26","Custom Rules"],"interval":"5m","enabled":true,"revision":3,"description":"Unauthorized access using domain technical accounts","risk_score":73,"severity":"high","license":"","output_index":"","meta":{"from":"1m","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":[],"false_positives":[],"from":"now-360s","rule_id":"578b8da4-2087-4e3d-b1c5-c8a8acbb1999","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[],"to":"now","references":[],"version":3,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"event.code:4624 AND source.as.number:* AND NOT source.as.organization.name:MICROSOFT* AND NOT source.geo.country_name:\"Ukraine\" AND NOT source.as.organization.name:\"SPACEX-STARLINK\" AND user.name:*_* AND NOT host.name:(*exch* OR *EXCH*)\n","filters":[],"threshold":{"field":["user.name"],"value":1,"cardinality":[]},"actions":[]}
{"id":"e1d73c80-3911-11ed-b5fa-0d281afe1344","updated_at":"2023-06-08T21:03:44.307Z","updated_by":"elastic","created_at":"2022-09-20T18:27:28.873Z","created_by":"elastic","name":"Fortigate Outbreak Virus Internal Detection to External Direction","tags":["Octava Defence","prod","Custom Rules"],"interval":"5m","enabled":true,"revision":8,"description":"Fortigate AV detection where source IP address from private networks and not from srv networks 172.16.0.0/24, 172.16.5.0/24, 192.168.220.0/24 and more 5 alerts with the same thread in the last 24 hours","risk_score":47,"severity":"medium","license":"","output_index":"","timeline_id":"91832785-286d-4ebe-b884-1a208d111a70","timeline_title":"Generic Network Timeline","meta":{"from":"24h","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava"],"false_positives":[],"from":"now-86700s","rule_id":"5e5a82d7-7076-4f7a-a4cd-2fca278ef306","max_signals":100,"risk_score_mapping":[],"severity_mapping":[{"field":"fortinet.firewall.crlevel","value":"low","operator":"equals","severity":"low"},{"field":"fortinet.firewall.crlevel","value":"medium","operator":"equals","severity":"medium"},{"field":"fortinet.firewall.crlevel","value":"high","operator":"equals","severity":"high"},{"field":"fortinet.firewall.crlevel","value":"critical","operator":"equals","severity":"critical"}],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","reference":"https://attack.mitre.org/tactics/TA0002","name":"Execution"},"technique":[{"id":"T1203","reference":"https://attack.mitre.org/techniques/T1203","name":"Exploitation for Client Execution","subtechnique":[]}]}],"to":"now","references":[],"version":8,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"fortinet.firewall.subtype:\"virus\" AND NOT source.as.number:* AND destination.as.number:* AND NOT fortinet.firewall.severity:\"low\"  AND NOT (source.ip:[172.16.0.0 TO 172.16.0.255] OR source.ip:[172.16.5.0 TO 172.16.5.255] OR source.ip:[192.168.220.0 TO 192.168.220.255] OR source.ip:[172.16.124.0 TO 172.16.125.255]) AND fortinet.firewall.crlevel:*","filters":[],"threshold":{"field":["fortinet.firewall.virus"],"value":5,"cardinality":[]},"actions":[]}
{"id":"ad9bb760-5e88-11ed-af7b-4b4586cb86d2","updated_at":"2023-06-08T21:03:44.313Z","updated_by":"elastic","created_at":"2022-11-07T10:41:04.497Z","created_by":"elastic","name":"Wireless Open access point","tags":["octava","test","Custom Rules"],"interval":"5m","enabled":true,"revision":3,"description":"Wireless Open access point","risk_score":47,"severity":"medium","note":"Зафіксовано підключення пристрою з MAC адресою {{fortinet.firewall.stamac}} до мережі WiFi OPEN.\nEvents:\ntime_occured, time_ingested, wifi_ap, wifi_ssid, source_mac\n{{@timestamp}}, {{event.ingested}}, {{fortinet.firewall.ap}}, {{fortinet.firewall.ssid}}, {{fortinet.firewall.stamac}}","license":"","output_index":"","meta":{"from":"3m","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava"],"false_positives":[],"from":"now-480s","rule_id":"e6c5fdd0-706e-46ef-aebf-33b65f732a3a","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"reference":"https://attack.mitre.org/tactics/TA0001","name":"Initial Access","id":"TA0001"},"technique":[{"reference":"https://attack.mitre.org/techniques/T1078","name":"Valid Accounts","id":"T1078","subtechnique":[]}]}],"to":"now","references":[],"version":3,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":" fortinet.firewall.security:\"OPEN\" AND NOT fortinet.firewall.action:rogue*","filters":[],"threshold":{"field":["fortinet.firewall.stamac"],"value":1,"cardinality":[]},"actions":[]}
{"id":"8ec19910-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.144Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.862Z","created_by":"elastic","name":"Temporarily Scheduled Task Creation [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Persistence"],"interval":"5m","enabled":true,"revision":3,"description":"Indicates the creation and deletion of a scheduled task within a short time interval. Adversaries can use these to proxy malicious execution via the schedule service and perform clean up.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":"","author":["Elastic"],"false_positives":["Legitimate scheduled tasks may be created during installation of new software."],"from":"now-9m","rule_id":"8598760a-02a5-4a2e-be51-b098dfbf3d7b","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1053/","name":"Scheduled Task/Job","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1053/005/","name":"Scheduled Task","id":"T1053.005"}],"id":"T1053"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}}],"to":"now","references":["https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4698"],"version":3,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["winlogbeat-*","logs-system.*","logs-windows.*"],"query":"sequence by winlog.computer_name, winlog.event_data.TaskName with maxspan=5m\n   [iam where event.action == \"scheduled-task-created\" and not user.name : \"*$\"]\n   [iam where event.action == \"scheduled-task-deleted\" and not user.name : \"*$\"]\n","actions":[]}
{"id":"823e02d0-3912-11ed-b5fa-0d281afe1344","updated_at":"2023-06-08T21:03:44.313Z","updated_by":"elastic","created_at":"2022-09-20T18:31:57.568Z","created_by":"elastic","name":"Fortigate Outbreak IPS Internal Detection to External Direction","tags":["prod","Octava Defence","Custom Rules"],"interval":"5m","enabled":true,"revision":18,"description":"Fortigate IPS detection where source IP address from private networks and not from srv networks 172.16.0.0/24, 172.16.5.0/24, 192.168.220.0/24 and more 5 alerts with the same thread in the last 24 hours","risk_score":47,"severity":"medium","license":"","output_index":"","timeline_id":"91832785-286d-4ebe-b884-1a208d111a70","timeline_title":"Generic Network Timeline","meta":{"from":"24h","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava"],"false_positives":[],"from":"now-86700s","rule_id":"01f6b9d9-5e4d-4aac-b0dc-7cd4151c0e57","max_signals":100,"risk_score_mapping":[],"severity_mapping":[{"severity":"low","field":"fortinet.firewall.crlevel","value":"low","operator":"equals"},{"severity":"medium","field":"fortinet.firewall.crlevel","value":"medium","operator":"equals"},{"severity":"high","field":"fortinet.firewall.crlevel","value":"high","operator":"equals"},{"severity":"critical","field":"fortinet.firewall.crlevel","value":"critical","operator":"equals"}],"threat":[{"framework":"MITRE ATT&CK","tactic":{"reference":"https://attack.mitre.org/tactics/TA0002","name":"Execution","id":"TA0002"},"technique":[{"reference":"https://attack.mitre.org/techniques/T1203","name":"Exploitation for Client Execution","id":"T1203","subtechnique":[]}]}],"to":"now","references":[],"version":18,"exceptions_list":[{"id":"59858780-3e37-11ed-b5fa-0d281afe1344","list_id":"3ccd3bda-228c-4156-9ced-560bcfeab7e7","type":"detection","namespace_type":"single"}],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"fortinet.firewall.subtype:\"ips\" AND NOT source.as.number:* AND destination.as.number:* AND NOT fortinet.firewall.severity:\"low\" AND NOT (source.ip:[172.16.0.0 TO 172.16.0.255] OR source.ip:[172.16.5.0 TO 172.16.5.255] OR source.ip:[192.168.220.0 TO 192.168.220.255] OR source.ip:[172.16.124.0 TO 172.16.125.255]) AND NOT fortinet.firewall.attack:\"WebRTC.Local.IP.Addresses.Disclosure\"","filters":[],"threshold":{"field":["fortinet.firewall.attack"],"value":5,"cardinality":[]},"actions":[]}
{"id":"08a78e90-a867-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-06-08T21:03:44.306Z","updated_by":"elastic","created_at":"2023-02-09T10:46:40.727Z","created_by":"elastic","name":"CY-Unauthorized access to domain user/domain service accounts management","tags":["SOAR-CY-04","Custom Rules"],"interval":"5m","enabled":true,"revision":7,"description":"Unauthorized access to domain user\\domain service accounts management Обліковим записом \"winlog.event_data.SubjectUserName\" модифіковано персональний обліковий запис \"winlog.event_data.TargetUserName\". \\* \"winlog.event_data.TargetUserName\" не в технологической аушке домена *\\ Обліковим записом \"winlog.event_data.SubjectUserName\" модифіковано технологічний обліковий запис \"winlog.event_data.TargetUserName\". \\* \"winlog.event_data.TargetUserName\" В технологической аушке домена *\\\n","risk_score":47,"severity":"medium","license":"","output_index":"","meta":{"from":"1m","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":[],"false_positives":[],"from":"now-360s","rule_id":"a82a96c8-1669-4e29-a8f0-01e1a396fec3","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[],"to":"now","references":[],"version":7,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"event.code:\"4738\" AND (host.name:\"TH-DC1.torwell.local\" OR host.name:Hotelserver*) AND NOT winlog.event_data.SubjectUserName:*$ AND NOT winlog.event_data.SubjectUserName:\"ANONYMOUS LOGON\" ","filters":[],"threshold":{"field":["winlog.event_data.TargetUserName","winlog.event_data.SubjectUserName"],"value":1,"cardinality":[]},"actions":[]}
{"id":"3af7e310-551d-11ed-b5fa-0d281afe1344","updated_at":"2023-06-08T21:03:44.309Z","updated_by":"elastic","created_at":"2022-10-26T10:59:15.538Z","created_by":"elastic","name":"Unauthorized access to domain user/domain service accounts management","tags":["SOAR-UA-24","SOAR-UA-25","Custom Rules"],"interval":"5m","enabled":true,"revision":13,"description":"Unauthorized access to domain user\\domain service accounts management\nОбліковим записом \"winlog.event_data.SubjectUserName\" модифіковано персональний обліковий запис \"winlog.event_data.TargetUserName\".\n\n\\* \"winlog.event_data.TargetUserName\" не в технологической аушке домена *\\\n\nОбліковим записом \"winlog.event_data.SubjectUserName\" модифіковано технологічний обліковий запис \"winlog.event_data.TargetUserName\".\n\n\\* \"winlog.event_data.TargetUserName\" В технологической аушке домена *\\","risk_score":47,"severity":"medium","license":"","output_index":"","meta":{"from":"1m","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":[],"false_positives":[],"from":"now-360s","rule_id":"39f30877-a8e8-454c-a829-c1368c8624d5","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[],"to":"now","references":[],"version":13,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"event.code:\"4738\" AND NOT winlog.event_data.SubjectUserName:*$ AND NOT winlog.event_data.SubjectUserName:(\"ANONYMOUS LOGON\" OR \"bison\") AND NOT host.name:\"TH-DC1.torwell.local\" AND NOT host.name:HOTELSERVER*","filters":[],"threshold":{"field":["winlog.event_data.TargetUserName","winlog.event_data.SubjectUserName"],"value":1,"cardinality":[]},"actions":[]}
{"id":"e1313b00-6fe4-11ed-b6ee-234327f60bd6","updated_at":"2023-06-08T21:03:44.314Z","updated_by":"elastic","created_at":"2022-11-29T12:53:55.047Z","created_by":"elastic","name":"Unauthorized access to restricted network share files [Payment_changes]","tags":["SOAR-UA-23","Custom Rules"],"interval":"5m","enabled":true,"revision":6,"description":"Unauthorized access to restricted network share files [Payment_changes]","risk_score":21,"severity":"low","license":"","output_index":"","meta":{"from":"1m","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":[],"false_positives":[],"from":"now-360s","rule_id":"1d01a485-8754-466a-a09b-247f4fc23691","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[],"to":"now","references":[],"version":6,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"((event.code:5140 AND winlog.event_data.ShareName:*Payment_changes$ AND NOT winlog.event_data.SubjectUserName:*$ AND NOT winlog.event_data.SubjectUserName:\"fdlp-service-scan\") OR (event.code:4663 AND winlog.event_data.ObjectName:*Payment_changes*))","filters":[],"threshold":{"field":["winlog.event_data.SubjectUserName"],"value":2,"cardinality":[{"field":"event.code","value":2}]},"actions":[]}
{"id":"297ea440-9daa-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-06-08T21:03:44.314Z","updated_by":"elastic","created_at":"2023-01-26T18:49:29.449Z","created_by":"elastic","name":"Multiple failed authentication of one domain user account","tags":["SOAR-CY-02","Custom Rules"],"interval":"5m","enabled":true,"revision":2,"description":"Multiple failed authentication of one domain user account","risk_score":47,"severity":"medium","note":"Зафіксовано більше 3 подій неуспішної автентифікації користувача {{winlog.event_data.TargetUserName}} на контролері домену TH-DC1.torwell.local.\nEvents:\ntime_occured, time_ingested, action, source.ip, username, user_displayname, user_division, user_department, user_title, user_mobile\n{{@timestamp}}, {{event.ingested}}, {{event.action}}, {{source.ip}},  {{winlog.event_data.TargetUserName}}, {user_displayname}, {user_division}, {user_department}, {user_title}, {user_mobile}","license":"","output_index":"","meta":{"from":"1h","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":[],"false_positives":[],"from":"now-3900s","rule_id":"d0deb243-e770-4200-8ee9-33ff76237a2b","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","reference":"https://attack.mitre.org/tactics/TA0006","name":"Credential Access"},"technique":[{"id":"T1110","reference":"https://attack.mitre.org/techniques/T1110","name":"Brute Force","subtechnique":[]}]}],"to":"now","references":[],"version":2,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"kuery","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"host.name:\"TH-DC1.torwell.local\" AND event.code:(4771 OR 4625 OR 4776) AND NOT winlog.event_data.Status:\"0x0\"","filters":[],"threshold":{"field":["winlog.event_data.TargetUserName"],"value":4,"cardinality":[]},"actions":[]}
{"id":"88b20ad0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.890Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.697Z","created_by":"elastic","name":"Potential Reverse Shell Activity via Terminal [Duplicate]","tags":["Elastic","Host","Linux","macOS","Threat Detection","Execution","Investigation Guide"],"interval":"5m","enabled":true,"revision":103,"description":"Identifies the execution of a shell process with suspicious arguments which may be indicative of reverse shell activity.","risk_score":73,"severity":"high","note":"## Triage and analysis\n\n### Investigating Potential Reverse Shell Activity via Terminal\n\nA reverse shell is a mechanism that's abused to connect back to an attacker-controlled system. It effectively redirects the system's input and output and delivers a fully functional remote shell to the attacker. Even private systems are vulnerable since the connection is outgoing. This activity is typically the result of vulnerability exploitation, malware infection, or penetration testing.\n\nThis rule identifies commands that are potentially related to reverse shell activities using shell applications.\n\n#### Possible investigation steps\n\n- Examine the command line and extract the target domain or IP address information.\n  - Check if the domain is newly registered or unexpected.\n  - Check the reputation of the domain or IP address.\n  - Scope other potentially compromised hosts in your environment by mapping hosts that also communicated with the domain or IP address.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Investigate any abnormal account behavior, such as command executions, file creations or modifications, and network connections.\n- Investigate any abnormal behavior by the subject process such as network connections, file modifications, and any spawned child processes.\n\n### False positive analysis\n\n- This activity is unlikely to happen legitimately. Any activity that triggered the alert and is not inherently malicious must be monitored by the security team.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Take actions to terminate processes and connections used by the attacker.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"d3270075-33e3-43b4-885d-7b52506fa355","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1059/","name":"Command and Scripting Interpreter","id":"T1059"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002/","name":"Execution","id":"TA0002"}}],"to":"now","references":["https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md","https://github.com/WangYihang/Reverse-Shell-Manager","https://www.netsparker.com/blog/web-security/understanding-reverse-shells/"],"version":103,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-endpoint.events.*"],"query":"process where event.type in (\"start\", \"process_started\") and\n  process.name in (\"sh\", \"bash\", \"zsh\", \"dash\", \"zmodload\") and\n  process.args : (\"*/dev/tcp/*\", \"*/dev/udp/*\", \"*zsh/net/tcp*\", \"*zsh/net/udp*\") and\n\n  /* noisy FPs */\n  not (process.parent.name : \"timeout\" and process.executable : \"/var/lib/docker/overlay*\") and\n  not process.command_line : (\"*/dev/tcp/sirh_db/*\", \"*/dev/tcp/remoteiot.com/*\", \"*dev/tcp/elk.stag.one/*\", \"*dev/tcp/kafka/*\", \"*/dev/tcp/$0/$1*\", \"*/dev/tcp/127.*\", \"*/dev/udp/127.*\", \"*/dev/tcp/localhost/*\") and\n  not process.parent.command_line : \"runc init\"\n","actions":[]}
{"id":"8990f920-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.886Z","updated_by":"elastic","created_at":"2023-03-15T15:32:04.184Z","created_by":"elastic","name":"Security Software Discovery via Grep [Duplicate]","tags":["Elastic","Host","macOS","Linux","Threat Detection","Discovery","Investigation Guide"],"interval":"5m","enabled":true,"revision":103,"description":"Identifies the use of the grep command to discover known third-party macOS and Linux security tools, such as Antivirus or Host Firewall details.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n\n### Investigating Security Software Discovery via Grep\n\nAfter successfully compromising an environment, attackers may try to gain situational awareness to plan their next steps. This can happen by running commands to enumerate network resources, users, connections, files, and installed security software.\n\nThis rule looks for the execution of the `grep` utility with arguments compatible to the enumeration of the security software installed on the host. Attackers can use this information to decide whether or not to infect a system, disable protections, use bypasses, etc.\n\n#### Possible investigation steps\n\n- Investigate the process execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence and whether they are located in expected locations.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Investigate any abnormal account behavior, such as command executions, file creations or modifications, and network connections.\n- Investigate any abnormal behavior by the subject process such as network connections, file modifications, and any spawned child processes.\n- Inspect the host for suspicious or abnormal behavior in the alert timeframe.\n- Validate the activity is not related to planned patches, updates, network administrator activity, or legitimate software installations.\n\n### False positive analysis\n\n- Discovery activities are not inherently malicious if they occur in isolation. As long as the analyst did not identify suspicious activity related to the user or host, such alerts can be dismissed.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved hosts to prevent further post-compromise behavior.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection via the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Endpoint Security installers, updaters and post installation verification scripts."],"from":"now-9m","rule_id":"cdc98f41-2b2e-4007-b2de-cca6057bdcda","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1518/","name":"Software Discovery","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1518/001/","name":"Security Software Discovery","id":"T1518.001"}],"id":"T1518"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0007/","name":"Discovery","id":"TA0007"}}],"to":"now","references":[],"version":103,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["logs-endpoint.events.*","auditbeat-*"],"query":"process where event.type == \"start\" and\nprocess.name : \"grep\" and user.id != \"0\" and\n not process.parent.executable : \"/Library/Application Support/*\" and\n   process.args :\n         (\"Little Snitch*\",\n          \"Avast*\",\n          \"Avira*\",\n          \"ESET*\",\n          \"BlockBlock*\",\n          \"360Sec*\",\n          \"LuLu*\",\n          \"KnockKnock*\",\n          \"kav\",\n          \"KIS\",\n          \"RTProtectionDaemon*\",\n          \"Malware*\",\n          \"VShieldScanner*\",\n          \"WebProtection*\",\n          \"webinspectord*\",\n          \"McAfee*\",\n          \"isecespd*\",\n          \"macmnsvc*\",\n          \"masvc*\",\n          \"kesl*\",\n          \"avscan*\",\n          \"guard*\",\n          \"rtvscand*\",\n          \"symcfgd*\",\n          \"scmdaemon*\",\n          \"symantec*\",\n          \"sophos*\",\n          \"osquery*\",\n          \"elastic-endpoint*\"\n          ) and\n   not (process.args : \"Avast\" and process.args : \"Passwords\")\n","actions":[]}
{"id":"8ebeb2e0-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.149Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.819Z","created_by":"elastic","name":"Sensitive Privilege SeEnableDelegationPrivilege assigned to a User [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Credential Access","Active Directory","Investigation Guide"],"interval":"5m","enabled":true,"revision":104,"description":"Identifies the assignment of the SeEnableDelegationPrivilege sensitive \"user right\" to a user. The SeEnableDelegationPrivilege \"user right\" enables computer and user accounts to be trusted for delegation. Attackers can abuse this right to compromise Active Directory accounts and elevate their privileges.","risk_score":73,"severity":"high","note":"## Triage and analysis\n\n### Investigating Sensitive Privilege SeEnableDelegationPrivilege assigned to a User\n\nKerberos delegation is an Active Directory feature that allows user and computer accounts to impersonate other accounts, act on their behalf, and use their privileges. Delegation (constrained and unconstrained) can be configured for user and computer objects.\n\nEnabling unconstrained delegation for a computer causes the computer to store the ticket-granting ticket (TGT) in memory at any time an account connects to the computer, so it can be used by the computer for impersonation when needed. Risk is heightened if an attacker compromises computers with unconstrained delegation enabled, as they could extract TGTs from memory and then replay them to move laterally on the domain. If the attacker coerces a privileged user to connect to the server, or if the user does so routinely, the account will be compromised and the attacker will be able to pass-the-ticket to privileged assets.\n\nSeEnableDelegationPrivilege is a user right that is controlled within the Local Security Policy of a domain controller and is managed through Group Policy. This setting is named **Enable computer and user accounts to be trusted for delegation**.\n\nIt is critical to control the assignment of this privilege. A user with this privilege and write access to a computer can control delegation settings, perform the attacks described above, and harvest TGTs from any user that connects to the system.\n\n#### Possible investigation steps\n\n- Investigate how the privilege was assigned to the user and who assigned it.\n- Investigate other potentially malicious activity that was performed by the user that assigned the privileges using the `user.id` and `winlog.activity_id` fields as a filter during the past 48 hours.\n- Investigate other alerts associated with the users/host during the past 48 hours.\n\n### False positive analysis\n\n- The SeEnableDelegationPrivilege privilege should not be assigned to users. If this rule is triggered in your environment legitimately, the security team should notify the administrators about the risks of using it.\n\n### Related rules\n\n- KRBTGT Delegation Backdoor - e052c845-48d0-4f46-8a13-7d0aba05df82\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Remove the privilege from the account.\n- Review the privileges of the administrator account that performed the action.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"263bf951-4015-4f78-b586-2b3baa136a22","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0006/","name":"Credential Access","id":"TA0006"}},{"framework":"MITRE ATT&CK","technique":[],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}}],"to":"now","references":["https://blog.harmj0y.net/activedirectory/the-most-dangerous-user-right-you-probably-have-never-heard-of/","https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/security/win_alert_active_directory_user_control.yml","https://twitter.com/_nwodtuhs/status/1454049485080907776","https://www.thehacker.recipes/ad/movement/kerberos/delegations","https://github.com/atc-project/atomic-threat-coverage/blob/master/Atomic_Threat_Coverage/Logging_Policies/LP_0105_windows_audit_authorization_policy_change.md"],"version":104,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["winlogbeat-*","logs-system.*","logs-windows.*"],"query":"event.action: \"Authorization Policy Change\" and event.code:4704 and winlog.event_data.PrivilegeList:\"SeEnableDelegationPrivilege\"\n","actions":[]}
{"id":"886c4f40-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:42.905Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.261Z","created_by":"elastic","name":"Elastic Agent Service Terminated [Duplicate]","tags":["Elastic","Host","Linux","Windows","macOS","Threat Detection","Defense Evasion"],"interval":"5m","enabled":true,"revision":101,"description":"Identifies the Elastic endpoint agent has stopped and is no longer running on the host. Adversaries may attempt to disable security monitoring tools in an attempt to evade detection or prevention capabilities during an intrusion. This may also indicate an issue with the agent itself and should be addressed to ensure defensive measures are back in a stable state.","risk_score":47,"severity":"medium","note":"","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"a16602b1-c757-4cc6-ac02-40b20ebbc914","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1562/","name":"Impair Defenses","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1562/001/","name":"Disable or Modify Tools","id":"T1562.001"}],"id":"T1562"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0005/","name":"Defense Evasion","id":"TA0005"}}],"to":"now","references":[],"version":101,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["logs-endpoint.events.*"],"query":"process where\n/* net, sc or wmic stopping or deleting Elastic Agent on Windows */\n(event.type == \"start\" and\n  process.name : (\"net.exe\", \"sc.exe\", \"wmic.exe\",\"powershell.exe\",\"taskkill.exe\",\"PsKill.exe\",\"ProcessHacker.exe\") and\n  process.args : (\"stopservice\",\"uninstall\", \"stop\", \"disabled\",\"Stop-Process\",\"terminate\",\"suspend\") and\n  process.args : (\"elasticendpoint\", \"Elastic Agent\",\"elastic-agent\",\"elastic-endpoint\"))\nor\n/* service or systemctl used to stop Elastic Agent on Linux */\n(event.type == \"end\" and\n  (process.name : (\"systemctl\", \"service\") and\n    process.args : \"elastic-agent\" and\n    process.args : \"stop\")\n  or\n  /* Unload Elastic Agent extension on MacOS */\n  (process.name : \"kextunload\" and\n    process.args : \"com.apple.iokit.EndpointSecurity\" and\n    event.action : \"end\"))\n","actions":[]}
{"id":"88783620-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T15:34:55.602Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.391Z","created_by":"elastic","name":"Hosts File Modified [Duplicate]","tags":["Elastic","Host","Linux","Windows","macOS","Threat Detection","Impact","Investigation Guide"],"interval":"5m","enabled":true,"revision":103,"description":"The hosts file on endpoints is used to control manual IP address to hostname resolutions. The hosts file is the first point of lookup for DNS hostname resolution so if adversaries can modify the endpoint hosts file, they can route traffic to malicious infrastructure. This rule detects modifications to the hosts file on Microsoft Windows, Linux (Ubuntu or RHEL) and macOS systems.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n\n### Investigating Hosts File Modified\n\nOperating systems use the hosts file to map a connection between an IP address and domain names before going to domain name servers. Attackers can abuse this mechanism to route traffic to malicious infrastructure or disrupt security that depends on server communications. For example, Russian threat actors modified this file on a domain controller to redirect Duo MFA calls to localhost instead of the Duo server, which prevented the MFA service from contacting its server to validate MFA login. This effectively disabled MFA for active domain accounts because the default policy of Duo for Windows is to \"Fail open\" if the MFA server is unreachable. This can happen in any MFA implementation and is not exclusive to Duo. Find more details in this [CISA Alert](https://www.cisa.gov/uscert/ncas/alerts/aa22-074a).\n\nThis rule identifies modifications in the hosts file across multiple operating systems using process creation events for Linux and file events in Windows and macOS.\n\n#### Possible investigation steps\n\n- Identify the specifics of the involved assets, such as role, criticality, and associated users.\n- Investigate the process execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Identify the user account that performed the action and whether it should perform this kind of action.\n- Contact the account owner and confirm whether they are aware of this activity.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Examine the changes to the hosts file by comparing it against file backups, volume shadow copies, and other restoration mechanisms.\n\n### False positive analysis\n\n- This mechanism can be used legitimately. Analysts can dismiss the alert if the administrator is aware of the activity and the configuration was justified.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Consider isolating the involved host to prevent further post-compromise behavior.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Review the privileges of the administrator account that performed the action.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).","license":"Elastic License v2","output_index":".siem-signals-default","timeline_id":"4d4c0b59-ea83-483f-b8c1-8c360ee53c5c","timeline_title":"Comprehensive File Timeline","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"ed993a71-6cc4-4cc7-9298-4e791c1d82c9","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1565/","name":"Data Manipulation","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1565/001/","name":"Stored Data Manipulation","id":"T1565.001"}],"id":"T1565"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0040/","name":"Impact","id":"TA0040"}}],"to":"now","references":["https://www.elastic.co/guide/en/beats/auditbeat/current/auditbeat-reference-yml.html"],"version":103,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","winlogbeat-*","logs-endpoint.events.*","logs-windows.*"],"query":"any where\n\n  /* file events for creation; file change events are not captured by some of the included sources for linux and so may\n     miss this, which is the purpose of the process + command line args logic below */\n  (\n   event.category == \"file\" and event.type in (\"change\", \"creation\") and\n     file.path : (\"/private/etc/hosts\", \"/etc/hosts\", \"?:\\\\Windows\\\\System32\\\\drivers\\\\etc\\\\hosts\")\n  )\n  or\n\n  /* process events for change targeting linux only */\n  (\n   event.category == \"process\" and event.type in (\"start\") and\n     process.name in (\"nano\", \"vim\", \"vi\", \"emacs\", \"echo\", \"sed\") and\n     process.args : (\"/etc/hosts\")\n  )\n","actions":[]}
{"id":"51314800-d962-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-13T12:51:35.958Z","updated_by":"elastic","created_at":"2023-04-12T18:46:21.061Z","created_by":"elastic","name":"Potential Credential Access via DCSync [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Credential Access","Active Directory","Investigation Guide"],"interval":"5m","enabled":true,"revision":105,"description":"This rule identifies when a User Account starts the Active Directory Replication Process. Attackers can use the DCSync technique to get credential information of individual accounts or the entire domain, thus compromising the entire domain.","risk_score":73,"severity":"high","note":"## Triage and analysis\n\n### Investigating Potential Credential Access via DCSync\n\nActive Directory replication is the process by which the changes that originate on one domain controller are automatically transferred to other domain controllers that store the same data.\n\nActive Directory data consists of objects that have properties, or attributes. Each object is an instance of an object class, and object classes and their respective attributes are defined in the Active Directory schema. Objects are defined by the values of their attributes, and changes to attribute values must be transferred from the domain controller on which they occur to every other domain controller that stores a replica of an affected object.\n\nAdversaries can use the DCSync technique that uses Windows Domain Controller's API to simulate the replication process from a remote domain controller, compromising major credential material such as the Kerberos krbtgt keys used legitimately for tickets creation, but also tickets forging by attackers. This attack requires some extended privileges to succeed (DS-Replication-Get-Changes and DS-Replication-Get-Changes-All), which are granted by default to members of the Administrators, Domain Admins, Enterprise Admins, and Domain Controllers groups. Privileged accounts can be abused to grant controlled objects the right to DCsync/Replicate.\n\nMore details can be found on [Threat Hunter Playbook](https://threathunterplaybook.com/library/windows/active_directory_replication.html?highlight=dcsync#directory-replication-services-auditing) and [The Hacker Recipes](https://www.thehacker.recipes/ad/movement/credentials/dumping/dcsync).\n\nThis rule monitors for Event ID 4662 (Operation was performed on an Active Directory object) and identifies events that use the access mask 0x100 (Control Access) and properties that contain at least one of the following or their equivalent: Schema-Id-GUID (DS-Replication-Get-Changes, DS-Replication-Get-Changes-All, DS-Replication-Get-Changes-In-Filtered-Set). It also filters out events that use computer accounts and also Azure AD Connect MSOL accounts (more details [here](https://techcommunity.microsoft.com/t5/microsoft-defender-for-identity/ad-connect-msol-user-suspected-dcsync-attack/m-p/788028)).\n\n#### Possible investigation steps\n\n- Identify the user account that performed the action and whether it should perform this kind of action.\n- Contact the account and system owners and confirm whether they are aware of this activity.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Correlate security events 4662 and 4624 (Logon Type 3) by their Logon ID (`winlog.logon.id`) on the Domain Controller (DC) that received the replication request. This will tell you where the AD replication request came from, and if it came from another DC or not.\n- Scope which credentials were compromised (for example, whether all accounts were replicated or specific ones).\n\n### False positive analysis\n\n- Administrators may use custom accounts on Azure AD Connect, investigate if it is the case, and if it is properly secured. If noisy in your environment due to expected activity, consider adding the corresponding account as a exception.\n- Although replicating Active Directory (AD) data to non-Domain Controllers is not a common practice and is generally not recommended from a security perspective, some software vendors may require it for their products to function correctly. If this rule is noisy in your environment due to expected activity, consider adding the corresponding account as a exception.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- If specific credentials were compromised:\n  - Reset the password for these accounts and other potentially compromised credentials, like email, business systems, and web services.\n- If the entire domain or the `krbtgt` user were compromised:\n  - Activate your incident response plan for total Active Directory compromise which should include, but not be limited to, a password reset (twice) of the `krbtgt` user.\n- Investigate how the attacker escalated privileges and identify systems they used to conduct lateral movement. Use this information to scope ways that the attacker could use to regain access to the environment.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"855f41e6-6424-4c8e-b668-7b67cbed70da","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"reference":"https://attack.mitre.org/tactics/TA0006/","name":"Credential Access","id":"TA0006"},"technique":[{"reference":"https://attack.mitre.org/techniques/T1003/","name":"OS Credential Dumping","id":"T1003","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1003/006/","name":"DCSync","id":"T1003.006"}]}]}],"to":"now","references":["https://threathunterplaybook.com/notebooks/windows/06_credential_access/WIN-180815210510.html","https://threathunterplaybook.com/library/windows/active_directory_replication.html?highlight=dcsync#directory-replication-services-auditing","https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/security/win_ad_replication_non_machine_account.yml","https://github.com/atc-project/atomic-threat-coverage/blob/master/Atomic_Threat_Coverage/Logging_Policies/LP_0027_windows_audit_directory_service_access.md","https://attack.stealthbits.com/privilege-escalation-using-mimikatz-dcsync","https://www.thehacker.recipes/ad/movement/credentials/dumping/dcsync"],"version":105,"exceptions_list":[{"id":"ec15d010-d9f9-11ed-9bbb-69b1ad2deb7a","list_id":"445acd60-d009-4723-9bf6-b241c7b9ad5c","type":"detection","namespace_type":"single"}],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["winlogbeat-*","logs-system.*","logs-windows.*"],"query":"any where event.action == \"Directory Service Access\" and\n  event.code == \"4662\" and winlog.event_data.Properties : (\n\n    /* Control Access Rights/Permissions Symbol */\n\n    \"*DS-Replication-Get-Changes*\",\n    \"*DS-Replication-Get-Changes-All*\",\n    \"*DS-Replication-Get-Changes-In-Filtered-Set*\",\n\n    /* Identifying GUID used in ACE */\n\n    \"*1131f6ad-9c07-11d1-f79f-00c04fc2dcd2*\",\n    \"*1131f6aa-9c07-11d1-f79f-00c04fc2dcd2*\",\n    \"*89e95b76-444d-4c62-991a-0facbeda640c*\")\n\n    /* The right to perform an operation controlled by an extended access right. */\n\n    and winlog.event_data.AccessMask : \"0x100\" and\n    not winlog.event_data.SubjectUserName : (\"*$\", \"MSOL_*\", \"OpenDNS_Connector\")\n\n    /* The Umbrella AD Connector uses the OpenDNS_Connector account to perform replication */\n","actions":[]}
{"id":"8668e790-2629-11ed-a6d5-7b380a06d8af","updated_at":"2023-06-08T21:03:44.310Z","updated_by":"elastic","created_at":"2022-08-27T16:58:51.364Z","created_by":"elastic","name":"SSL Remote VPN from two countries","tags":["Octava Defence","prod","Custom Rules"],"interval":"5m","enabled":true,"revision":12,"description":"One user connected by SSL Remote VPN from two countries within 24 hours","risk_score":73,"severity":"high","license":"","output_index":"","meta":{"from":"24h","kibana_siem_app_url":"https://192.168.101.14:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava"],"false_positives":[],"from":"now-86700s","rule_id":"7f6d541a-ebd9-40b2-8bd3-e27bcf9efa78","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0001","reference":"https://attack.mitre.org/tactics/TA0001","name":"Initial Access"},"technique":[{"id":"T1078","reference":"https://attack.mitre.org/techniques/T1078","name":"Valid Accounts","subtechnique":[]}]}],"to":"now","references":[],"version":12,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"fortinet.firewall.action:\"tunnel-up\" AND fortinet.firewall.reason:\"login successfully\" AND destination.geo.country_name:* AND NOT destination.as.organization.name:(\"Kyivstar PJSC\" OR \"PrJSC VF UKRAINE\" OR \"Limited Liability Company lifecell\" OR \"SPACEX-STARLINK\")","filters":[],"threshold":{"field":["source.user.name"],"value":2,"cardinality":[{"field":"destination.geo.country_name","value":2}]},"actions":[]}
{"id":"93095b40-4480-11ed-b5fa-0d281afe1344","updated_at":"2023-06-29T11:19:40.246Z","updated_by":"elastic","created_at":"2022-10-05T07:37:33.177Z","created_by":"elastic","name":"Fortigate IPS Internal Detection to Internal Direction","tags":["Ocatva Defence","prod","Custom Rules"],"interval":"5m","enabled":true,"revision":11,"description":"Fortigate IPS Internal Detection to Internal Direction","risk_score":47,"severity":"medium","license":"","output_index":"","meta":{"from":"3m","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava Defence"],"false_positives":[],"from":"now-480s","rule_id":"28cb99b0-dfee-491c-8571-badf21950b4d","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"reference":"https://attack.mitre.org/tactics/TA0002","name":"Execution","id":"TA0002"},"technique":[{"reference":"https://attack.mitre.org/techniques/T1203","name":"Exploitation for Client Execution","id":"T1203","subtechnique":[]}]}],"to":"now","references":[],"version":10,"exceptions_list":[{"id":"02848180-0e8d-11ee-82b6-b1835b5ce684","list_id":"1ae9c0fa-ca31-4ede-8b0f-a2e6461d5f4e","type":"detection","namespace_type":"single"},{"id":"d5c81fa0-166e-11ee-ad8e-610914274334","list_id":"d4d8d782-e4b1-48c2-9126-cabee5f2130a","type":"rule_default","namespace_type":"single"}],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"fortinet.firewall.subtype:\"ips\" AND source.ip:([10.0.0.0 TO 10.255.255.255] OR [172.16.0.0 TO 172.31.255.255] OR [192.168.0.0 TO 192.168.255.255]) AND destination.ip:([10.0.0.0 TO 10.255.255.255] OR [172.16.0.0 TO 172.31.255.255] OR [192.168.0.0 TO 192.168.255.255]) AND NOT fortinet.firewall.severity:\"low\" AND NOT fortinet.firewall.attack: \"Apple.QuickTime.JPEG.2000.Marker.Size.Heap.Overflow\"","filters":[],"threshold":{"field":["fortinet.firewall.attack"],"value":1,"cardinality":[]},"actions":[]}
{"id":"886a2c60-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:42.912Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.288Z","created_by":"elastic","name":"Auditd Login from Forbidden Location [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Initial Access"],"interval":"5m","enabled":true,"revision":1,"description":"Identifies that a login attempt has happened from a forbidden location.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-6m","rule_id":"ce20256b-82e2-4d84-a62f-1f15633ae45c","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1078/","name":"Valid Accounts","id":"T1078"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0001/","name":"Initial Access","id":"TA0001"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1078/","name":"Valid Accounts","id":"T1078"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}}],"to":"now","references":["https://github.com/linux-pam/linux-pam/blob/aac5a8fdc4aa3f7e56335a6343774cc1b63b408d/modules/pam_access/pam_access.c#L412"],"version":1,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*"],"query":"event.module:auditd and event.action:\"attempted-log-in-from-unusual-place-to\"\n","actions":[]}
{"id":"8ec0fcd0-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.146Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.855Z","created_by":"elastic","name":"Signed Proxy Execution via MS Work Folders [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Defense Evasion","Investigation Guide","Elastic Endgame"],"interval":"5m","enabled":true,"revision":103,"description":"Identifies the use of Windows Work Folders to execute a potentially masqueraded control.exe file in the current working directory. Misuse of Windows Work Folders could indicate malicious activity.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n\n### Investigating Signed Proxy Execution via MS Work Folders\n\nWork Folders is a role service for file servers running Windows Server that provides a consistent way for users to access their work files from their PCs and devices. This allows users to store work files and access them from anywhere. When called, Work Folders will automatically execute any Portable Executable (PE) named control.exe as an argument before accessing the synced share.\n\nUsing Work Folders to execute a masqueraded control.exe could allow an adversary to bypass application controls and increase privileges.\n\n#### Possible investigation steps\n\n- Investigate the process execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n    - Examine the location of the WorkFolders.exe binary to determine if it was copied to the location of the control.exe binary. It resides in the System32 directory by default.\n- Trace the activity related to the control.exe binary to identify any continuing intrusion activity on the host.\n- Review the control.exe binary executed with Work Folders to determine maliciousness such as additional host activity or network traffic.\n- Determine if control.exe was synced to sync share, indicating potential lateral movement.\n- Review how control.exe was originally delivered on the host, such as emailed, downloaded from the web, or written to\ndisk from a separate binary.\n\n### False positive analysis\n\n- Windows Work Folders are used legitimately by end users and administrators for file sharing and syncing but not in the instance where a suspicious control.exe is passed as an argument.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- Review the Work Folders synced share to determine if the control.exe was shared and if so remove it.\n- If no lateral movement was identified during investigation, take the affected host offline if possible and remove the control.exe binary as well as any additional artifacts identified during investigation.\n- Review integrating Windows Information Protection (WIP) to enforce data protection by encrypting the data on PCs using Work Folders.\n- Confirm with the user whether this was expected or not, and reset their password.","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic","Austin Songer"],"false_positives":[],"from":"now-9m","rule_id":"04ede354-b68d-44b9-9337-0dea4da2fb9a","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1218/","name":"System Binary Proxy Execution","id":"T1218"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0005/","name":"Defense Evasion","id":"TA0005"}}],"to":"now","references":["https://docs.microsoft.com/en-us/windows-server/storage/work-folders/work-folders-overview","https://twitter.com/ElliotKillick/status/1449812843772227588","https://lolbas-project.github.io/lolbas/Binaries/WorkFolders/"],"version":103,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["winlogbeat-*","logs-windows.*","endgame-*"],"query":"process where event.type == \"start\"\n    and process.name : \"control.exe\" and process.parent.name : \"WorkFolders.exe\"\n    and not process.executable : (\"?:\\\\Windows\\\\System32\\\\control.exe\", \"?:\\\\Windows\\\\SysWOW64\\\\control.exe\")\n","actions":[]}
{"id":"8ec51b80-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.162Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.881Z","created_by":"elastic","name":"Suspicious LSASS Access via MalSecLogon [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Credential Access","Sysmon Only"],"interval":"5m","enabled":true,"revision":102,"description":"Identifies suspicious access to LSASS handle from a call trace pointing to seclogon.dll and with a suspicious access rights value. This may indicate an attempt to leak an LSASS handle via abusing the Secondary Logon service in preparation for credential access.","risk_score":73,"severity":"high","note":"","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"592ecbb5-a4f0-44bd-9749-ba2c8768fece","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1003/","name":"OS Credential Dumping","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1003/001/","name":"LSASS Memory","id":"T1003.001"}],"id":"T1003"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0006/","name":"Credential Access","id":"TA0006"}}],"to":"now","references":["https://splintercod3.blogspot.com/p/the-hidden-side-of-seclogon-part-3.html"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["winlogbeat-*","logs-windows.*"],"query":"process where event.code == \"10\" and\n  winlog.event_data.TargetImage : \"?:\\\\WINDOWS\\\\system32\\\\lsass.exe\" and\n\n   /* seclogon service accessing lsass */\n  winlog.event_data.CallTrace : \"*seclogon.dll*\" and process.name : \"svchost.exe\" and\n\n   /* PROCESS_CREATE_PROCESS & PROCESS_DUP_HANDLE & PROCESS_QUERY_INFORMATION */\n  winlog.event_data.GrantedAccess == \"0x14c0\"\n","actions":[]}
{"id":"8ec1c020-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.151Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.892Z","created_by":"elastic","name":"PowerShell PSReflect Script [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Execution","Investigation Guide","PowerShell"],"interval":"5m","enabled":true,"revision":104,"description":"Detects the use of PSReflect in PowerShell scripts. Attackers leverage PSReflect as a library that enables PowerShell to access win32 API functions.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n\n### Investigating PowerShell PSReflect Script\n\nPowerShell is one of the main tools system administrators use for automation, report routines, and other tasks. This makes it available for use in various environments, and creates an attractive way for attackers to execute code.\n\nPSReflect is a library that enables PowerShell to access win32 API functions in an uncomplicated way. It also helps to create enums and structs easily—all without touching the disk.\n\nAlthough this is an interesting project for every developer and admin out there, it is mainly used in the red team and malware tooling for its capabilities.\n\nDetecting the core implementation of PSReflect means detecting most of the tooling that uses Windows API through PowerShell, enabling defenders to discover tools being dropped in the environment.\n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/master/invest-guide-run-osquery.html) introduced in Elastic stack version 8.5.0. Older Elastic stacks versions will see unrendered markdown in this guide.\n\n#### Possible investigation steps\n\n- Examine the script content that triggered the detection; look for suspicious DLL imports, collection or exfiltration capabilities, suspicious functions, encoded or compressed data, and other potentially malicious characteristics. The script content that may be split into multiple script blocks (you can use the field `powershell.file.script_block_id` for filtering).\n- Investigate the script execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Check for additional PowerShell and command-line logs that indicate that imported functions were run.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Evaluate whether the user needs to use PowerShell to complete tasks.\n- Examine the host for derived artifacts that indicates suspicious activities:\n  - Analyze the script using a private sandboxed analysis system.\n  - Observe and collect information about the following activities in both the sandbox and the alert subject host:\n    - Attempts to contact external domains and addresses.\n      - Use the Elastic Defend network events to determine domains and addresses contacted by the subject process by filtering by the process' `process.entity_id`.\n      - Examine the DNS cache for suspicious or anomalous entries.\n        - !{osquery{\"query\":\"SELECT * FROM dns_cache\", \"label\":\"Osquery - Retrieve DNS Cache\"}}\n    - Use the Elastic Defend registry events to examine registry keys accessed, modified, or created by the related processes in the process tree.\n    - Examine the host services for suspicious or anomalous entries.\n      - !{osquery{\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services\",\"label\":\"Osquery - Retrieve All Services\"}}\n      - !{osquery{\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services WHERE NOT (user_account LIKE '%LocalSystem' OR user_account LIKE '%LocalService' OR user_account LIKE '%NetworkService' OR user_account == null)\",\"label\":\"Osquery - Retrieve Services Running on User Accounts\"}}\n      - !{osquery{\"query\":\"SELECT concat('https://www.virustotal.com/gui/file/', sha1) AS VtLink, name, description, start_type, status, pid, services.path FROM services JOIN authenticode ON services.path = authenticode.path OR services.module_path = authenticode.path JOIN hash ON services.path = hash.path WHERE authenticode.result != 'trusted'\",\"label\":\"Osquery - Retrieve Service Unsigned Executables with Virustotal Link\"}}\n  - Retrieve the files' SHA-256 hash values using the PowerShell `Get-FileHash` cmdlet and search for the existence and reputation of the hashes in resources like VirusTotal, Hybrid-Analysis, CISCO Talos, Any.run, etc.\n- Investigate potentially compromised accounts. Analysts can do this by searching for login events (for example, 4624) to the target host after the registry modification.\n\n### False positive analysis\n\n- This activity is unlikely to happen legitimately. Benign true positives (B-TPs) can be added as exceptions if necessary.\n\n### Related rules\n\n- PowerShell Suspicious Discovery Related Windows API Functions - 61ac3638-40a3-44b2-855a-985636ca985e\n- PowerShell Keylogging Script - bd2c86a0-8b61-4457-ab38-96943984e889\n- PowerShell Suspicious Script with Audio Capture Capabilities - 2f2f4939-0b34-40c2-a0a3-844eb7889f43\n- Potential Process Injection via PowerShell - 2e29e96a-b67c-455a-afe4-de6183431d0d\n- Suspicious .NET Reflection via PowerShell - e26f042e-c590-4e82-8e05-41e81bd822ad\n- PowerShell Suspicious Payload Encoded and Compressed - 81fe9dc6-a2d7-4192-a2d8-eed98afc766a\n- PowerShell Suspicious Script with Screenshot Capabilities - 959a7353-1129-4aa7-9084-30746b256a70\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved hosts to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors like reverse shells, reverse proxies, or droppers that attackers could use to reinfect the system.\n- Remove and block malicious artifacts identified during triage.\n- Restrict PowerShell usage outside of IT and engineering business units using GPOs, AppLocker, Intune, or similar software.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Legitimate PowerShell scripts that make use of PSReflect to access the win32 API"],"from":"now-9m","rule_id":"1d4638cf-d89e-4e29-82e0-06065da42d39","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1059/","name":"Command and Scripting Interpreter","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1059/001/","name":"PowerShell","id":"T1059.001"}],"id":"T1059"},{"reference":"https://attack.mitre.org/techniques/T1106/","name":"Native API","id":"T1106"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002/","name":"Execution","id":"TA0002"}}],"to":"now","references":["https://github.com/mattifestation/PSReflect/blob/master/PSReflect.psm1","https://github.com/atc-project/atc-data/blob/master/docs/Logging_Policies/LP_0109_windows_powershell_script_block_log.md"],"version":104,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["winlogbeat-*","logs-windows.*"],"query":"event.category:process and\n  powershell.file.script_block_text:(\n    \"New-InMemoryModule\" or\n    \"Add-Win32Type\" or\n    psenum or\n    DefineDynamicAssembly or\n    DefineDynamicModule or\n    \"Reflection.TypeAttributes\" or\n    \"Reflection.Emit.OpCodes\" or\n    \"Reflection.Emit.CustomAttributeBuilder\" or\n    \"Runtime.InteropServices.DllImportAttribute\"\n  ) and not user.id : \"S-1-5-18\"\n","actions":[]}
{"id":"886c7650-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:42.906Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.258Z","created_by":"elastic","name":"Auditd Max Failed Login Attempts [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Initial Access"],"interval":"5m","enabled":true,"revision":1,"description":"Identifies that the maximum number of failed login attempts has been reached for a user.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-6m","rule_id":"f38168a7-7ffd-4dec-910f-9ae61bf2e176","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1078/","name":"Valid Accounts","id":"T1078"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0001/","name":"Initial Access","id":"TA0001"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1078/","name":"Valid Accounts","id":"T1078"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}}],"to":"now","references":["https://github.com/linux-pam/linux-pam/blob/0adbaeb273da1d45213134aa271e95987103281c/modules/pam_faillock/pam_faillock.c#L574"],"version":1,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*"],"query":"event.module:auditd and event.action:\"failed-log-in-too-many-times-to\"\n","actions":[]}
{"id":"887c06b0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T15:34:55.602Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.367Z","created_by":"elastic","name":"Potential SSH Password Guessing [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Credential Access"],"interval":"5m","enabled":true,"revision":3,"description":"Identifies multiple SSH login failures followed by a successful one from the same source address. Adversaries can attempt to login into multiple users with a common or known password to gain access to accounts.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n\n### Investigating Potential SSH Password Guessing Attack\n\nThe rule identifies consecutive SSH login failures followed by a successful login from the same source IP address to the same target host indicating a successful attempt of brute force password guessing.\n\n#### Possible investigation steps\n\n- Investigate the login failure user name(s).\n- Investigate the source IP address of the failed ssh login attempt(s).\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Identify the source and the target computer and their roles in the IT environment.\n\n### False positive analysis\n\n- Authentication misconfiguration or obsolete credentials.\n- Service account password expired.\n- Infrastructure or availability issue.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Ensure active session(s) on the host(s) are terminated as the attacker could have gained initial access to the system(s).\n- Isolate the involved hosts to prevent further post-compromise behavior.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n\n","license":"Elastic License v2","output_index":"","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"bd51a4f1-630d-4c74-baf1-9f872019502e","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1110/","name":"Brute Force","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1110/001/","name":"Password Guessing","id":"T1110.001"},{"reference":"https://attack.mitre.org/techniques/T1110/003/","name":"Password Spraying","id":"T1110.003"}],"id":"T1110"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0006/","name":"Credential Access","id":"TA0006"}}],"to":"now","references":[],"version":3,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-system.auth-*"],"query":"sequence by host.id, source.ip, user.name with maxspan=3s\n  [authentication where event.action  in (\"ssh_login\", \"user_login\") and\n   event.outcome == \"failure\" and source.ip != null and source.ip != \"0.0.0.0\" and source.ip != \"::\" ] with runs=2\n\n  [authentication where event.action  in (\"ssh_login\", \"user_login\") and\n   event.outcome == \"success\" and source.ip != null and source.ip != \"0.0.0.0\" and source.ip != \"::\" ]\n","actions":[]}
{"id":"379de330-d962-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-06-01T21:28:44.680Z","updated_by":"elastic","created_at":"2023-04-12T18:45:38.152Z","created_by":"elastic","name":"Windows Service Installed via an Unusual Client [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Privilege Escalation"],"interval":"5m","enabled":true,"revision":104,"description":"Identifies the creation of a Windows service by an unusual client process. Services may be created with administrator privileges but are executed under SYSTEM privileges, so an adversary may also use a service to escalate privileges from administrator to SYSTEM.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":"","meta":{"from":"4m"},"timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-540s","rule_id":"27da8730-24ff-474a-8b86-a937987f2368","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"reference":"https://attack.mitre.org/tactics/TA0004/","name":"Privilege Escalation","id":"TA0004"},"technique":[{"reference":"https://attack.mitre.org/techniques/T1543/","name":"Create or Modify System Process","id":"T1543","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1543/003/","name":"Windows Service","id":"T1543.003"}]}]}],"to":"now","references":["https://www.x86matthew.com/view_post?id=create_svc_rpc","https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4697","https://github.com/atc-project/atomic-threat-coverage/blob/master/Atomic_Threat_Coverage/Logging_Policies/LP_0100_windows_audit_security_system_extension.md"],"version":104,"exceptions_list":[{"id":"fa070660-d9f6-11ed-9bbb-69b1ad2deb7a","list_id":"cc6dce54-1d5c-4d5c-92d6-6fe44dec55c9","type":"detection","namespace_type":"single"}],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["winlogbeat-*","logs-system.*","logs-windows.*"],"query":"event.action:\"service-installed\"  and (winlog.event_data.ClientProcessId:\"0\" or winlog.event_data.ParentProcessId:\"0\") and not (user.name: \"fg.ad\" and service.name:\"RemComSvc\")\n","filters":[],"actions":[]}
{"id":"4e633a40-447d-11ed-b5fa-0d281afe1344","updated_at":"2023-06-08T21:03:44.306Z","updated_by":"elastic","created_at":"2022-10-05T07:14:10.185Z","created_by":"elastic","name":"Fortigate Virus Internal Detection to Internal Direction","tags":["prod","Octava Defence","Custom Rules"],"interval":"5m","enabled":true,"revision":5,"description":"Fortigate Virus Internal Detection to Internal Direction","risk_score":47,"severity":"medium","license":"","output_index":"","meta":{"from":"3m","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava Defence"],"false_positives":[],"from":"now-480s","rule_id":"05e200f2-8ac0-4444-92df-22563f166eb8","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","reference":"https://attack.mitre.org/tactics/TA0002","name":"Execution"},"technique":[{"id":"T1203","reference":"https://attack.mitre.org/techniques/T1203","name":"Exploitation for Client Execution","subtechnique":[]}]}],"to":"now","references":[],"version":5,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"fortinet.firewall.subtype:\"virus\" AND NOT source.as.number:* AND NOT destination.as.number:* AND fortinet.firewall.crlevel:*","filters":[],"threshold":{"field":["fortinet.firewall.virus"],"value":1,"cardinality":[]},"actions":[]}
{"id":"3b4b83c0-262a-11ed-a6d5-7b380a06d8af","updated_at":"2023-06-08T21:03:44.308Z","updated_by":"elastic","created_at":"2022-08-27T17:03:54.505Z","created_by":"elastic","name":"Fortigate failed authentication attempts","tags":["Octava Defence","prod","Custom Rules"],"interval":"5m","enabled":true,"revision":4,"description":"Fortigate management failed authentication attempts from one IP address","risk_score":47,"severity":"medium","license":"","output_index":"","meta":{"from":"1h","kibana_siem_app_url":"https://192.168.101.14:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava"],"false_positives":[],"from":"now-3900s","rule_id":"03bc5c23-3666-462f-b93a-4e86e9044fc9","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0006","reference":"https://attack.mitre.org/tactics/TA0006","name":"Credential Access"},"technique":[{"id":"T1110","reference":"https://attack.mitre.org/techniques/T1110","name":"Brute Force","subtechnique":[]}]}],"to":"now","references":[],"version":4,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"fortinet.firewall.type:\"event\" AND fortinet.firewall.action:\"login\" AND fortinet.firewall.status:\"failed\" AND fortinet.firewall.ui:*","filters":[],"threshold":{"field":["source.ip"],"value":10,"cardinality":[]},"actions":[]}
{"id":"c5e2f8c0-a6f8-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-06-08T21:05:11.366Z","updated_by":"elastic","created_at":"2023-02-07T15:04:52.717Z","created_by":"elastic","name":"Delivered blocked emails violated from one sender","tags":["SOAR-UA-33","Custom Rules"],"interval":"5m","enabled":true,"revision":5,"description":"Delivered blocked emails violated from one sender","risk_score":73,"severity":"high","note":"Зафіксовано доставку адресату електронного листа через Cisco ESA від адресата та з темою, які були заблоковані (QUARANTINED, DROPPED) протягом 24 годин.\nEvents:\ntime_occured, time_ingested, esa_action, email_from, email_to, email_subject\n{{@timestamp}}, {{event.ingested}}, {{cisco_secure_email_gateway.log.act}}, {{email.from.address}}, {{email.to.address}}, {{email.subject}}","license":"","output_index":"","meta":{"from":"24h","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava"],"false_positives":[],"from":"now-86700s","rule_id":"08773b56-f44e-40f9-b030-51ca15fa0591","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0001","reference":"https://attack.mitre.org/tactics/TA0001","name":"Initial Access"},"technique":[{"id":"T1566","reference":"https://attack.mitre.org/techniques/T1566","name":"Phishing","subtechnique":[]}]}],"to":"now","references":[],"version":5,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"kuery","data_view_id":"logs-*","query":"event.module:\"cisco_secure_email_gateway\" AND NOT email.from.address:*sendpulse*","filters":[],"threshold":{"field":["email.subject","email.from.address"],"value":2,"cardinality":[{"field":"event.action","value":2}]},"actions":[]}
{"id":"887e77b0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.881Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.464Z","created_by":"elastic","name":"Potential SSH Brute Force Detected on Privileged Account [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Lateral Movement","Credential Access"],"interval":"5m","enabled":true,"revision":3,"description":"Identifies multiple consecutive login failures targeting a root user account from the same source address and within a short time interval. Adversaries will often brute force login attempts on privileged accounts with a common or known password, in an attempt to gain privileged access to systems.","risk_score":73,"severity":"high","note":"## Triage and analysis\n\n### Investigating Potential SSH Brute Force Attack on Privileged Account\n\nThe rule identifies consecutive SSH login failures targeting a privileged (root) account from the same source IP address to the same target host indicating brute force login attempts.\n\n#### Possible investigation steps\n\n- Investigate the login failure on privileged account(s).\n- Investigate the source IP address of the failed ssh login attempt(s).\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Identify the source and the target computer and their roles in the IT environment.\n\n### False positive analysis\n\n- Authentication misconfiguration or obsolete credentials.\n- Service account password expired.\n- Infrastructure or availability issue.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved hosts to prevent further post-compromise behavior.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n\n","license":"Elastic License v2","output_index":"","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"6f863566-06b3-4878-845e-2d3a95d1acdc","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1110/","name":"Brute Force","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1110/001/","name":"Password Guessing","id":"T1110.001"},{"reference":"https://attack.mitre.org/techniques/T1110/003/","name":"Password Spraying","id":"T1110.003"}],"id":"T1110"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0006/","name":"Credential Access","id":"TA0006"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1021/","name":"Remote Services","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1021/004/","name":"SSH","id":"T1021.004"}],"id":"T1021"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0008/","name":"Lateral Movement","id":"TA0008"}}],"to":"now","references":[],"version":3,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-system.auth-*"],"query":"sequence by host.id, source.ip with maxspan=10s\n  [authentication where event.action  in (\"ssh_login\", \"user_login\") and\n   event.outcome == \"failure\" and source.ip != null and source.ip != \"0.0.0.0\" and\n   source.ip != \"::\" and  user.name in (\"*root*\" , \"*admin*\")] with runs=3\n","actions":[]}
{"id":"88804c70-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:39.873Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.496Z","created_by":"elastic","name":"Linux Restricted Shell Breakout via Linux Binary(s) [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Execution","GTFOBins","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Identifies Linux binary(s) abuse to breakout of restricted shells or environments by spawning an interactive system shell. The linux utility(s) activity of spawning shell is not a standard use of the binary for a user or system administrator. It may indicates an attempt to improve the capabilities or stability of an adversary access.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n\n### Investigating Shell Evasion via Linux Utilities\nDetection alerts from this rule indicate that a Linux utility has been abused to breakout of restricted shells or\nenvironments by spawning an interactive system shell.\nHere are some possible avenues of investigation:\n- Examine the entry point to the host and user in action via the Analyse View.\n  - Identify the session entry leader and session user\n- Examine the contents of session leading to the abuse via the Session View.\n  - Examine the command execution pattern in the session, which may lead to suspricous activities\n- Examine the execution of commands in the spawned shell.\n  - Identify imment threat to the system from the executed commands\n  - Take necessary incident response actions to contain any malicious behviour caused via this execution.\n\n### Related rules\n\n- A malicious spawned shell can execute any of the possible MITTRE ATT&CK vectors mainly to impair defences.\n- Hence its adviced to enable defence evasion and privilige escalation rules accordingly in your environment\n\n### Response and remediation\n\nInitiate the incident response process based on the outcome of the triage.\n\n- If the triage releaved suspicious netwrok activity from the malicious spawned shell,\n  - Isolate the involved host to prevent further post-compromise behavior.\n- If the triage identified malware execution via the maliciously spawned shell,\n  - Search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors like reverse shells, reverse proxies, or droppers that attackers could use to reinfect the system.\n- If the triage revelaed defence evasion for imparing defenses\n  - Isolate the involved host to prevent further post-compromise behavior.\n  - Identified the disabled security guard components on the host and take necessary steps in renebaling the same.\n  - If any tools have been disbaled / uninstalled or config tampered work towards reenabling the same.\n- If the triage revelaed addition of persistence mechanism exploit like auto start scripts\n  - Isolate further login to the systems that can initae auto start scripts.\n  - Identify the auto start scripts and disable and remove the same from the systems\n- If the triage revealed data crawling or data export via remote copy\n  - Investigate credential exposure on systems compromised / used / decoded by the attacker during the data crawling\n  - Intiate compromised credential deactivation and credential rotation process for all exposed crednetials.\n  - Investiagte if any IPR data was accessed during the data crawling and take appropriate actions.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"4064ea5a-2334-4a1c-b77f-b330d22fec4e","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1059/","name":"Command and Scripting Interpreter","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1059/004/","name":"Unix Shell","id":"T1059.004"}],"id":"T1059"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002/","name":"Execution","id":"TA0002"}}],"to":"now","references":["https://gtfobins.github.io/gtfobins/apt/","https://gtfobins.github.io/gtfobins/apt-get/","https://gtfobins.github.io/gtfobins/nawk/","https://gtfobins.github.io/gtfobins/mawk/","https://gtfobins.github.io/gtfobins/awk/","https://gtfobins.github.io/gtfobins/gawk/","https://gtfobins.github.io/gtfobins/busybox/","https://gtfobins.github.io/gtfobins/c89/","https://gtfobins.github.io/gtfobins/c99/","https://gtfobins.github.io/gtfobins/cpulimit/","https://gtfobins.github.io/gtfobins/crash/","https://gtfobins.github.io/gtfobins/env/","https://gtfobins.github.io/gtfobins/expect/","https://gtfobins.github.io/gtfobins/find/","https://gtfobins.github.io/gtfobins/flock/","https://gtfobins.github.io/gtfobins/gcc/","https://gtfobins.github.io/gtfobins/mysql/","https://gtfobins.github.io/gtfobins/nice/","https://gtfobins.github.io/gtfobins/ssh/","https://gtfobins.github.io/gtfobins/vi/","https://gtfobins.github.io/gtfobins/vim/","https://gtfobins.github.io/gtfobins/capsh/","https://gtfobins.github.io/gtfobins/byebug/","https://gtfobins.github.io/gtfobins/git/","https://gtfobins.github.io/gtfobins/ftp/"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["logs-endpoint.events.*","endgame-*"],"query":"process where event.type == \"start\" and\n  (\n    /* launch shells from unusual process */\n    (process.name == \"capsh\" and process.args == \"--\") or\n\n    /* launching shells from unusual parents or parent+arg combos */\n    (process.name in (\"bash\", \"sh\", \"dash\",\"ash\") and\n        (process.parent.name in (\"byebug\",\"git\",\"ftp\",\"strace\")) or\n\n        /* shells specified in parent args */\n        /* nice rule is broken in 8.2 */\n        (process.parent.args in (\"/bin/sh\", \"/bin/bash\", \"/bin/dash\", \"/bin/ash\", \"sh\", \"bash\", \"dash\", \"ash\") and\n            (\n             (process.parent.name == \"nice\") or\n             (process.parent.name == \"cpulimit\" and process.parent.args == \"-f\") or\n             (process.parent.name == \"find\" and process.parent.args == \"-exec\" and process.parent.args == \";\") or\n             (process.parent.name == \"flock\" and process.parent.args == \"-u\" and process.parent.args == \"/\")\n            )\n        ) or\n\n         /* shells specified in args */\n         (process.args in (\"/bin/sh\", \"/bin/bash\", \"/bin/dash\", \"/bin/ash\", \"sh\", \"bash\", \"dash\", \"ash\") and\n            (process.parent.name == \"crash\" and process.parent.args == \"-h\") or\n            (process.name == \"sensible-pager\" and process.parent.name in (\"apt\", \"apt-get\") and process.parent.args == \"changelog\")\n            /* scope to include more sensible-pager invoked shells with different parent process to reduce noise and remove false positives */\n          )\n    ) or\n    (process.name == \"busybox\" and process.args_count == 2 and process.args in (\"/bin/sh\", \"/bin/bash\", \"/bin/dash\", \"/bin/ash\", \"sh\", \"bash\", \"dash\", \"ash\") )or\n    (process.name == \"env\" and process.args_count == 2 and process.args in (\"/bin/sh\", \"/bin/bash\", \"/bin/dash\", \"/bin/ash\", \"sh\", \"bash\", \"dash\", \"ash\")) or\n    (process.parent.name in (\"vi\", \"vim\") and process.parent.args == \"-c\" and process.parent.args in (\":!/bin/bash\", \":!/bin/sh\", \":!bash\", \":!sh\")) or\n    (process.parent.name in (\"c89\",\"c99\", \"gcc\") and process.parent.args in (\"sh,-s\", \"bash,-s\", \"dash,-s\", \"ash,-s\", \"/bin/sh,-s\", \"/bin/bash,-s\", \"/bin/dash,-s\", \"/bin/ash,-s\") and process.parent.args == \"-wrapper\") or\n    (process.parent.name == \"expect\" and process.parent.args == \"-c\" and process.parent.args in (\"spawn /bin/sh;interact\", \"spawn /bin/bash;interact\", \"spawn /bin/dash;interact\", \"spawn sh;interact\", \"spawn bash;interact\", \"spawn dash;interact\")) or\n    (process.parent.name == \"mysql\" and process.parent.args == \"-e\" and process.parent.args in (\"\\\\!*sh\", \"\\\\!*bash\", \"\\\\!*dash\", \"\\\\!*/bin/sh\", \"\\\\!*/bin/bash\", \"\\\\!*/bin/dash\")) or\n    (process.parent.name == \"ssh\" and process.parent.args == \"-o\" and process.parent.args in (\"ProxyCommand=;sh 0<&2 1>&2\", \"ProxyCommand=;bash 0<&2 1>&2\", \"ProxyCommand=;dash 0<&2 1>&2\", \"ProxyCommand=;/bin/sh 0<&2 1>&2\", \"ProxyCommand=;/bin/bash 0<&2 1>&2\", \"ProxyCommand=;/bin/dash 0<&2 1>&2\")) or\n    (process.parent.name in (\"nawk\", \"mawk\", \"awk\", \"gawk\") and process.parent.args : \"BEGIN {system(*)}\")\n  )\n","actions":[]}
{"id":"886b16c0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.876Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.274Z","created_by":"elastic","name":"Tampering of Bash Command-Line History [Duplicate]","tags":["Elastic","Host","Linux","macOS","Threat Detection","Defense Evasion"],"interval":"5m","enabled":true,"revision":101,"description":"Adversaries may attempt to clear or disable the Bash command-line history in an attempt to evade detection or forensic investigations.","risk_score":47,"severity":"medium","note":"","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"9c82993b-61b4-41c9-9631-4ec1d922cb8b","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1070/","name":"Indicator Removal","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1070/003/","name":"Clear Command History","id":"T1070.003"}],"id":"T1070"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0005/","name":"Defense Evasion","id":"TA0005"}}],"to":"now","references":[],"version":101,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-endpoint.events.*"],"query":"process where event.type in (\"start\", \"process_started\") and\n (\n  ((process.args : (\"rm\", \"echo\") or\n    (process.args : \"ln\" and process.args : \"-sf\" and process.args : \"/dev/null\") or\n    (process.args : \"truncate\" and process.args : \"-s0\"))\n    and process.args : (\".bash_history\", \"/root/.bash_history\", \"/home/*/.bash_history\",\"/Users/.bash_history\", \"/Users/*/.bash_history\",\n                        \".zsh_history\", \"/root/.zsh_history\", \"/home/*/.zsh_history\", \"/Users/.zsh_history\", \"/Users/*/.zsh_history\")) or\n  (process.name : \"history\" and process.args : \"-c\") or\n  (process.args : \"export\" and process.args : (\"HISTFILE=/dev/null\", \"HISTFILESIZE=0\")) or\n  (process.args : \"unset\" and process.args : \"HISTFILE\") or\n  (process.args : \"set\" and process.args : \"history\" and process.args : \"+o\")\n )\n","actions":[]}
{"id":"886cc470-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:42.905Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.254Z","created_by":"elastic","name":"Dynamic Linker Copy [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Persistence","Orbit"],"interval":"5m","enabled":true,"revision":101,"description":"Detects the copying of the Linux dynamic loader binary and subsequent file creation for the purpose of creating a backup copy. This technique was seen recently being utilized by Linux malware prior to patching the dynamic loader in order to inject and preload a malicious shared object file. This activity should never occur and if it does then it should be considered highly suspicious or malicious.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":".siem-signals-default","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"749b213f-093d-4199-826d-edebf4ccb14c","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1574/","name":"Hijack Execution Flow","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1574/006/","name":"Dynamic Linker Hijacking","id":"T1574.006"}],"id":"T1574"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}}],"to":"now","references":["https://www.intezer.com/blog/incident-response/orbit-new-undetected-linux-threat/"],"version":101,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["logs-endpoint.events.*"],"query":"sequence by process.entity_id with maxspan=1m\n[process where event.type == \"start\" and process.name : (\"cp\", \"rsync\") and process.args : (\"/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2\", \"/etc/ld.so.preload\")]\n[file where event.action == \"creation\" and file.extension == \"so\"]\n","actions":[]}
{"id":"886ceb80-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:42.910Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.250Z","created_by":"elastic","name":"Chkconfig Service Add [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Persistence","Lightning Framework","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Detects the use of the chkconfig binary to manually add a service for management by chkconfig. Threat actors may utilize this technique to maintain persistence on a system. When a new service is added, chkconfig ensures that the service has either a start or a kill entry in every runlevel and when the system is rebooted the service file added will run providing long-term persistence.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"e4ebce0a-87e5-4f40-b929-42d675ad633d","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1037/","name":"Boot or Logon Initialization Scripts","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1037/004/","name":"RC Scripts","id":"T1037.004"}],"id":"T1037"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}}],"to":"now","references":["https://www.intezer.com/blog/research/lightning-framework-new-linux-threat/"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["logs-endpoint.events.*","endgame-*"],"query":"process where event.type == \"start\" and\n( \n  (process.executable : \"/usr/sbin/chkconfig\" and process.args : \"--add\") or\n  (process.args : \"*chkconfig\" and process.args : \"--add\")\n)\n","actions":[]}
{"id":"887ffe50-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:42.927Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.491Z","created_by":"elastic","name":"Kernel module load via insmod [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Persistence","Rootkit","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Detects the use of the insmod binary to load a Linux kernel object file. Threat actors can use this binary, given they have root privileges, to load a rootkit on a system providing them with complete control and the ability to hide from security products. Manually loading a kernel module in this manner should not be at all common and can indicate suspcious or malicious behavior.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"49988203-c859-44f7-8ff7-717a2dd26508","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1547/","name":"Boot or Logon Autostart Execution","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1547/006/","name":"Kernel Modules and Extensions","id":"T1547.006"}],"id":"T1547"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}}],"to":"now","references":["https://decoded.avast.io/davidalvarez/linux-threat-hunting-syslogk-a-kernel-rootkit-found-under-development-in-the-wild/"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["logs-endpoint.events.*","endgame-*"],"query":"process where event.type == \"start\" and process.executable : \"/usr/sbin/insmod\" and process.args : \"*.ko\"\n","actions":[]}
{"id":"898bf010-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:39.872Z","updated_by":"elastic","created_at":"2023-03-15T15:32:04.161Z","created_by":"elastic","name":"Potential OpenSSH Backdoor Logging Activity [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Persistence","Credential Access","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Identifies a Secure Shell (SSH) client or server process creating or writing to a known SSH backdoor log file. Adversaries may modify SSH related binaries for persistence or credential access via patching sensitive functions to enable unauthorized access or to log SSH credentials for exfiltration.","risk_score":73,"severity":"high","note":"","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Updates to approved and trusted SSH executables can trigger this rule."],"from":"now-9m","rule_id":"50ce06ba-1cd3-460b-94cc-e2797c97a4d9","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1556/","name":"Modify Authentication Process","id":"T1556"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0006/","name":"Credential Access","id":"TA0006"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1554/","name":"Compromise Client Software Binary","id":"T1554"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}}],"to":"now","references":["https://github.com/eset/malware-ioc/tree/master/sshdoor","https://www.welivesecurity.com/wp-content/uploads/2021/01/ESET_Kobalos.pdf"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"file where event.type == \"change\" and process.executable : (\"/usr/sbin/sshd\", \"/usr/bin/ssh\") and\n  (\n    (file.name : (\".*\", \"~*\", \"*~\") and not file.name : (\".cache\", \".viminfo\", \".bash_history\")) or\n    file.extension : (\"in\", \"out\", \"ini\", \"h\", \"gz\", \"so\", \"sock\", \"sync\", \"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\") or\n    file.path :\n    (\n      \"/private/etc/*--\",\n      \"/usr/share/*\",\n      \"/usr/include/*\",\n      \"/usr/local/include/*\",\n      \"/private/tmp/*\",\n      \"/private/var/tmp/*\",\n      \"/usr/tmp/*\",\n      \"/usr/share/man/*\",\n      \"/usr/local/share/*\",\n      \"/usr/lib/*.so.*\",\n      \"/private/etc/ssh/.sshd_auth\",\n      \"/usr/bin/ssd\",\n      \"/private/var/opt/power\",\n      \"/private/etc/ssh/ssh_known_hosts\",\n      \"/private/var/html/lol\",\n      \"/private/var/log/utmp\",\n      \"/private/var/lib\",\n      \"/var/run/sshd/sshd.pid\",\n      \"/var/run/nscd/ns.pid\",\n      \"/var/run/udev/ud.pid\",\n      \"/var/run/udevd.pid\"\n    )\n  )\n","actions":[]}
{"id":"886f0e60-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-06-14T08:30:12.249Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.421Z","created_by":"elastic","name":"Unusual Process Execution - Temp [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection"],"interval":"5m","enabled":true,"revision":14,"description":"Identifies processes running in a temporary folder. This is sometimes done by adversaries to hide malware.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":"","meta":{"from":"4m"},"timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Build systems, like Jenkins, may start processes in the `/tmp` directory. These can be exempted by name or by username."],"from":"now-540s","rule_id":"5e1d5bd6-204b-4a23-be54-8cfab099e517","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[],"to":"now","references":[],"version":14,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*"],"query":"event.category:process and event.type:(start or process_started) and process.working_directory:/tmp and\nnot process.parent.name:(update-motd-updates-available or\napt or apt-* or\ncnf-update-db or\nappstreamcli or\nunattended-upgrade or\npackagekitd) and\nnot process.args:((/usr/lib/update-notifier/update-motd-updates-available or\n/var/lib/command-not-found/) or (*/usr/lib/cnf-update-db*) or (*update-success-stamp*) or (*update-motd-updates-available*) or (*apt-news*)) and not process.parent.args: ((*apt-news.service*) or (*esm-cache.service*))","filters":[],"actions":[]}
{"id":"8ec1e730-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.140Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.864Z","created_by":"elastic","name":"Process Injection by the Microsoft Build Engine [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Defense Evasion","Sysmon Only"],"interval":"5m","enabled":true,"revision":102,"description":"An instance of MSBuild, the Microsoft Build Engine, created a thread in another process. This technique is sometimes used to evade detection or elevate privileges.","risk_score":21,"severity":"low","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["The Build Engine is commonly used by Windows developers but use by non-engineers is unusual."],"from":"now-6m","rule_id":"764652a2-8731-4e01-8fd4-87b3641fcc08","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1055/","name":"Process Injection","id":"T1055"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0005/","name":"Defense Evasion","id":"TA0005"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1055/","name":"Process Injection","id":"T1055"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0004/","name":"Privilege Escalation","id":"TA0004"}}],"to":"now","references":[],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["winlogbeat-*","logs-windows.*"],"query":"process.name:MSBuild.exe and event.action:\"CreateRemoteThread detected (rule: CreateRemoteThread)\"\n","actions":[]}
{"id":"886a0550-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:39.867Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.294Z","created_by":"elastic","name":"Timestomping using Touch Command [Duplicate]","tags":["Elastic","Host","Linux","macOS","Threat Detection","Defense Evasion"],"interval":"5m","enabled":true,"revision":101,"description":"Timestomping is an anti-forensics technique which is used to modify the timestamps of a file, often to mimic files that are in the same folder.","risk_score":47,"severity":"medium","note":"","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"41f6f3c5-c4e7-42cd-bb6e-f276f7229816","max_signals":33,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1070/","name":"Indicator Removal","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1070/006/","name":"Timestomp","id":"T1070.006"}],"id":"T1070"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0005/","name":"Defense Evasion","id":"TA0005"}}],"to":"now","references":[],"version":101,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-endpoint.events.*"],"query":"process where event.type == \"start\" and\n process.name : \"touch\" and user.id != \"0\" and\n process.args : (\"-r\", \"-t\", \"-a*\",\"-m*\") and\n not process.args : (\"/usr/lib/go-*/bin/go\", \"/usr/lib/dracut/dracut-functions.sh\", \"/tmp/KSInstallAction.*/m/.patch/*\")\n","actions":[]}
{"id":"887eece0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:42.908Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.481Z","created_by":"elastic","name":"Attempt to Disable Syslog Service [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Defense Evasion","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Adversaries may attempt to disable the syslog service in an attempt to an attempt to disrupt event logging and evade detection by security controls.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"d093ed78-8f09-4b69-8efa-ad8b5c757d4c","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1562/","name":"Impair Defenses","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1562/001/","name":"Disable or Modify Tools","id":"T1562.001"}],"id":"T1562"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0005/","name":"Defense Evasion","id":"TA0005"}}],"to":"now","references":[],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"event.category:process and event.type:(start or process_started) and\n  ((process.name:service and process.args:stop) or\n     (process.name:chkconfig and process.args:off) or\n     (process.name:systemctl and process.args:(disable or stop or kill)))\n  and process.args:(syslog or rsyslog or \"syslog-ng\")\n","actions":[]}
{"id":"898930f0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.883Z","updated_by":"elastic","created_at":"2023-03-15T15:32:04.125Z","created_by":"elastic","name":"File Transfer or Listener Established via Netcat [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Execution","Investigation Guide"],"interval":"5m","enabled":true,"revision":104,"description":"A netcat process is engaging in network activity on a Linux host. Netcat is often used as a persistence mechanism by exporting a reverse shell or by serving a shell on a listening port. Netcat is also sometimes used for data exfiltration.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n\n### Investigating Netcat Network Activity\n\nNetcat is a dual-use command line tool that can be used for various purposes, such as port scanning, file transfers, and connection tests. Attackers can abuse its functionality for malicious purposes such creating bind shells or reverse shells to gain access to the target system.\n\nA reverse shell is a mechanism that's abused to connect back to an attacker-controlled system. It effectively redirects the system's input and output and delivers a fully functional remote shell to the attacker. Even private systems are vulnerable since the connection is outgoing.\n\nA bind shell is a type of backdoor that attackers set up on the target host and binds to a specific port to listen for an incoming connection from the attacker.\n\nThis rule identifies potential reverse shell or bind shell activity using Netcat by checking for the execution of Netcat followed by a network connection.\n\n#### Possible investigation steps\n\n- Examine the command line to identify if the command is suspicious.\n- Extract and examine the target domain or IP address.\n  - Check if the domain is newly registered or unexpected.\n  - Check the reputation of the domain or IP address.\n  - Scope other potentially compromised hosts in your environment by mapping hosts that also communicated with the domain or IP address.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Investigate any abnormal account behavior, such as command executions, file creations or modifications, and network connections.\n- Investigate any abnormal behavior by the subject process such as network connections, file modifications, and any spawned child processes.\n\n### False positive analysis\n\n- Netcat is a dual-use tool that can be used for benign or malicious activity. It is included in some Linux distributions, so its presence is not necessarily suspicious. Some normal use of this program, while uncommon, may originate from scripts, automation tools, and frameworks.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Block the identified indicators of compromise (IoCs).\n- Take actions to terminate processes and connections used by the attacker.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","license":"Elastic License v2","output_index":".siem-signals-default","author":["Elastic"],"false_positives":["Netcat is a dual-use tool that can be used for benign or malicious activity. Netcat is included in some Linux distributions so its presence is not necessarily suspicious. Some normal use of this program, while uncommon, may originate from scripts, automation tools, and frameworks."],"from":"now-9m","rule_id":"cccbb88a-9586-409a-87f9-25ccf745c355","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1059/","name":"Command and Scripting Interpreter","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1059/004/","name":"Unix Shell","id":"T1059.004"}],"id":"T1059"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002/","name":"Execution","id":"TA0002"}}],"to":"now","references":["http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet","https://www.sans.org/security-resources/sec560/netcat_cheat_sheet_v1.pdf","https://en.wikipedia.org/wiki/Netcat","https://www.hackers-arise.com/hacking-fundamentals","https://null-byte.wonderhowto.com/how-to/hack-like-pro-use-netcat-swiss-army-knife-hacking-tools-0148657/","https://levelup.gitconnected.com/ethical-hacking-part-15-netcat-nc-and-netcat-f6a8f7df43fd"],"version":104,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-endpoint.events.*"],"query":"sequence by process.entity_id\n  [process where event.type == \"start\" and \n      process.name:(\"nc\",\"ncat\",\"netcat\",\"netcat.openbsd\",\"netcat.traditional\") and (\n          /* bind shell to echo for command execution */\n          (process.args:(\"-l\",\"-p\") and process.args:(\"-c\",\"echo\",\"$*\"))\n          /* bind shell to specific port */\n          or process.args:(\"-l\",\"-p\",\"-lp\")\n          /* reverse shell to command-line interpreter used for command execution */\n          or (process.args:(\"-e\") and process.args:(\"/bin/bash\",\"/bin/sh\"))\n          /* file transfer via stdout */\n          or process.args:(\">\",\"<\")\n          /* file transfer via pipe */\n          or (process.args:(\"|\") and process.args:(\"nc\",\"ncat\"))\n      )]\n  [network where (process.name == \"nc\" or process.name == \"ncat\" or process.name == \"netcat\" or\n                  process.name == \"netcat.openbsd\" or process.name == \"netcat.traditional\")]\n","actions":[]}
{"id":"8ec20e40-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.161Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.866Z","created_by":"elastic","name":"Suspicious Process Access via Direct System Call [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Defense Evasion","Investigation Guide","Sysmon Only"],"interval":"5m","enabled":true,"revision":103,"description":"Identifies suspicious process access events from an unknown memory region. Endpoint security solutions usually hook userland Windows APIs in order to decide if the code that is being executed is malicious or not. It's possible to bypass hooked functions by writing malicious functions that call syscalls directly.","risk_score":73,"severity":"high","note":"## Triage and analysis\n\n### Investigating Suspicious Process Access via Direct System Call\n\nEndpoint security solutions usually hook userland Windows APIs in order to decide if the code that is being executed is malicious or not. It's possible to bypass hooked functions by writing malicious functions that call syscalls directly.\n\nMore context and technical details can be found in this [research blog](https://outflank.nl/blog/2019/06/19/red-team-tactics-combining-direct-system-calls-and-srdi-to-bypass-av-edr/).\n\nThis rule identifies suspicious process access events from an unknown memory region. Attackers can use direct system calls to bypass security solutions that rely on hooks.\n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/master/invest-guide-run-osquery.html) introduced in Elastic stack version 8.5.0. Older Elastic stacks versions will see unrendered markdown in this guide.\n\n#### Possible investigation steps\n\n- Investigate the process execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Investigate any abnormal behavior by the subject process such as network connections, registry or file modifications, and any spawned child processes.\n- Examine the host for derived artifacts that indicates suspicious activities:\n  - Analyze the process executable using a private sandboxed analysis system.\n  - Observe and collect information about the following activities in both the sandbox and the alert subject host:\n    - Attempts to contact external domains and addresses.\n      - Use the Elastic Defend network events to determine domains and addresses contacted by the subject process by filtering by the process' `process.entity_id`.\n      - Examine the DNS cache for suspicious or anomalous entries.\n        - !{osquery{\"query\":\"SELECT * FROM dns_cache\", \"label\":\"Osquery - Retrieve DNS Cache\"}}\n    - Use the Elastic Defend registry events to examine registry keys accessed, modified, or created by the related processes in the process tree.\n    - Examine the host services for suspicious or anomalous entries.\n      - !{osquery{\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services\",\"label\":\"Osquery - Retrieve All Services\"}}\n      - !{osquery{\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services WHERE NOT (user_account LIKE '%LocalSystem' OR user_account LIKE '%LocalService' OR user_account LIKE '%NetworkService' OR user_account == null)\",\"label\":\"Osquery - Retrieve Services Running on User Accounts\"}}\n      - !{osquery{\"query\":\"SELECT concat('https://www.virustotal.com/gui/file/', sha1) AS VtLink, name, description, start_type, status, pid, services.path FROM services JOIN authenticode ON services.path = authenticode.path OR services.module_path = authenticode.path JOIN hash ON services.path = hash.path WHERE authenticode.result != 'trusted'\",\"label\":\"Osquery - Retrieve Service Unsigned Executables with Virustotal Link\"}}\n  - Retrieve the files' SHA-256 hash values using the PowerShell `Get-FileHash` cmdlet and search for the existence and reputation of the hashes in resources like VirusTotal, Hybrid-Analysis, CISCO Talos, Any.run, etc.\n- Investigate potentially compromised accounts. Analysts can do this by searching for login events (for example, 4624) to the target host after the registry modification.\n\n\n### False positive analysis\n\n- This detection may be triggered by certain applications that install root certificates for the purpose of inspecting SSL traffic. Benign true positives (B-TPs) can be added as exceptions if necessary.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors like reverse shells, reverse proxies, or droppers that attackers could use to reinfect the system.\n- Remove the malicious certificate from the root certificate store.\n- Remove and block malicious artifacts identified during triage.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"7d1061e8-1959-45fd-802f-53036d458b6d","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1055/","name":"Process Injection","id":"T1055"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0005/","name":"Defense Evasion","id":"TA0005"}}],"to":"now","references":["https://twitter.com/SBousseaden/status/1278013896440324096","https://www.ired.team/offensive-security/defense-evasion/using-syscalls-directly-from-visual-studio-to-bypass-avs-edrs"],"version":103,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["winlogbeat-*","logs-windows.*"],"query":"process where event.code == \"10\" and\n length(winlog.event_data.CallTrace) > 0 and\n\n /* Sysmon CallTrace starting with unknown memory module instead of ntdll which host Windows NT Syscalls */\n not winlog.event_data.CallTrace :\n            (\"?:\\\\WINDOWS\\\\SYSTEM32\\\\ntdll.dll*\",\n             \"?:\\\\WINDOWS\\\\SysWOW64\\\\ntdll.dll*\",\n             \"?:\\\\Windows\\\\System32\\\\wow64cpu.dll*\",\n             \"?:\\\\WINDOWS\\\\System32\\\\wow64win.dll*\",\n             \"?:\\\\Windows\\\\System32\\\\win32u.dll*\") and\n\n not winlog.event_data.TargetImage :\n            (\"?:\\\\Program Files (x86)\\\\Malwarebytes Anti-Exploit\\\\mbae-svc.exe\",\n             \"?:\\\\Program Files\\\\Cisco\\\\AMP\\\\*\\\\sfc.exe\",\n             \"?:\\\\Program Files (x86)\\\\Microsoft\\\\EdgeWebView\\\\Application\\\\*\\\\msedgewebview2.exe\",\n             \"?:\\\\Program Files\\\\Adobe\\\\Acrobat DC\\\\Acrobat\\\\*\\\\AcroCEF.exe\") and\n\n not (process.executable : (\"?:\\\\Program Files\\\\Adobe\\\\Acrobat DC\\\\Acrobat\\\\Acrobat.exe\",\n                            \"?:\\\\Program Files (x86)\\\\World of Warcraft\\\\_classic_\\\\WowClassic.exe\") and\n      not winlog.event_data.TargetImage : \"?:\\\\WINDOWS\\\\system32\\\\lsass.exe\")\n","actions":[]}
{"id":"887ddb70-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:42.907Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.455Z","created_by":"elastic","name":"Interactive Terminal Spawned via Python [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Execution","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Identifies when a terminal (tty) is spawned via Python. Attackers may upgrade a simple reverse shell to a fully interactive tty after obtaining initial access to a host.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":".siem-signals-default","timeline_id":"e70679c2-6cde-4510-9764-4823df18f7db","timeline_title":"Comprehensive Process Timeline","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"1029a350-e907-4750-a5a8-d0b3dfc6796f","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1059/","name":"Command and Scripting Interpreter","id":"T1059"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002/","name":"Execution","id":"TA0002"}}],"to":"now","references":[],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"event.category:process and event.type:(start or process_started) and\n  process.name:python* and\n  process.args:(\"import pty; pty.spawn(\\\"/bin/sh\\\")\" or\n                \"import pty; pty.spawn(\\\"/bin/dash\\\")\" or\n                \"import pty; pty.spawn(\\\"/bin/bash\\\")\")\n","actions":[]}
{"id":"8ec123e0-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.155Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.858Z","created_by":"elastic","name":"LSASS Memory Dump Handle Access [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Credential Access","Investigation Guide"],"interval":"5m","enabled":true,"revision":104,"description":"Identifies handle requests for the Local Security Authority Subsystem Service (LSASS) object access with specific access masks that many tools with a capability to dump memory to disk use (0x1fffff, 0x1010, 0x120089). This rule is tool agnostic as it has been validated against a host of various LSASS dump tools such as SharpDump, Procdump, Mimikatz, Comsvcs etc. It detects this behavior at a low level and does not depend on a specific tool or dump file name.","risk_score":73,"severity":"high","note":"## Triage and analysis\n\n### Investigating LSASS Memory Dump Handle Access\n\nLocal Security Authority Server Service (LSASS) is a process in Microsoft Windows operating systems that is responsible for enforcing security policy on the system. It verifies users logging on to a Windows computer or server, handles password changes, and creates access tokens.\n\nAdversaries may attempt to access credential material stored in LSASS process memory. After a user logs on, the system generates and stores a variety of credential materials in LSASS process memory. This is meant to facilitate single sign-on (SSO) ensuring a user isn’t prompted each time resource access is requested. These credential materials can be harvested by an adversary using administrative user or SYSTEM privileges to conduct lateral movement using [alternate authentication material](https://attack.mitre.org/techniques/T1550/).\n\n> **Note**:\n> This investigation guide uses the [Osquery Markdown Plugin](https://www.elastic.co/guide/en/security/master/invest-guide-run-osquery.html) introduced in Elastic stack version 8.5.0. Older Elastic stacks versions will see unrendered markdown in this guide.\n\n#### Possible investigation steps\n\n- Investigate the process execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Examine the host for derived artifacts that indicates suspicious activities:\n  - Analyze the process executable using a private sandboxed analysis system.\n  - Observe and collect information about the following activities in both the sandbox and the alert subject host:\n    - Attempts to contact external domains and addresses.\n      - Use the Elastic Defend network events to determine domains and addresses contacted by the subject process by filtering by the process' `process.entity_id`.\n      - Examine the DNS cache for suspicious or anomalous entries.\n        - !{osquery{\"query\":\"SELECT * FROM dns_cache\", \"label\":\"Osquery - Retrieve DNS Cache\"}}\n    - Use the Elastic Defend registry events to examine registry keys accessed, modified, or created by the related processes in the process tree.\n    - Examine the host services for suspicious or anomalous entries.\n      - !{osquery{\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services\",\"label\":\"Osquery - Retrieve All Services\"}}\n      - !{osquery{\"query\":\"SELECT description, display_name, name, path, pid, service_type, start_type, status, user_account FROM services WHERE NOT (user_account LIKE '%LocalSystem' OR user_account LIKE '%LocalService' OR user_account LIKE '%NetworkService' OR user_account == null)\",\"label\":\"Osquery - Retrieve Services Running on User Accounts\"}}\n      - !{osquery{\"query\":\"SELECT concat('https://www.virustotal.com/gui/file/', sha1) AS VtLink, name, description, start_type, status, pid, services.path FROM services JOIN authenticode ON services.path = authenticode.path OR services.module_path = authenticode.path JOIN hash ON services.path = hash.path WHERE authenticode.result != 'trusted'\",\"label\":\"Osquery - Retrieve Service Unsigned Executables with Virustotal Link\"}}\n  - Retrieve the files' SHA-256 hash values using the PowerShell `Get-FileHash` cmdlet and search for the existence and reputation of the hashes in resources like VirusTotal, Hybrid-Analysis, CISCO Talos, Any.run, etc.\n- Investigate potentially compromised accounts. Analysts can do this by searching for login events (for example, 4624) to the target host after the registry modification.\n\n\n### False positive analysis\n\n- There should be very few or no false positives for this rule. If this activity is expected or noisy in your environment, consider adding exceptions — preferably with a combination of user and command line conditions.\n- If the process is related to antivirus or endpoint detection and response solutions, validate that it is installed on the correct path and signed with the company's valid digital signature.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- Scope compromised credentials and disable the accounts.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors like reverse shells, reverse proxies, or droppers that attackers could use to reinfect the system.\n- Remove and block malicious artifacts identified during triage.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n\nEnsure advanced audit policies for Windows are enabled, specifically:\nObject Access policies [Event ID 4656](https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4656) (Handle to an Object was Requested)\n\n```\nComputer Configuration >\nPolicies >\nWindows Settings >\nSecurity Settings >\nAdvanced Audit Policies Configuration >\nSystem Audit Policies >\nObject Access >\nAudit File System (Success,Failure)\nAudit Handle Manipulation (Success,Failure)\n```\n\nAlso, this event generates only if the object’s [SACL](https://docs.microsoft.com/en-us/windows/win32/secauthz/access-control-lists) has the required access control entry (ACE) to handle the use of specific access rights.\n\nIf enabling an EQL rule on a non-elastic-agent index (such as beats) for versions <8.2, events will not define `event.ingested` and default fallback for EQL rules was not added until 8.2, so you will need to add a custom pipeline to populate `event.ingested` to @timestamp for this rule to work.","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"9ba7e0b3-d10d-4fd1-b2d4-f590c8536deb","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1003/","name":"OS Credential Dumping","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1003/001/","name":"LSASS Memory","id":"T1003.001"}],"id":"T1003"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0006/","name":"Credential Access","id":"TA0006"}}],"to":"now","references":["https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4656","https://twitter.com/jsecurity101/status/1227987828534956033?s=20","https://attack.mitre.org/techniques/T1003/001/","https://threathunterplaybook.com/notebooks/windows/06_credential_access/WIN-170105221010.html","http://findingbad.blogspot.com/2017/","https://www.elastic.co/security-labs/detect-credential-access"],"version":104,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["winlogbeat-*","logs-system.*","logs-windows.*"],"query":"any where event.action == \"File System\" and event.code == \"4656\" and\n\n    winlog.event_data.ObjectName : (\n        \"?:\\\\Windows\\\\System32\\\\lsass.exe\",\n        \"\\\\Device\\\\HarddiskVolume?\\\\Windows\\\\System32\\\\lsass.exe\",\n        \"\\\\Device\\\\HarddiskVolume??\\\\Windows\\\\System32\\\\lsass.exe\") and\n\n    /* The right to perform an operation controlled by an extended access right. */\n\n    (winlog.event_data.AccessMask : (\"0x1fffff\" , \"0x1010\", \"0x120089\", \"0x1F3FFF\") or\n     winlog.event_data.AccessMaskDescription : (\"READ_CONTROL\", \"Read from process memory\"))\n\n     /* Common Noisy False Positives */\n\n    and not winlog.event_data.ProcessName : (\n        \"?:\\\\Program Files\\\\*.exe\",\n        \"?:\\\\Program Files (x86)\\\\*.exe\",\n        \"?:\\\\Windows\\\\system32\\\\wbem\\\\WmiPrvSE.exe\",\n        \"?:\\\\Windows\\\\System32\\\\dllhost.exe\",\n        \"?:\\\\Windows\\\\System32\\\\svchost.exe\",\n        \"?:\\\\Windows\\\\System32\\\\msiexec.exe\",\n        \"?:\\\\ProgramData\\\\Microsoft\\\\Windows Defender\\\\*.exe\",\n        \"?:\\\\Windows\\\\explorer.exe\")\n","actions":[]}
{"id":"887f13f0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:39.873Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.468Z","created_by":"elastic","name":"Binary Executed from Shared Memory Directory [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Execution","BPFDoor","Elastic Endgame"],"interval":"5m","enabled":true,"revision":103,"description":"Identifies the execution of a binary by root in Linux shared memory directories: (/dev/shm/, /run/shm/, /var/run/, /var/lock/). This activity is to be considered highly abnormal and should be investigated. Threat actors have placed executables used for persistence on high-uptime servers in these directories as system backdoors.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Directories /dev/shm and /run/shm are temporary file storage directories in Linux. They are intended to appear as a mounted file system, but uses virtual memory instead of a persistent storage device and thus are used for mounting file systems in legitimate purposes."],"from":"now-9m","rule_id":"9a8cb083-4c4b-4eea-9170-236bfb14d014","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1059/","name":"Command and Scripting Interpreter","id":"T1059"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002/","name":"Execution","id":"TA0002"}}],"to":"now","references":["https://linuxsecurity.com/features/fileless-malware-on-linux","https://twitter.com/GossiTheDog/status/1522964028284411907","https://www.elastic.co/security-labs/a-peek-behind-the-bpfdoor"],"version":103,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["logs-endpoint.events.*","endgame-*"],"query":"process where event.type == \"start\" and\n    event.action : (\"exec\", \"exec_event\") and user.name == \"root\" and\n    process.executable : (\n        \"/dev/shm/*\",\n        \"/run/shm/*\",\n        \"/var/run/*\",\n        \"/var/lock/*\"\n    ) and\n    not process.executable : ( \"/var/run/docker/*\")\n","actions":[]}
{"id":"898c6540-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.889Z","updated_by":"elastic","created_at":"2023-03-15T15:32:04.167Z","created_by":"elastic","name":"Sudo Heap-Based Buffer Overflow Attempt [Duplicate]","tags":["Elastic","Host","Linux","macOS","Threat Detection","Privilege Escalation"],"interval":"5m","enabled":true,"revision":101,"description":"Identifies the attempted use of a heap-based buffer overflow vulnerability for the Sudo binary in Unix-like systems (CVE-2021-3156). Successful exploitation allows an unprivileged user to escalate to the root user.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":".siem-signals-default","author":["Elastic"],"false_positives":["This rule could generate false positives if the process arguments leveraged by the exploit are shared by custom scripts using the Sudo or Sudoedit binaries. Only Sudo versions 1.8.2 through 1.8.31p2 and 1.9.0 through 1.9.5p1 are affected; if those versions are not present on the endpoint, this could be a false positive."],"from":"now-9m","rule_id":"c739f986-2112-4227-a7cc-648d6705e3b1","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1068/","name":"Exploitation for Privilege Escalation","id":"T1068"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0004/","name":"Privilege Escalation","id":"TA0004"}}],"to":"now","references":["https://cve.mitre.org/cgi-bin/cvename.cgi?name=2021-3156","https://blog.qualys.com/vulnerabilities-research/2021/01/26/cve-2021-3156-heap-based-buffer-overflow-in-sudo-baron-samedit","https://www.bleepingcomputer.com/news/security/latest-macos-big-sur-also-has-sudo-root-privilege-escalation-flaw","https://www.sudo.ws/alerts/unescape_overflow.html"],"version":101,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*"],"query":"event.category:process and event.type:start and\n  process.name:(sudo or sudoedit) and\n  process.args:(*\\\\ and (\"-i\" or \"-s\"))\n","threshold":{"field":["host.hostname"],"value":100},"actions":[]}
{"id":"898cb360-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.880Z","updated_by":"elastic","created_at":"2023-03-15T15:32:04.170Z","created_by":"elastic","name":"Modification of Dynamic Linker Preload Shared Object [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Privilege Escalation","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Identifies modification of the dynamic linker preload shared object (ld.so.preload). Adversaries may execute malicious payloads by hijacking the dynamic linker used to load libraries.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"59fdb1af-23f7-43b5-aa4e-4bae548f8263","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1574/","name":"Hijack Execution Flow","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1574/006/","name":"Dynamic Linker Hijacking","id":"T1574.006"}],"id":"T1574"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0004/","name":"Privilege Escalation","id":"TA0004"}}],"to":"now","references":["https://www.anomali.com/blog/rocke-evolves-its-arsenal-with-a-new-malware-family-written-in-golang"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"event.category:file and not event.type:deletion and file.path:/etc/ld.so.preload\n","actions":[]}
{"id":"887fb030-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.875Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.479Z","created_by":"elastic","name":"Potential Linux SSH Brute Force Detected [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Credential Access"],"interval":"5m","enabled":true,"revision":3,"description":"Identifies multiple consecutive login failures targeting an user account from the same source address and within a short time interval. Adversaries will often brute force login attempts across multiple users with a common or known password, in an attempt to gain access to accounts.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n\n### Investigating Potential SSH Brute Force Attack\n\nThe rule identifies consecutive SSH login failures targeting a user account from the same source IP address to the same target host indicating brute force login attempts.\n\n#### Possible investigation steps\n\n- Investigate the login failure user name(s).\n- Investigate the source IP address of the failed ssh login attempt(s).\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Identify the source and the target computer and their roles in the IT environment.\n\n### False positive analysis\n\n- Authentication misconfiguration or obsolete credentials.\n- Service account password expired.\n- Infrastructure or availability issue.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved hosts to prevent further post-compromise behavior.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n\n","license":"Elastic License v2","output_index":"","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"0100b9a9-f47b-4c1c-8243-f91cd056b3ea","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1110/","name":"Brute Force","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1110/001/","name":"Password Guessing","id":"T1110.001"},{"reference":"https://attack.mitre.org/techniques/T1110/003/","name":"Password Spraying","id":"T1110.003"}],"id":"T1110"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0006/","name":"Credential Access","id":"TA0006"}}],"to":"now","references":[],"version":3,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-system.auth-*"],"query":"sequence by host.id, source.ip, user.name with maxspan=10s\n  [authentication where event.action  in (\"ssh_login\", \"user_login\") and\n   event.outcome == \"failure\" and source.ip != null and source.ip != \"0.0.0.0\" and source.ip != \"::\" ] with runs=10\n","actions":[]}
{"id":"8ec23550-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.152Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.890Z","created_by":"elastic","name":"PowerShell Suspicious Script with Audio Capture Capabilities [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Collection","Investigation Guide","PowerShell"],"interval":"5m","enabled":true,"revision":104,"description":"Detects PowerShell scripts that can record audio, a common feature in popular post-exploitation tooling.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n\n### Investigating PowerShell Suspicious Script with Audio Capture Capabilities\n\nPowerShell is one of the main tools system administrators use for automation, report routines, and other tasks. This makes it available for use in various environments, and creates an attractive way for attackers to execute code.\n\nAttackers can use PowerShell to interact with the Windows API with the intent of capturing audio from input devices connected to the victim's computer.\n\n#### Possible investigation steps\n\n- Examine the script content that triggered the detection; look for suspicious DLL imports, collection or exfiltration capabilities, suspicious functions, encoded or compressed data, and other potentially malicious characteristics.\n- Investigate the script execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Examine file or network events from the involved PowerShell process for suspicious behavior.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Evaluate whether the user needs to use PowerShell to complete tasks.\n- Investigate if the script stores the recorded data locally and determine if anything was recorded.\n- Investigate if the script contains exfiltration capabilities and the destination of this exfiltration.\n- Assess network data to determine if the host communicated with the exfiltration server.\n\n### False positive analysis\n\n- Regular users should not need scripts to capture audio, which makes false positives unlikely. In the case of authorized benign true positives (B-TPs), exceptions can be added.\n\n### Related rules\n\n- PowerShell PSReflect Script - 56f2e9b5-4803-4e44-a0a4-a52dc79d57fe\n- Potential Process Injection via PowerShell - 2e29e96a-b67c-455a-afe4-de6183431d0d\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved hosts to prevent further post-compromise behavior.\n- The response must be prioritized if this alert involves key executives or potentially valuable targets for espionage.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Restrict PowerShell usage outside of IT and engineering business units using GPOs, AppLocker, Intune, or similar software.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"e51a8c05-6015-4a96-8ba1-39bcf69edae3","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1123/","name":"Audio Capture","id":"T1123"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0009/","name":"Collection","id":"TA0009"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1059/","name":"Command and Scripting Interpreter","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1059/001/","name":"PowerShell","id":"T1059.001"}],"id":"T1059"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002/","name":"Execution","id":"TA0002"}}],"to":"now","references":["https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Get-MicrophoneAudio.ps1"],"version":104,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["winlogbeat-*","logs-windows.*"],"query":"event.category:process and\n  powershell.file.script_block_text : (\n    \"Get-MicrophoneAudio\" or (waveInGetNumDevs and mciSendStringA)\n  ) and not user.id : \"S-1-5-18\"\n","actions":[]}
{"id":"887b9180-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:39.867Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.374Z","created_by":"elastic","name":"System Log File Deletion [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Defense Evasion","Elastic Endgame"],"interval":"5m","enabled":true,"revision":103,"description":"Identifies the deletion of sensitive Linux system logs. This may indicate an attempt to evade detection or destroy forensic evidence on a system.","risk_score":47,"severity":"medium","note":"","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"15350b36-c264-47b3-8177-1dcff9cac931","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1070/","name":"Indicator Removal","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1070/002/","name":"Clear Linux or Mac System Logs","id":"T1070.002"}],"id":"T1070"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0005/","name":"Defense Evasion","id":"TA0005"}}],"to":"now","references":["https://www.fireeye.com/blog/threat-research/2020/11/live-off-the-land-an-overview-of-unc1945.html"],"version":103,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"file where event.type == \"deletion\" and\n  file.path :\n    (\n    \"/var/run/utmp\",\n    \"/var/log/wtmp\",\n    \"/var/log/btmp\",\n    \"/var/log/lastlog\",\n    \"/var/log/faillog\",\n    \"/var/log/syslog\",\n    \"/var/log/messages\",\n    \"/var/log/secure\",\n    \"/var/log/auth.log\",\n    \"/var/log/boot.log\",\n    \"/var/log/kern.log\"\n    ) and\n    not process.name : (\"gzip\")\n","actions":[]}
{"id":"8ec06090-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.150Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.844Z","created_by":"elastic","name":"AdminSDHolder SDProp Exclusion Added [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Persistence","Active Directory","Investigation Guide"],"interval":"5m","enabled":true,"revision":104,"description":"Identifies a modification on the dsHeuristics attribute on the bit that holds the configuration of groups excluded from the SDProp process. The SDProp compares the permissions on protected objects with those defined on the AdminSDHolder object. If the permissions on any of the protected accounts and groups do not match, the permissions on the protected accounts and groups are reset to match those of the domain's AdminSDHolder object, meaning that groups excluded will remain unchanged. Attackers can abuse this misconfiguration to maintain long-term access to privileged accounts in these groups.","risk_score":73,"severity":"high","note":"## Triage and analysis\n\n### Investigating AdminSDHolder SDProp Exclusion Added\n\nThe SDProp process compares the permissions on protected objects with those defined on the AdminSDHolder object. If the permissions on any of the protected accounts and groups do not match, it resets the permissions on the protected accounts and groups to match those defined in the domain AdminSDHolder object.\n\nThe dSHeuristics is a Unicode string attribute, in which each character in the string represents a heuristic that is used to determine the behavior of Active Directory.\n\nAdministrators can use the dSHeuristics attribute to exclude privilege groups from the SDProp process by setting the 16th bit (dwAdminSDExMask) of the string to a certain value, which represents the group(s):\n\n- For example, to exclude the Account Operators group, an administrator would modify the string, so the 16th character is set to 1 (i.e., 0000000001000001).\n\nThe usage of this exclusion can leave the accounts unprotected and facilitate the misconfiguration of privileges for the excluded groups, enabling attackers to add accounts to these groups to maintain long-term persistence with high privileges.\n\nThis rule matches changes of the dsHeuristics object where the 16th bit is set to a value other than zero.\n\n#### Possible investigation steps\n\n- Identify the user account that performed the action and whether it should perform this kind of action.\n- Contact the account and system owners and confirm whether they are aware of this activity.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Check the value assigned to the 16th bit of the string on the `winlog.event_data.AttributeValue` field:\n    - Account Operators eq 1\n    - Server Operators eq 2\n    - Print Operators eq 4\n    - Backup Operators eq 8\n    The field value can range from 0 to f (15). If more than one group is specified, the values will be summed together; for example, Backup Operators and Print Operators will set the `c` value on the bit.\n\n### False positive analysis\n\n- While this modification can be done legitimately, it is not a best practice. Any potential benign true positive (B-TP) should be mapped and reviewed by the security team for alternatives as this weakens the security of the privileged group.\n\n### Response and remediation\n\n- The change can be reverted by setting the dwAdminSDExMask (16th bit) to 0 in dSHeuristics.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"7bf45c86-1773-4119-833c-da08bc205a0e","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}}],"to":"now","references":["https://www.cert.ssi.gouv.fr/uploads/guide-ad.html#dsheuristics_bad","https://petri.com/active-directory-security-understanding-adminsdholder-object"],"version":104,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["winlogbeat-*","logs-system.*","logs-windows.*"],"query":"any where event.action == \"Directory Service Changes\" and\n  event.code == \"5136\" and\n  winlog.event_data.AttributeLDAPDisplayName : \"dSHeuristics\" and\n  length(winlog.event_data.AttributeValue) > 15 and\n  winlog.event_data.AttributeValue regex~ \"[0-9]{15}([1-9a-f]).*\"\n","actions":[]}
{"id":"8ec2aa80-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.157Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.877Z","created_by":"elastic","name":"PowerShell Kerberos Ticket Request [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Credential Access","Investigation Guide","PowerShell"],"interval":"5m","enabled":true,"revision":104,"description":"Detects PowerShell scripts that have the capability of requesting kerberos tickets, which is a common step in Kerberoasting toolkits to crack service accounts.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n\n### Investigating PowerShell Kerberos Ticket Request\n\nPowerShell is one of the main tools system administrators use for automation, report routines, and other tasks, making it available for use in various environments, creating an attractive way for attackers to execute code.\n\nAccounts associated with a service principal name (SPN) are viable targets for Kerberoasting attacks, which use brute force to crack the user password, which is used to encrypt a Kerberos TGS ticket.\n\nAttackers can use PowerShell to request these Kerberos tickets, with the intent of extracting them from memory to perform Kerberoasting.\n\n#### Possible investigation steps\n\n- Examine the script content that triggered the detection; look for suspicious DLL imports, collection or exfiltration capabilities, suspicious functions, encoded or compressed data, and other potentially malicious characteristics.\n- Investigate the script execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Investigate if the script was executed, and if so, which account was targeted.\n- Validate if the account has an SPN associated with it.\n- Identify the user account that performed the action and whether it should perform this kind of action.\n- Contact the account owner and confirm whether they are aware of this activity.\n- Check if the script has any other functionality that can be potentially malicious.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Review event ID [4769](https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4769) related to this account and service name for additional information.\n\n### False positive analysis\n\n- A possible false positive can be identified if the script content is not malicious/harmful or does not request Kerberos tickets for user accounts, as computer accounts are not vulnerable to Kerberoasting due to complex password requirements and policy.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services. Prioritize privileged accounts.\n- Isolate the involved hosts to prevent further post-compromise behavior.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"bcd0cd29-8952-49be-85e8-1fb9c7cc6117","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1003/","name":"OS Credential Dumping","id":"T1003"},{"reference":"https://attack.mitre.org/techniques/T1558/","name":"Steal or Forge Kerberos Tickets","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1558/003/","name":"Kerberoasting","id":"T1558.003"}],"id":"T1558"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0006/","name":"Credential Access","id":"TA0006"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1059/","name":"Command and Scripting Interpreter","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1059/001/","name":"PowerShell","id":"T1059.001"}],"id":"T1059"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002/","name":"Execution","id":"TA0002"}}],"to":"now","references":["https://cobalt.io/blog/kerberoast-attack-techniques","https://github.com/EmpireProject/Empire/blob/master/data/module_source/credentials/Invoke-Kerberoast.ps1"],"version":104,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["winlogbeat-*","logs-windows.*"],"query":"event.category:process and\n  powershell.file.script_block_text : (\n    KerberosRequestorSecurityToken\n  ) and not user.id : \"S-1-5-18\"\n","actions":[]}
{"id":"8ec28370-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.156Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.870Z","created_by":"elastic","name":"Potential Privileged Escalation via SamAccountName Spoofing [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Persistence","Privilege Escalation","Active Directory"],"interval":"5m","enabled":true,"revision":102,"description":"Identifies a suspicious computer account name rename event, which may indicate an attempt to exploit CVE-2021-42278 to elevate privileges from a standard domain user to a user with domain admin privileges. CVE-2021-42278 is a security vulnerability that allows potential attackers to impersonate a domain controller via samAccountName attribute spoofing.","risk_score":73,"severity":"high","note":"","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"84933e55-fd58-4ee0-9ee3-b4fd3963f238","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1078/","name":"Valid Accounts","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1078/002/","name":"Domain Accounts","id":"T1078.002"}],"id":"T1078"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0004/","name":"Privilege Escalation","id":"TA0004"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1098/","name":"Account Manipulation","id":"T1098"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}}],"to":"now","references":["https://support.microsoft.com/en-us/topic/kb5008102-active-directory-security-accounts-manager-hardening-changes-cve-2021-42278-5975b463-4c95-45e1-831a-d120004e258e","https://cloudbrothers.info/en/exploit-kerberos-samaccountname-spoofing/","https://github.com/cube0x0/noPac","https://twitter.com/exploitph/status/1469157138928914432","https://exploit.ph/cve-2021-42287-cve-2021-42278-weaponisation.html"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["winlogbeat-*","logs-system.*","logs-windows.*"],"query":"iam where event.action == \"renamed-user-account\" and\n  /* machine account name renamed to user like account name */\n  winlog.event_data.OldTargetUserName : \"*$\" and not winlog.event_data.NewTargetUserName : \"*$\"\n","actions":[]}
{"id":"887c7be0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:39.881Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.453Z","created_by":"elastic","name":"Virtual Machine Fingerprinting [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Discovery","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"An adversary may attempt to get detailed information about the operating system and hardware. This rule identifies common locations used to discover virtual machine hardware by a non-root user. This technique has been used by the Pupy RAT and other malware.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Certain tools or automated software may enumerate hardware information. These tools can be exempted via user name or process arguments to eliminate potential noise."],"from":"now-9m","rule_id":"d6a31bd1-df53-424b-bf62-e11b709f6fb2","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1082/","name":"System Information Discovery","id":"T1082"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0007/","name":"Discovery","id":"TA0007"}}],"to":"now","references":[],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"event.category:process and event.type:(start or process_started) and\n  process.args:(\"/sys/class/dmi/id/bios_version\" or\n                \"/sys/class/dmi/id/product_name\" or\n                \"/sys/class/dmi/id/chassis_vendor\" or\n                \"/proc/scsi/scsi\" or\n                \"/proc/ide/hd0/model\") and\n  not user.name:root\n","actions":[]}
{"id":"898d4fa0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.874Z","updated_by":"elastic","created_at":"2023-03-15T15:32:04.187Z","created_by":"elastic","name":"Virtual Machine Fingerprinting via Grep [Duplicate]","tags":["Elastic","Host","macOS","Linux","Threat Detection","Discovery"],"interval":"5m","enabled":true,"revision":101,"description":"An adversary may attempt to get detailed information about the operating system and hardware. This rule identifies common locations used to discover virtual machine hardware by a non-root user. This technique has been used by the Pupy RAT and other malware.","risk_score":47,"severity":"medium","note":"","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Certain tools or automated software may enumerate hardware information. These tools can be exempted via user name or process arguments to eliminate potential noise."],"from":"now-9m","rule_id":"05975560-712d-4094-992b-0b6cf3d0da2f","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1082/","name":"System Information Discovery","id":"T1082"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0007/","name":"Discovery","id":"TA0007"}}],"to":"now","references":["https://objective-see.com/blog/blog_0x4F.html"],"version":101,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-endpoint.events.*"],"query":"process where event.type == \"start\" and\n process.name in (\"grep\", \"egrep\") and user.id != \"0\" and\n process.args : (\"parallels*\", \"vmware*\", \"virtualbox*\") and process.args : \"Manufacturer*\" and\n not process.parent.executable in (\"/Applications/Docker.app/Contents/MacOS/Docker\", \"/usr/libexec/kcare/virt-what\")\n","actions":[]}
{"id":"886aefb0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:42.912Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.278Z","created_by":"elastic","name":"WebServer Access Logs Deleted [Duplicate]","tags":["Elastic","Host","Linux","Windows","macOS","Threat Detection","Defense Evasion"],"interval":"5m","enabled":true,"revision":101,"description":"Identifies the deletion of WebServer access logs. This may indicate an attempt to evade detection or destroy forensic evidence on a system.","risk_score":47,"severity":"medium","note":"","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"b976d608-e377-45d1-b286-6c382a525bbe","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1070/","name":"Indicator Removal","id":"T1070"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0005/","name":"Defense Evasion","id":"TA0005"}}],"to":"now","references":[],"version":101,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","winlogbeat-*","logs-endpoint.events.*","logs-windows.*"],"query":"file where event.type == \"deletion\" and\n  file.path : (\"C:\\\\inetpub\\\\logs\\\\LogFiles\\\\*.log\",\n               \"/var/log/apache*/access.log\",\n               \"/etc/httpd/logs/access_log\",\n               \"/var/log/httpd/access_log\",\n               \"/var/www/*/logs/access.log\")\n","actions":[]}
{"id":"886b3dd0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.888Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.271Z","created_by":"elastic","name":"Auditd Login Attempt at Forbidden Time [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Initial Access"],"interval":"5m","enabled":true,"revision":1,"description":"Identifies that a login attempt occurred at a forbidden time.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-6m","rule_id":"0519e77d-5f4e-4550-8487-d065dc48d20a","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1078/","name":"Valid Accounts","id":"T1078"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0001/","name":"Initial Access","id":"TA0001"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1078/","name":"Valid Accounts","id":"T1078"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}}],"to":"now","references":["https://github.com/linux-pam/linux-pam/blob/aac5a8fdc4aa3f7e56335a6343774cc1b63b408d/modules/pam_time/pam_time.c#L666"],"version":1,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*"],"query":"event.module:auditd and event.action:\"attempted-log-in-during-unusual-hour-to\"\n","actions":[]}
{"id":"887cca00-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T15:34:55.596Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.449Z","created_by":"elastic","name":"Connection to External Network via Telnet [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Lateral Movement"],"interval":"5m","enabled":true,"revision":101,"description":"Telnet provides a command line interface for communication with a remote device or server. This rule identifies Telnet network connections to publicly routable IP addresses.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":".siem-signals-default","author":["Elastic"],"false_positives":["Telnet can be used for both benign or malicious purposes. Telnet is included by default in some Linux distributions, so its presence is not inherently suspicious. The use of Telnet to manage devices remotely has declined in recent years in favor of more secure protocols such as SSH. Telnet usage by non-automated tools or frameworks may be suspicious."],"from":"now-9m","rule_id":"232993e8-6b42-4d84-9c97-65d6dde7d4e6","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1021/","name":"Remote Services","id":"T1021"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0008/","name":"Lateral Movement","id":"TA0008"}}],"to":"now","references":["https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml"],"version":101,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-endpoint.events.*"],"query":"sequence by process.entity_id\n  [process where process.name == \"telnet\" and event.type == \"start\"]\n  [network where process.name == \"telnet\" and\n    not cidrmatch(destination.ip, \"10.0.0.0/8\", \"127.0.0.0/8\", \"169.254.0.0/16\", \"172.16.0.0/12\", \"192.0.0.0/24\",\n                                  \"192.0.0.0/29\", \"192.0.0.8/32\", \"192.0.0.9/32\", \"192.0.0.10/32\", \"192.0.0.170/32\",\n                                  \"192.0.0.171/32\", \"192.0.2.0/24\", \"192.31.196.0/24\", \"192.52.193.0/24\",\n                                  \"192.168.0.0/16\", \"192.88.99.0/24\", \"224.0.0.0/4\", \"100.64.0.0/10\", \"192.175.48.0/24\",\n                                  \"198.18.0.0/15\", \"198.51.100.0/24\", \"203.0.113.0/24\", \"240.0.0.0/4\", \"::1\",\n                                  \"FE80::/10\", \"FF00::/8\")]\n","actions":[]}
{"id":"886aa190-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.894Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.282Z","created_by":"elastic","name":"Auditd Max Login Sessions [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Initial Access"],"interval":"5m","enabled":true,"revision":1,"description":"Identifies that the maximum number login sessions has been reached for a user.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-6m","rule_id":"a2b50dd5-6e86-4b3d-937f-31712d9f24d3","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1078/","name":"Valid Accounts","id":"T1078"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0001/","name":"Initial Access","id":"TA0001"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1078/","name":"Valid Accounts","id":"T1078"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}}],"to":"now","references":["https://github.com/linux-pam/linux-pam/blob/70c32cc6fca51338f92afa58eb75b1107a5c2430/modules/pam_limits/pam_limits.c#L1007"],"version":1,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*"],"query":"event.module:auditd and event.action:\"opened-too-many-sessions-to\"\n","actions":[]}
{"id":"8ebf0100-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.155Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.848Z","created_by":"elastic","name":"PowerShell Share Enumeration Script [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Discovery","Investigation Guide","PowerShell"],"interval":"5m","enabled":true,"revision":4,"description":"Detects scripts that contain PowerShell functions, structures, or Windows API functions related to windows share enumeration activities. Attackers, mainly ransomware groups, commonly identify and inspect network shares, looking for critical information for encryption and/or exfiltration.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n\n### Investigating PowerShell Share Enumeration Script\n\nPowerShell is one of the main tools system administrators use for automation, report routines, and other tasks. This makes it available for use in various environments, and creates an attractive way for attackers to execute code.\n\nAttackers can use PowerShell to enumerate shares to search for sensitive data like documents, scripts, and other kinds of valuable data for encryption, exfiltration, and lateral movement.\n\n#### Possible investigation steps\n\n- Examine the script content that triggered the detection; look for suspicious DLL imports, collection or exfiltration capabilities, suspicious functions, encoded or compressed data, and other potentially malicious characteristics.\n- Investigate the script execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Contact the account owner and confirm whether they are aware of this activity.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Evaluate whether the user needs to use PowerShell to complete tasks.\n- Check for additional PowerShell and command line logs that indicate that imported functions were run.\n  - Evaluate which information was potentially mapped and accessed by the attacker.\n\n### False positive analysis\n\n- This activity is unlikely to happen legitimately. Benign true positives (B-TPs) can be added as exceptions if necessary.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved hosts to prevent further post-compromise behavior.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Restrict PowerShell usage outside of IT and engineering business units using GPOs, AppLocker, Intune, or similar software.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).","license":"Elastic License v2","output_index":"","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"af8de4fb-bbd4-48d8-b078-caa3b9230ae5","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1135/","name":"Network Share Discovery","id":"T1135"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0007/","name":"Discovery","id":"TA0007"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1059/","name":"Command and Scripting Interpreter","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1059/001/","name":"PowerShell","id":"T1059.001"}],"id":"T1059"},{"reference":"https://attack.mitre.org/techniques/T1106/","name":"Native API","id":"T1106"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002/","name":"Execution","id":"TA0002"}}],"to":"now","references":["https://www.advintel.io/post/hunting-for-corporate-insurance-policies-indicators-of-ransom-exfiltrations","https://thedfirreport.com/2022/04/04/stolen-images-campaign-ends-in-conti-ransomware/","https://github.com/atc-project/atc-data/blob/master/docs/Logging_Policies/LP_0109_windows_powershell_script_block_log.md"],"version":4,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["winlogbeat-*","logs-windows.*"],"query":"event.category:process and\n  powershell.file.script_block_text:(\n    \"Invoke-ShareFinder\" or\n    \"Invoke-ShareFinderThreaded\" or\n    (\n      \"shi1_netname\" and\n      \"shi1_remark\"\n    ) or\n    (\n      \"NetShareEnum\" and\n      \"NetApiBufferFree\"\n    )\n  ) and not user.id : \"S-1-5-18\"\n","actions":[]}
{"id":"8ec2d191-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.167Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.887Z","created_by":"elastic","name":"Privilege Escalation via Rogue Named Pipe Impersonation [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Privilege Escalation","Sysmon Only"],"interval":"5m","enabled":true,"revision":102,"description":"Identifies a privilege escalation attempt via rogue named pipe impersonation. An adversary may abuse this technique by masquerading as a known named pipe and manipulating a privileged process to connect to it.","risk_score":73,"severity":"high","note":"Named Pipe Creation Events need to be enabled within the Sysmon configuration by including the following settings:\n`condition equal \"contains\" and keyword equal \"pipe\"`\n\nIf enabling an EQL rule on a non-elastic-agent index (such as beats) for versions <8.2, events will not define `event.ingested` and default fallback for EQL rules was not added until 8.2, so you will need to add a custom pipeline to populate `event.ingested` to @timestamp for this rule to work.","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"58833d26-99a0-4647-adb8-813be393c864","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1134/","name":"Access Token Manipulation","id":"T1134"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0004/","name":"Privilege Escalation","id":"TA0004"}}],"to":"now","references":["https://itm4n.github.io/printspoofer-abusing-impersonate-privileges/","https://github.com/zcgonvh/EfsPotato","https://twitter.com/SBousseaden/status/1429530155291193354"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["winlogbeat-*","logs-windows.*"],"query":"file where event.action : \"Pipe Created*\" and\n /* normal sysmon named pipe creation events truncate the pipe keyword */\n  file.name : \"\\\\*\\\\Pipe\\\\*\"\n","actions":[]}
{"id":"8ec14af0-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.164Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.860Z","created_by":"elastic","name":"Remote Logon followed by Scheduled Task Creation [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Lateral Movement"],"interval":"5m","enabled":true,"revision":3,"description":"Identifies a remote logon followed by a scheduled task creation on the target host. This could be indicative of adversary lateral movement.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n\n### Investigating Remote Scheduled Task Creation\n\n[Scheduled tasks](https://docs.microsoft.com/en-us/windows/win32/taskschd/about-the-task-scheduler) are a great mechanism for persistence and program execution. These features can be used remotely for a variety of legitimate reasons, but at the same time used by malware and adversaries. When investigating scheduled tasks that were set up remotely, one of the first steps should be to determine the original intent behind the configuration and to verify if the activity is tied to benign behavior such as software installation or any kind of network administrator work. One objective for these alerts is to understand the configured action within the scheduled task. This is captured within the registry event data for this rule and can be base64 decoded to view the value.\n\n#### Possible investigation steps\n\n- Review the TaskContent value to investigate the task configured action.\n- Validate if the activity is not related to planned patches, updates, network administrator activity, or legitimate software installations.\n- Further examination should include review of host-based artifacts and network logs from around when the scheduled task was created, on both the source and target machines.\n\n### False positive analysis\n\n- There is a high possibility of benign activity tied to the creation of remote scheduled tasks as it is a general feature within Windows and used for legitimate purposes for a wide range of activity. Any kind of context should be found to further understand the source of the activity and determine the intent based on the scheduled task's contents.\n\n### Related rules\n\n- Service Command Lateral Movement - d61cbcf8-1bc1-4cff-85ba-e7b21c5beedc\n- Remotely Started Services via RPC - aa9a274d-6b53-424d-ac5e-cb8ca4251650\n- Remote Scheduled Task Creation - 954ee7c8-5437-49ae-b2d6-2960883898e9\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- Remove scheduled task and any other related artifacts.\n- Review privileged account management and user account management settings. Consider implementing group policy object (GPO) policies to further restrict activity, or configuring settings that only allow administrators to create remote scheduled tasks.\n","license":"Elastic License v2","output_index":"","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"b63b3922-9ccf-449a-a3db-e5bfc73d59c6","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1021/","name":"Remote Services","id":"T1021"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0008/","name":"Lateral Movement","id":"TA0008"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1053/","name":"Scheduled Task/Job","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1053/005/","name":"Scheduled Task","id":"T1053.005"}],"id":"T1053"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002/","name":"Execution","id":"TA0002"}}],"to":"now","references":[],"version":3,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["winlogbeat-*","logs-system.*","logs-windows.*"],"query":"/* Network Logon followed by Scheduled Task creation  */\n\nsequence by winlog.computer_name with maxspan=1m\n  [authentication where event.action == \"logged-in\" and\n   winlog.logon.type == \"Network\" and event.outcome == \"success\" and\n   not user.name == \"ANONYMOUS LOGON\" and not winlog.event_data.SubjectUserName : \"*$\" and\n   not user.domain == \"NT AUTHORITY\" and source.ip != \"127.0.0.1\" and source.ip !=\"::1\"] by winlog.event_data.TargetLogonId\n\n  [iam where event.action == \"scheduled-task-created\"] by winlog.event_data.SubjectLogonId\n","actions":[]}
{"id":"073c7b20-d962-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.166Z","updated_by":"elastic","created_at":"2023-04-12T18:44:16.982Z","created_by":"elastic","name":"Potential Privilege Escalation via Local Kerberos Relay over LDAP [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Privilege Escalation","Credential Access"],"interval":"5m","enabled":true,"revision":1,"description":"Identifies a suspicious local successful logon event where the Logon Package is Kerberos, the remote address is set to localhost, and the target user SID is the built-in local Administrator account. This may indicate an attempt to leverage a Kerberos relay attack variant that can be used to elevate privilege locally from a domain joined limited user to local System privileges.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":".siem-signals-default","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"65e7620b-760d-403f-811c-3e0e4a2ea54a","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1548/","name":"Abuse Elevation Control Mechanism","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1548/002/","name":"Bypass User Account Control","id":"T1548.002"}],"id":"T1548"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0004/","name":"Privilege Escalation","id":"TA0004"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1558/","name":"Steal or Forge Kerberos Tickets","id":"T1558"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0006/","name":"Credential Access","id":"TA0006"}}],"to":"now","references":["https://github.com/Dec0ne/KrbRelayUp","https://googleprojectzero.blogspot.com/2021/10/using-kerberos-for-authentication-relay.html","https://github.com/cube0x0/KrbRelay"],"version":1,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["winlogbeat-*","logs-system.*"],"query":"authentication where\n\n /* event 4624 need to be logged */\n event.action == \"logged-in\" and event.outcome == \"success\" and\n\n /* authenticate locally via relayed kerberos ticket */\n winlog.event_data.AuthenticationPackageName : \"Kerberos\" and winlog.logon.type == \"Network\" and\n source.ip == \"127.0.0.1\" and source.port > 0 and\n\n /* Impersonate Administrator user via S4U2Self service ticket */\n winlog.event_data.TargetUserSid : \"S-1-5-21-*-500\"\n","actions":[]}
{"id":"8ec0d5c0-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.165Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.853Z","created_by":"elastic","name":"Service Creation via Local Kerberos Authentication [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Privilege Escalation","Credential Access","Active Directory"],"interval":"5m","enabled":true,"revision":102,"description":"Identifies a suspicious local successful logon event where the Logon Package is Kerberos, the remote address is set to localhost, followed by a sevice creation from the same LogonId. This may indicate an attempt to leverage a Kerberos relay attack variant that can be used to elevate privilege locally from a domain joined user to local System privileges.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":".siem-signals-default","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"41c1a7e4-7585-4ae6-8940-cf3d831e527d","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1543/","name":"Create or Modify System Process","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1543/003/","name":"Windows Service","id":"T1543.003"}],"id":"T1543"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0004/","name":"Privilege Escalation","id":"TA0004"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1558/","name":"Steal or Forge Kerberos Tickets","id":"T1558"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0006/","name":"Credential Access","id":"TA0006"}}],"to":"now","references":["https://github.com/Dec0ne/KrbRelayUp","https://googleprojectzero.blogspot.com/2021/10/using-kerberos-for-authentication-relay.html","https://github.com/cube0x0/KrbRelay","https://gist.github.com/tyranid/c24cfd1bd141d14d4925043ee7e03c82"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["winlogbeat-*","logs-system.*","logs-windows.*"],"query":"sequence by winlog.computer_name with maxspan=5m\n [authentication where\n\n  /* event 4624 need to be logged */\n  event.action == \"logged-in\" and event.outcome == \"success\" and\n\n  /* authenticate locally using relayed kerberos Ticket */\n  winlog.event_data.AuthenticationPackageName :\"Kerberos\" and winlog.logon.type == \"Network\" and\n  cidrmatch(source.ip, \"127.0.0.0/8\", \"::1\") and source.port > 0] by winlog.event_data.TargetLogonId\n\n  [any where\n   /* event 4697 need to be logged */\n   event.action : \"service-installed\"] by winlog.event_data.SubjectLogonId\n","actions":[]}
{"id":"8ec25c60-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.137Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.868Z","created_by":"elastic","name":"Remote Computer Account DnsHostName Update [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Privilege Escalation","Active Directory"],"interval":"5m","enabled":true,"revision":103,"description":"Identifies the remote update to a computer account's DnsHostName attribute. If the new value set is a valid domain controller DNS hostname and the subject computer name is not a domain controller, then it's highly likely a preparation step to exploit CVE-2022-26923 in an attempt to elevate privileges from a standard domain user to domain admin privileges.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":".siem-signals-default","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"bd7673e4-3398-48df-8ca1-4d6a3f8bb9c1","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1068/","name":"Exploitation for Privilege Escalation","id":"T1068"},{"reference":"https://attack.mitre.org/techniques/T1078/","name":"Valid Accounts","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1078/002/","name":"Domain Accounts","id":"T1078.002"}],"id":"T1078"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0004/","name":"Privilege Escalation","id":"TA0004"}}],"to":"now","references":["https://research.ifcr.dk/certifried-active-directory-domain-privilege-escalation-cve-2022-26923-9e098fe298f4","https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2022-26923"],"version":103,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["winlogbeat-*","logs-system.*","logs-windows.*"],"query":"sequence by winlog.computer_name with maxspan=5m\n\n  [authentication where event.action == \"logged-in\" and\n   winlog.logon.type == \"Network\" and event.outcome == \"success\" and\n   not user.name == \"ANONYMOUS LOGON\" and not winlog.event_data.SubjectUserName : \"*$\" and\n   not user.domain == \"NT AUTHORITY\" and source.ip != \"127.0.0.1\" and source.ip !=\"::1\"] by winlog.event_data.TargetLogonId\n\n  [iam where event.action == \"changed-computer-account\" and\n\n    /* if DnsHostName value equal a DC DNS hostname then it's highly suspicious */\n    winlog.event_data.DnsHostName : \"??*\" and\n\n    /* exclude FPs where DnsHostName starts with the ComputerName that was changed */\n    not startswith~(winlog.event_data.DnsHostName, substring(winlog.event_data.TargetUserName, 0, length(winlog.event_data.TargetUserName) - 1))\n    ] by winlog.event_data.SubjectLogonId\n","actions":[]}
{"id":"887e50a0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:39.872Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.457Z","created_by":"elastic","name":"Potential Shadow File Read via Command Line Utilities [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Privilege Escalation","Credential Access"],"interval":"5m","enabled":true,"revision":3,"description":"Identifies access to the /etc/shadow file via the commandline using standard system utilities. After elevating privileges to root, threat actors may attempt to read or dump this file in order to gain valid credentials. They may utilize these to move laterally undetected and access additional resources.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":"","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"689b216a-f0b5-4490-a4c5-9c4b6249cc90","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1068/","name":"Exploitation for Privilege Escalation","id":"T1068"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0004/","name":"Privilege Escalation","id":"TA0004"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1003/","name":"OS Credential Dumping","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1003/008/","name":"/etc/passwd and /etc/shadow","id":"T1003.008"}],"id":"T1003"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0006/","name":"Credential Access","id":"TA0006"}}],"to":"now","references":["https://www.cyberciti.biz/faq/unix-linux-password-cracking-john-the-ripper/"],"version":3,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-endpoint.events.*"],"query":"process where event.type == \"start\" and event.action == \"exec\" and user.name == \"root\"\n  and (process.args : \"/etc/shadow\" or (process.working_directory: \"/etc\" and process.args: \"shadow\"))\n  and not process.executable:\n    (\"/usr/bin/tar\",\n    \"/bin/tar\",\n    \"/usr/bin/gzip\",\n    \"/bin/gzip\",\n    \"/usr/bin/zip\",\n    \"/bin/zip\",\n    \"/usr/bin/stat\",\n    \"/bin/stat\",\n    \"/usr/bin/cmp\",\n    \"/bin/cmp\",\n    \"/usr/bin/sudo\",\n    \"/bin/sudo\",\n    \"/usr/bin/find\",\n    \"/bin/find\",\n    \"/usr/bin/ls\",\n    \"/bin/ls\",\n    \"/usr/bin/uniq\",\n    \"/bin/uniq\",\n    \"/usr/bin/unzip\",\n    \"/bin/unzip\")\n  and not process.parent.executable: \"/bin/dracut\"\n","actions":[]}
{"id":"887ec5d0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:42.902Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.466Z","created_by":"elastic","name":"Process Started from Process ID (PID) File [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Execution","BPFDoor","Elastic Endgame"],"interval":"5m","enabled":true,"revision":103,"description":"Identifies a new process starting from a process ID (PID), lock or reboot file within the temporary file storage paradigm (tmpfs) directory /var/run directory. On Linux, the PID files typically hold the process ID to track previous copies running and manage other tasks. Certain Linux malware use the /var/run directory for holding data, executables and other tasks, disguising itself or these files as legitimate PID files.","risk_score":73,"severity":"high","note":"## Triage and analysis\n\n### Investigating Process Started from Process ID (PID) File\nDetection alerts from this rule indicate a process spawned from an executable masqueraded as a legitimate PID file which is very unusual and should not occur. Here are some possible avenues of investigation:\n- Examine parent and child process relationships of the new process to determine if other processes are running.\n- Examine the /var/run directory using Osquery to determine other potential PID files with unsually large file sizes, indicative of it being an executable: \"SELECT f.size, f.uid, f.type, f.path from file f WHERE path like '/var/run/%%';\"\n- Examine the reputation of the SHA256 hash from the PID file in a database like VirusTotal to identify additional pivots and artifacts for investigation.","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["False-Positives (FP) should be at a minimum with this detection as PID files are meant to hold process IDs, not inherently be executables that spawn processes."],"from":"now-9m","rule_id":"4e397db8-de04-4441-a81c-9e9559f908df","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1059/","name":"Command and Scripting Interpreter","id":"T1059"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002/","name":"Execution","id":"TA0002"}}],"to":"now","references":["https://www.sandflysecurity.com/blog/linux-file-masquerading-and-malicious-pids-sandfly-1-2-6-update/","https://twitter.com/GossiTheDog/status/1522964028284411907","https://exatrack.com/public/Tricephalic_Hellkeeper.pdf","https://www.elastic.co/security-labs/a-peek-behind-the-bpfdoor"],"version":103,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["logs-endpoint.events.*","endgame-*"],"query":"process where event.type == \"start\" and user.id == \"0\" and process.executable regex~ \"\"\"/var/run/\\w+\\.(pid|lock|reboot)\"\"\"\n","actions":[]}
{"id":"8989a620-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.889Z","updated_by":"elastic","created_at":"2023-03-15T15:32:04.132Z","created_by":"elastic","name":"Hping Process Activity [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Discovery","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Hping ran on a Linux host. Hping is a FOSS command-line packet analyzer and has the ability to construct network packets for a wide variety of network security testing applications, including scanning and firewall auditing.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Normal use of hping is uncommon apart from security testing and research. Use by non-security engineers is very uncommon."],"from":"now-9m","rule_id":"5ce0f6f5-7355-43af-8f27-710014ae6203","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1082/","name":"System Information Discovery","id":"T1082"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0007/","name":"Discovery","id":"TA0007"}}],"to":"now","references":["https://en.wikipedia.org/wiki/Hping"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"event.category:process and event.type:(start or process_started) and process.name:(hping or hping2 or hping3)\n","actions":[]}
{"id":"88b03610-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:42.903Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.681Z","created_by":"elastic","name":"Masquerading Space After Filename [Duplicate]","tags":["Elastic","Host","Linux","macOS","Threat Detection","Defense Evasion"],"interval":"5m","enabled":true,"revision":2,"description":"This rules identifies a process created from an executable with a space appended to the end of the filename. This may indicate an attempt to masquerade a malicious file as benign to gain user execution. When a space is added to the end of certain files, the OS will execute the file according to it's true filetype instead of it's extension. Adversaries can hide a program's true filetype by changing the extension of the file. They can then add a space to the end of the name so that the OS automatically executes the file when it's double-clicked.","risk_score":47,"severity":"medium","note":"","license":"Elastic License v2","output_index":"","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"5c762efa-dca1-4161-9be4-8d72f08cb3f8","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1036/","name":"Masquerading","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1036/006/","name":"Space after Filename","id":"T1036.006"}],"id":"T1036"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0005/","name":"Defense Evasion","id":"TA0005"}}],"to":"now","references":["https://www.picussecurity.com/resource/blog/picus-10-critical-mitre-attck-techniques-t1036-masquerading"],"version":2,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-endpoint.events.*"],"query":"process where host.os.type:(\"linux\",\"macos\") and\n  event.type == \"start\" and\n  (process.executable regex~ \"\"\"/[a-z0-9\\s_\\-\\\\./]+\\s\"\"\") and not\n  process.name in (\"ls\", \"find\", \"grep\", \"xkbcomp\")\n","actions":[]}
{"id":"2d9a4da0-a6d7-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-06-08T21:03:44.304Z","updated_by":"elastic","created_at":"2023-02-07T11:04:23.700Z","created_by":"elastic","name":"Elastic Agent Offline","tags":["Octava","SOAR-UA-08","Custom Rules"],"interval":"5m","enabled":true,"revision":7,"description":"Elastic Agent Offline","risk_score":21,"severity":"low","license":"","output_index":"","meta":{"from":"48m","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"author":[],"false_positives":[],"from":"now-3180s","rule_id":"e5c2b84f-344d-44fa-b09f-e1ae096d4303","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[],"to":"now","references":[],"version":7,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"kuery","data_view_id":".fleet-agents","query":"last_checkin<now-1h","filters":[],"threshold":{"field":["local_metadata.host.hostname.keyword"],"value":1,"cardinality":[]},"actions":[]}
{"id":"898cda70-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.881Z","updated_by":"elastic","created_at":"2023-03-15T15:32:04.172Z","created_by":"elastic","name":"Potential Privilege Escalation via Sudoers File Modification [Duplicate]","tags":["Elastic","Host","Linux","macOS","Threat Detection","Privilege Escalation"],"interval":"5m","enabled":true,"revision":101,"description":"A sudoers file specifies the commands users or groups can run and from which terminals. Adversaries can take advantage of these configurations to execute commands as other users or spawn processes with higher privileges.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"af1b2655-ddb4-43c2-8043-29b3cc9bda08","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1548/","name":"Abuse Elevation Control Mechanism","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1548/003/","name":"Sudo and Sudo Caching","id":"T1548.003"}],"id":"T1548"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0004/","name":"Privilege Escalation","id":"TA0004"}}],"to":"now","references":[],"version":101,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*"],"query":"event.category:process and event.type:start and process.args:(echo and *NOPASSWD*ALL*)\n","actions":[]}
{"id":"23766ee0-d962-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.166Z","updated_by":"elastic","created_at":"2023-04-12T18:45:04.339Z","created_by":"elastic","name":"Group Policy Abuse for Privilege Addition [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Privilege Escalation","Active Directory","Investigation Guide"],"interval":"5m","enabled":true,"revision":104,"description":"Detects the first occurrence of a modification to Group Policy Object Attributes to add privileges to user accounts or use them to add users as local admins.","risk_score":73,"severity":"high","note":"## Triage and analysis\n\n### Investigating Group Policy Abuse for Privilege Addition\n\nGroup Policy Objects (GPOs) can be used to add rights and/or modify Group Membership on GPOs by changing the contents of an INF file named GptTmpl.inf, which is responsible for storing every setting under the Security Settings container in the GPO. This file is unique for each GPO, and only exists if the GPO contains security settings. Example Path: \"\\\\DC.com\\SysVol\\DC.com\\Policies\\{PolicyGUID}\\Machine\\Microsoft\\Windows NT\\SecEdit\\GptTmpl.inf\"\n\n#### Possible investigation steps\n\n- This attack abuses a legitimate mechanism of Active Directory, so it is important to determine whether the activity is legitimate and the administrator is authorized to perform this operation.\n- Retrieve the contents of the `GptTmpl.inf` file, and under the `Privilege Rights` section, look for potentially dangerous high privileges, for example: SeTakeOwnershipPrivilege, SeEnableDelegationPrivilege, etc.\n- Inspect the user security identifiers (SIDs) associated with these privileges, and if they should have these privileges.\n\n### False positive analysis\n\n- Inspect whether the user that has done the modifications should be allowed to. The user name can be found in the `winlog.event_data.SubjectUserName` field.\n\n### Related rules\n\n- Scheduled Task Execution at Scale via GPO - 15a8ba77-1c13-4274-88fe-6bd14133861e\n- Startup/Logon Script added to Group Policy Object - 16fac1a1-21ee-4ca6-b720-458e3855d046\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- The investigation and containment must be performed in every computer controlled by the GPO, where necessary.\n- Remove the script from the GPO.\n- Check if other GPOs have suspicious scripts attached.","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-6m","rule_id":"39d11862-e963-4609-9608-0281b764538a","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1484/","name":"Domain Policy Modification","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1484/001/","name":"Group Policy Modification","id":"T1484.001"}],"id":"T1484"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0004/","name":"Privilege Escalation","id":"TA0004"}}],"to":"now","references":["https://github.com/atc-project/atc-data/blob/master/docs/Logging_Policies/LP_0025_windows_audit_directory_service_changes.md","https://labs.f-secure.com/tools/sharpgpoabuse"],"version":104,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["winlogbeat-*","logs-system.*","logs-windows.*"],"query":"event.code: \"5136\" and winlog.event_data.AttributeLDAPDisplayName:\"gPCMachineExtensionNames\" and\nwinlog.event_data.AttributeValue:(*827D319E-6EAC-11D2-A4EA-00C04F79F83A* and *803E14A0-B4FB-11D0-A0D0-00A0C90F574B*)\n","actions":[]}
{"id":"887fd740-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.882Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.489Z","created_by":"elastic","name":"Potential Disabling of SELinux [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Defense Evasion","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Identifies potential attempts to disable Security-Enhanced Linux (SELinux), which is a Linux kernel security feature to support access control policies. Adversaries may disable security tools to avoid possible detection of their tools and activities.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"7463b1c5-9860-4e4e-80dd-767a29fb3fcc","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1562/","name":"Impair Defenses","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1562/001/","name":"Disable or Modify Tools","id":"T1562.001"}],"id":"T1562"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0005/","name":"Defense Evasion","id":"TA0005"}}],"to":"now","references":[],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"event.category:process and event.type:(start or process_started) and process.name:setenforce and process.args:0\n","actions":[]}
{"id":"89895800-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.876Z","updated_by":"elastic","created_at":"2023-03-15T15:32:04.135Z","created_by":"elastic","name":"Nping Process Activity [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Discovery","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Nping ran on a Linux host. Nping is part of the Nmap tool suite and has the ability to construct raw packets for a wide variety of security testing applications, including denial of service testing.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Some normal use of this command may originate from security engineers and network or server administrators, but this is usually not routine or unannounced. Use of `Nping` by non-engineers or ordinary users is uncommon."],"from":"now-9m","rule_id":"c22dbc69-ab3d-4a7b-9d11-f1608859f7b2","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1046/","name":"Network Service Discovery","id":"T1046"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0007/","name":"Discovery","id":"TA0007"}}],"to":"now","references":["https://en.wikipedia.org/wiki/Nmap"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"event.category:process and event.type:(start or process_started) and process.name:nping\n","actions":[]}
{"id":"887ace30-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.895Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.382Z","created_by":"elastic","name":"BPF filter applied using TC [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Execution","TripleCross","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Detects when the tc (transmission control) binary is utilized to set a BPF (Berkeley Packet Filter) on a network interface. Tc is used to configure Traffic Control in the Linux kernel. It can shape, schedule, police and drop traffic. A threat actor can utilize tc to set a bpf filter on an interface for the purpose of manipulating the incoming traffic. This technique is not at all common and should indicate abnormal, suspicious or malicious activity.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"4b761b69-076e-4300-8b3e-4d0e8eb35d85","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1059/","name":"Command and Scripting Interpreter","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1059/004/","name":"Unix Shell","id":"T1059.004"}],"id":"T1059"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002/","name":"Execution","id":"TA0002"}}],"to":"now","references":["https://github.com/h3xduck/TripleCross/blob/master/src/helpers/deployer.sh","https://man7.org/linux/man-pages/man8/tc.8.html"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["logs-endpoint.events.*","endgame-*"],"query":"process where event.type != \"end\" and process.executable : \"/usr/sbin/tc\" and process.args : \"filter\" and process.args : \"add\" and process.args : \"bpf\" and not process.parent.executable: \"/usr/sbin/libvirtd\"\n","actions":[]}
{"id":"8989cd30-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:39.866Z","updated_by":"elastic","created_at":"2023-03-15T15:32:04.129Z","created_by":"elastic","name":"Potential DNS Tunneling via Iodine [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Command and Control","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Iodine is a tool for tunneling Internet protocol version 4 (IPV4) traffic over the DNS protocol to circumvent firewalls, network security groups, and network access lists while evading detection.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Normal use of Iodine is uncommon apart from security testing and research. Use by non-security engineers is very uncommon."],"from":"now-9m","rule_id":"9ae84e0a-e655-4d0e-8264-ea89d804f9ef","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1572/","name":"Protocol Tunneling","id":"T1572"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0011/","name":"Command and Control","id":"TA0011"}}],"to":"now","references":["https://code.kryo.se/iodine/"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"event.category:process and event.type:(start or process_started) and process.name:(iodine or iodined)\n","actions":[]}
{"id":"d9ea4450-d960-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-20T22:40:37.517Z","updated_by":"elastic","created_at":"2023-04-12T18:35:51.450Z","created_by":"elastic","name":"Windows Event Logs Cleared [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Defense Evasion","Investigation Guide"],"interval":"5m","enabled":true,"revision":105,"description":"Identifies attempts to clear Windows event log stores. This is often done by attackers in an attempt to evade detection or destroy forensic evidence on a system.","risk_score":21,"severity":"low","note":"## Triage and analysis\n\n### Investigating Windows Event Logs Cleared\n\nWindows event logs are a fundamental data source for security monitoring, forensics, and incident response. Adversaries can tamper, clear, and delete this data to break SIEM detections, cover their tracks, and slow down incident response.\n\nThis rule looks for the occurrence of clear actions on the `security` event log.\n\n#### Possible investigation steps\n\n- Investigate the process execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence, whether they are located in expected locations, and if they are signed with valid digital signatures.\n- Identify the user account that performed the action and whether it should perform this kind of action.\n- Contact the account owner and confirm whether they are aware of this activity.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n  - Verify if any other anti-forensics behaviors were observed.\n- Investigate the event logs prior to the action for suspicious behaviors that an attacker may be trying to cover up.\n\n### False positive analysis\n\n- This activity is unlikely to happen legitimately. Benign true positives (B-TPs) can be added as exceptions if necessary.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n  - This activity is potentially done after the adversary achieves its objectives on the host. Ensure that previous actions, if any, are investigated accordingly with their response playbooks.\n- Isolate the involved host to prevent further post-compromise behavior.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","license":"Elastic License v2","output_index":"","meta":{"from":"4m"},"timestamp_override":"event.ingested","author":["Elastic","Anabella Cristaldi"],"false_positives":[],"from":"now-540s","rule_id":"12ef393c-2b1f-4c50-8a10-9fea5b8ddd0c","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"reference":"https://attack.mitre.org/tactics/TA0005/","name":"Defense Evasion","id":"TA0005"},"technique":[{"reference":"https://attack.mitre.org/techniques/T1070/","name":"Indicator Removal","id":"T1070","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1070/001/","name":"Clear Windows Event Logs","id":"T1070.001"}]}]}],"to":"now","references":[],"version":105,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["winlogbeat-*","logs-system.*","logs-windows.*"],"query":"event.action:(\"audit-log-cleared\" or \"Log clear\") and not winlog.user_data.Channel:\"Microsoft-Exchange-ManagedAvailability/ThrottlingConfig\"\n","filters":[],"actions":[]}
{"id":"898d2890-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.878Z","updated_by":"elastic","created_at":"2023-03-15T15:32:04.181Z","created_by":"elastic","name":"Potential Protocol Tunneling via EarthWorm [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Command and Control","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Identifies the execution of the EarthWorm tunneler. Adversaries may tunnel network communications to and from a victim system within a separate protocol to avoid detection and network filtering, or to enable access to otherwise unreachable systems.","risk_score":47,"severity":"medium","note":"","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"3a35b8a4-39c9-401d-a36d-02d6bb921408","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1572/","name":"Protocol Tunneling","id":"T1572"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0011/","name":"Command and Control","id":"TA0011"}}],"to":"now","references":["http://rootkiter.com/EarthWorm/","https://decoded.avast.io/luigicamastra/apt-group-targeting-governmental-agencies-in-east-asia/"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"process where event.type == \"start\" and\n process.args : \"-s\" and process.args : \"-d\" and process.args : \"rssocks\"\n","actions":[]}
{"id":"886b8bf0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:39.864Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.269Z","created_by":"elastic","name":"Strace Process Activity [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Privilege Escalation"],"interval":"5m","enabled":true,"revision":8,"description":"Strace is a useful diagnostic, instructional, and debugging tool. This rule identifies a privileged context execution of strace which can be used to escape restrictive environments by instantiating a shell in order to elevate privileges or move laterally.","risk_score":21,"severity":"low","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Strace is a dual-use tool that can be used for benign or malicious activity. Some normal use of this command may originate from developers or SREs engaged in debugging or system call tracing."],"from":"now-9m","rule_id":"1ba0f1ba-b752-44da-871d-d3fac6d53bcb","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1068/","name":"Exploitation for Privilege Escalation","id":"T1068"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0004/","name":"Privilege Escalation","id":"TA0004"}}],"to":"now","references":["https://en.wikipedia.org/wiki/Strace"],"version":8,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*"],"query":"event.category:process and event.type:(start or process_started) and process.name:strace\n","actions":[]}
{"id":"8ec2d190-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.158Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.879Z","created_by":"elastic","name":"Potential Shadow Credentials added to AD Object [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Credential Access","Active Directory"],"interval":"5m","enabled":true,"revision":103,"description":"Identify the modification of the msDS-KeyCredentialLink attribute in an Active Directory Computer or User Object. Attackers can abuse control over the object and create a key pair, append to raw public key in the attribute, and obtain persistent and stealthy access to the target user or computer object.","risk_score":73,"severity":"high","note":"","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Modifications in the msDS-KeyCredentialLink attribute can be done legitimately by the Azure AD Connect synchronization account or the ADFS service account. These accounts can be added as Exceptions."],"from":"now-9m","rule_id":"fa1a392d-22a7-40c0-8bd6-2e8d4be2515f","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1556/","name":"Modify Authentication Process","id":"T1556"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0006/","name":"Credential Access","id":"TA0006"}}],"to":"now","references":["https://posts.specterops.io/shadow-credentials-abusing-key-trust-account-mapping-for-takeover-8ee1a53566ab","https://www.thehacker.recipes/ad/movement/kerberos/shadow-credentials","https://github.com/OTRF/Set-AuditRule","https://cyberstoph.org/posts/2022/03/detecting-shadow-credentials/"],"version":103,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["winlogbeat-*","logs-system.*","logs-windows.*"],"query":"event.action:\"Directory Service Changes\" and event.code:\"5136\" and\n winlog.event_data.AttributeLDAPDisplayName:\"msDS-KeyCredentialLink\" and winlog.event_data.AttributeValue :B\\:828* and not winlog.event_data.SubjectUserName: MSOL_*\n","actions":[]}
{"id":"887a0ae0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:42.904Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.389Z","created_by":"elastic","name":"High Number of Process Terminations [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Impact","Investigation Guide","Elastic Endgame"],"interval":"5m","enabled":true,"revision":104,"description":"This rule identifies a high number (10) of process terminations via pkill from the same host within a short time period.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n\n### Investigating High Number of Process Terminations\n\nAttackers can kill processes for a variety of purposes. For example, they can kill process associated with business applications and databases to release the lock on files used by these applications so they may be encrypted,or stop security and backup solutions, etc.\n\nThis rule identifies a high number (10) of process terminations via pkill from the same host within a short time period.\n\n#### Possible investigation steps\n\n- Examine the entry point to the host and user in action via the Analyse View.\n  - Identify the session entry leader and session user.\n- Examine the contents of session leading to the process termination(s) via the Session View.\n  - Examine the command execution pattern in the session, which may lead to suspricous activities.\n- Examine the process killed during the malicious execution\n  - Identify imment threat to the system from the process killed.\n  - Take necessary incident response actions to respawn necessary process.\n\n### False positive analysis\n\n- This activity is unlikely to happen legitimately. Benign true positives (B-TPs) can be added as exceptions if necessary.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further destructive behavior, which is commonly associated with this activity.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Reimage the host operating system or restore it to the operational state.\n- If any other destructive action was identified on the host, it is recommended to prioritize the investigation and look for ransomware preparation and execution activities.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","license":"Elastic License v2","output_index":".siem-signals-default","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"a6417848-3dc4-4f78-9e40-c29c7e04c0b7","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1489/","name":"Service Stop","id":"T1489"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0040/","name":"Impact","id":"TA0040"}}],"to":"now","references":[],"version":104,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"kuery","index":["logs-endpoint.events.*","endgame-*"],"query":"event.category:process and event.type:start and process.name:\"pkill\" and process.args:\"-f\"\n","threshold":{"field":["host.id"],"value":10},"actions":[]}
{"id":"2d46caf0-d962-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.162Z","updated_by":"elastic","created_at":"2023-04-12T18:45:20.803Z","created_by":"elastic","name":"Kerberos Pre-authentication Disabled for User [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Credential Access","Investigation Guide","Active Directory"],"interval":"5m","enabled":true,"revision":104,"description":"Identifies the modification of an account's Kerberos pre-authentication options. An adversary with GenericWrite/GenericAll rights over the account can maliciously modify these settings to perform offline password cracking attacks such as AS-REP roasting.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n\n### Investigating Kerberos Pre-authentication Disabled for User\n\nKerberos pre-authentication is an account protection against offline password cracking. When enabled, a user requesting access to a resource initiates communication with the Domain Controller (DC) by sending an Authentication Server Request (AS-REQ) message with a timestamp that is encrypted with the hash of their password. If and only if the DC is able to successfully decrypt the timestamp with the hash of the user’s password, it will then send an Authentication Server Response (AS-REP) message that contains the Ticket Granting Ticket (TGT) to the user. Part of the AS-REP message is signed with the user’s password. Microsoft's security monitoring [recommendations](https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4738) state that `'Don't Require Preauth' – Enabled` should not be enabled for user accounts because it weakens security for the account’s Kerberos authentication.\n\nAS-REP roasting is an attack against Kerberos for user accounts that do not require pre-authentication, which means that if the target user has pre-authentication disabled, an attacker can request authentication data for it and get a TGT that can be brute-forced offline, similarly to Kerberoasting.\n\n#### Possible investigation steps\n\n- Identify the user account that performed the action and whether it should perform this kind of action.\n- Contact the account owner and confirm whether they are aware of this activity.\n- Determine if the target account is sensitive or privileged.\n- Inspect the account activities for suspicious or abnormal behaviors in the alert timeframe.\n\n### False positive analysis\n\n- Disabling pre-authentication is a bad security practice and should not be allowed in the domain. The security team should map and monitor any potential benign true positives (B-TPs), especially if the target account is privileged.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Reset the target account's password if there is any risk of TGTs having been retrieved.\n- Re-enable the preauthentication option or disable the target account.\n- Review the privileges assigned to the involved users to ensure that the least privilege principle is being followed.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"a9e198b7-686c-4ef4-b1f2-5afca4ee3b01","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1558/","name":"Steal or Forge Kerberos Tickets","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1558/004/","name":"AS-REP Roasting","id":"T1558.004"}],"id":"T1558"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0006/","name":"Credential Access","id":"TA0006"}}],"to":"now","references":["https://harmj0y.medium.com/roasting-as-reps-e6179a65216b","https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4738","https://github.com/atc-project/atomic-threat-coverage/blob/master/Atomic_Threat_Coverage/Logging_Policies/LP_0026_windows_audit_user_account_management.md"],"version":104,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["winlogbeat-*","logs-system.*","logs-windows.*"],"query":"event.code:4738 and message:\"'Don't Require Preauth' - Enabled\"\n","actions":[]}
{"id":"887772d0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:39.864Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.416Z","created_by":"elastic","name":"Attempt to Disable IPTables or Firewall [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Defense Evasion"],"interval":"5m","enabled":true,"revision":7,"description":"Adversaries may attempt to disable the iptables or firewall service in an attempt to affect how a host is allowed to receive or send network traffic.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"a81473e0-95b6-45f5-8106-ea0bc3995b4f","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1562/","name":"Impair Defenses","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1562/001/","name":"Disable or Modify Tools","id":"T1562.001"}],"id":"T1562"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0005/","name":"Defense Evasion","id":"TA0005"}}],"to":"now","references":[],"version":7,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*"],"query":"event.category:process and event.type:(start or process_started) and\n  process.name:ufw and process.args:(allow or disable or reset) or\n\n  (((process.name:service and process.args:stop) or\n     (process.name:chkconfig and process.args:off) or\n     (process.name:systemctl and process.args:(disable or stop or kill))) and\n   process.args:(firewalld or ip6tables or iptables))\n","actions":[]}
{"id":"8989f440-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:39.870Z","updated_by":"elastic","created_at":"2023-03-15T15:32:04.138Z","created_by":"elastic","name":"Potential Cookies Theft via Browser Debugging [Duplicate]","tags":["Elastic","Host","Linux","Windows","macOS","Threat Detection","Credential Access"],"interval":"5m","enabled":true,"revision":101,"description":"Identifies the execution of a Chromium based browser with the debugging process argument, which may indicate an attempt to steal authentication cookies. An adversary may steal web application or service session cookies and use them to gain access web applications or Internet services as an authenticated user without needing credentials.","risk_score":47,"severity":"medium","note":"","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Developers performing browsers plugin or extension debugging."],"from":"now-9m","rule_id":"cbd63474-814e-4e59-88f5-baad86b6c6e4","max_signals":33,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1539/","name":"Steal Web Session Cookie","id":"T1539"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0006/","name":"Credential Access","id":"TA0006"}}],"to":"now","references":["https://github.com/defaultnamehere/cookie_crimes","https://embracethered.com/blog/posts/2020/cookie-crimes-on-mirosoft-edge/","https://github.com/rapid7/metasploit-framework/blob/master/documentation/modules/post/multi/gather/chrome_cookies.md","https://posts.specterops.io/hands-in-the-cookie-jar-dumping-cookies-with-chromiums-remote-debugger-port-34c4f468844e"],"version":101,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","winlogbeat-*","logs-endpoint.events.*","logs-windows.*"],"query":"process where event.type in (\"start\", \"process_started\", \"info\") and\n  process.name in (\n             \"Microsoft Edge\",\n             \"chrome.exe\",\n             \"Google Chrome\",\n             \"google-chrome-stable\",\n             \"google-chrome-beta\",\n             \"google-chrome\",\n             \"msedge.exe\") and\n   process.args : (\"--remote-debugging-port=*\",\n                   \"--remote-debugging-targets=*\",\n                   \"--remote-debugging-pipe=*\") and\n   process.args : \"--user-data-dir=*\" and not process.args:\"--remote-debugging-port=0\"\n","actions":[]}
{"id":"88b0ab40-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:42.913Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.683Z","created_by":"elastic","name":"Potential Non-Standard Port SSH connection [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Command and Control","macOS"],"interval":"5m","enabled":true,"revision":2,"description":"Identifies potentially malicious processes communicating via a port paring typically not associated with SSH. For example, SSH over port 2200 or port 2222 as opposed to the traditional port 22. Adversaries may make changes to the standard port a protocol uses to bypass filtering or muddle analysis/parsing of network data.","risk_score":21,"severity":"low","license":"Elastic License v2","output_index":"","author":["Elastic"],"false_positives":["SSH over ports apart from the traditional port 22 is highly uncommon. This rule alerts the usage of the such uncommon ports by the ssh service. Tuning is needed to have higher confidence. If this activity is expected and noisy in your environment, consider adding exceptions — preferably with a combination whitelisted ports for such legitimate ssh activities."],"from":"now-9m","rule_id":"f7415967-e36f-42b8-9015-b17edc7283df","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1571/","name":"Non-Standard Port","id":"T1571"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0011/","name":"Command and Control","id":"TA0011"}}],"to":"now","references":["https://attack.mitre.org/techniques/T1571/"],"version":2,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["logs-endpoint.events.*"],"query":"sequence by process.entity_id with maxspan=1m\n[process where event.action == \"exec\" and process.name:\"ssh\"]\n[network where process.name:\"ssh\"\n and event.action in (\"connection_attempted\", \"connection_accepted\")\n and destination.port != 22\n and destination.ip != \"127.0.0.1\"\n and network.transport: \"tcp\"\n]\n","actions":[]}
{"id":"ea003290-d961-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.154Z","updated_by":"elastic","created_at":"2023-04-12T18:43:27.933Z","created_by":"elastic","name":"Suspicious Process Execution via Renamed PsExec Executable [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Execution","Elastic Endgame"],"interval":"5m","enabled":true,"revision":103,"description":"Identifies suspicious psexec activity which is executing from the psexec service that has been renamed, possibly to evade detection.","risk_score":47,"severity":"medium","note":"","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"b8d9aa3b-6155-4a83-9ee5-2653b3ebf3db","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1569/","name":"System Services","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1569/002/","name":"Service Execution","id":"T1569.002"}],"id":"T1569"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002/","name":"Execution","id":"TA0002"}}],"to":"now","references":[],"version":103,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["winlogbeat-*","logs-endpoint.events.*","logs-windows.*","endgame-*"],"query":"process where event.type == \"start\" and\n  process.pe.original_file_name : \"psexesvc.exe\" and not process.name : \"PSEXESVC.exe\"\n","actions":[]}
{"id":"8ec087a0-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.154Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.851Z","created_by":"elastic","name":"KRBTGT Delegation Backdoor [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Persistence","Active Directory"],"interval":"5m","enabled":true,"revision":102,"description":"Identifies the modification of the msDS-AllowedToDelegateTo attribute to KRBTGT. Attackers can use this technique to maintain persistence to the domain by having the ability to request tickets for the KRBTGT service.","risk_score":73,"severity":"high","note":"","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"1ca426ba-967d-484d-b03e-25d5993f44cc","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1098/","name":"Account Manipulation","id":"T1098"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1558/","name":"Steal or Forge Kerberos Tickets","id":"T1558"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0006/","name":"Credential Access","id":"TA0006"}}],"to":"now","references":["https://skyblue.team/posts/delegate-krbtgt","https://github.com/atc-project/atomic-threat-coverage/blob/master/Atomic_Threat_Coverage/Logging_Policies/LP_0026_windows_audit_user_account_management.md"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["winlogbeat-*","logs-system.*","logs-windows.*"],"query":"event.action:modified-user-account and event.code:4738 and winlog.event_data.AllowedToDelegateTo:*krbtgt*\n","actions":[]}
{"id":"887e2990-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T15:34:55.599Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.484Z","created_by":"elastic","name":"Enumeration of Kernel Modules [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Discovery","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Loadable Kernel Modules (or LKMs) are pieces of code that can be loaded and unloaded into the kernel upon demand. They extend the functionality of the kernel without the need to reboot the system. This identifies attempts to enumerate information about a kernel module.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Security tools and device drivers may run these programs in order to enumerate kernel modules. Use of these programs by ordinary users is uncommon. These can be exempted by process name or username."],"from":"now-9m","rule_id":"ce0bc6ee-42ee-4b73-a245-67f3a494bd83","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1082/","name":"System Information Discovery","id":"T1082"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0007/","name":"Discovery","id":"TA0007"}}],"to":"now","references":[],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"event.category:process and event.type:(start or process_started) and\n  process.args:(kmod and list and sudo or sudo and (depmod or lsmod or modinfo))\n","actions":[]}
{"id":"8877e800-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:42.906Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.396Z","created_by":"elastic","name":"Connection to Internal Network via Telnet [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Lateral Movement"],"interval":"5m","enabled":true,"revision":101,"description":"Telnet provides a command line interface for communication with a remote device or server. This rule identifies Telnet network connections to non-publicly routable IP addresses.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":".siem-signals-default","author":["Elastic"],"false_positives":["Telnet can be used for both benign or malicious purposes. Telnet is included by default in some Linux distributions, so its presence is not inherently suspicious. The use of Telnet to manage devices remotely has declined in recent years in favor of more secure protocols such as SSH. Telnet usage by non-automated tools or frameworks may be suspicious."],"from":"now-9m","rule_id":"31feb4e5-ebe8-42b7-a82b-9e733f97f08b","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1021/","name":"Remote Services","id":"T1021"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0008/","name":"Lateral Movement","id":"TA0008"}}],"to":"now","references":["https://www.iana.org/assignments/iana-ipv4-special-registry/iana-ipv4-special-registry.xhtml"],"version":101,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-endpoint.events.*"],"query":"sequence by process.entity_id\n  [process where process.name == \"telnet\" and event.type == \"start\"]\n  [network where process.name == \"telnet\" and\n    cidrmatch(destination.ip, \"10.0.0.0/8\", \"127.0.0.0/8\", \"169.254.0.0/16\", \"172.16.0.0/12\", \"192.0.0.0/24\",\n                              \"192.0.0.0/29\", \"192.0.0.8/32\", \"192.0.0.9/32\", \"192.0.0.10/32\", \"192.0.0.170/32\",\n                              \"192.0.0.171/32\", \"192.0.2.0/24\", \"192.31.196.0/24\", \"192.52.193.0/24\",\n                              \"192.168.0.0/16\", \"192.88.99.0/24\", \"224.0.0.0/4\", \"100.64.0.0/10\", \"192.175.48.0/24\",\n                              \"198.18.0.0/15\", \"198.51.100.0/24\", \"203.0.113.0/24\", \"240.0.0.0/4\", \"::1\",\n                              \"FE80::/10\", \"FF00::/8\")]\n","actions":[]}
{"id":"8ec03980-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.152Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.846Z","created_by":"elastic","name":"AdminSDHolder Backdoor [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Persistence","Active Directory"],"interval":"5m","enabled":true,"revision":102,"description":"Detects modifications in the AdminSDHolder object. Attackers can abuse the SDProp process to implement a persistent backdoor in Active Directory. SDProp compares the permissions on protected objects with those defined on the AdminSDHolder object. If the permissions on any of the protected accounts and groups do not match, the permissions on the protected accounts and groups are reset to match those of the domain's AdminSDHolder object, regaining their Administrative Privileges.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"01b677f3-ca76-4d22-b3fd-f426cc420647","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}}],"to":"now","references":["https://adsecurity.org/?p=1906","https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/appendix-c--protected-accounts-and-groups-in-active-directory#adminsdholder"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["winlogbeat-*","logs-system.*","logs-windows.*"],"query":"event.action:\"Directory Service Changes\" and event.code:5136 and winlog.event_data.ObjectDN:CN=AdminSDHolder,CN=System*\n","actions":[]}
{"id":"2dd3cf20-462a-11ed-b5fa-0d281afe1344","updated_at":"2023-06-08T21:03:44.308Z","updated_by":"elastic","created_at":"2022-10-07T10:24:09.088Z","created_by":"elastic","name":"MSExchange domain technical account connect from two countries","tags":["Octava Defence","prod","SOAR-UA-27","Custom Rules"],"interval":"5m","enabled":true,"revision":12,"description":"MSExchange domain technical account connect from two countries","risk_score":47,"severity":"medium","license":"","output_index":"","meta":{"from":"24h","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":[],"false_positives":[],"from":"now-86700s","rule_id":"4bf94c3d-15e3-48ce-b089-517bdf68f12e","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[],"to":"now","references":[],"version":12,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"kuery","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"event.code:4624 AND source.as.number:* AND NOT source.as.organization.name:MICROSOFT* AND NOT source.geo.country_name:\"Ukraine\" AND NOT source.as.organization.name:\"SPACEX-STARLINK\" AND user.name:*_* AND host.name:(*exch* OR *EXCH*)","filters":[],"threshold":{"field":["user.name"],"value":2,"cardinality":[{"field":"source.geo.country_name","value":2}]},"actions":[]}
{"id":"887f8920-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:42.904Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.477Z","created_by":"elastic","name":"Interactive Terminal Spawned via Perl [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Execution","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Identifies when a terminal (tty) is spawned via Perl. Attackers may upgrade a simple reverse shell to a fully interactive tty after obtaining initial access to a host.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"79588b20-7b27-4c75-88ab-5415dfc77b4d","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1059/","name":"Command and Scripting Interpreter","id":"T1059"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002/","name":"Execution","id":"TA0002"}}],"to":"now","references":[],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"event.category:process and event.type:(start or process_started) and process.name:perl and\n  process.args:(\"exec \\\"/bin/sh\\\";\" or \"exec \\\"/bin/dash\\\";\" or \"exec \\\"/bin/bash\\\";\")\n","actions":[]}
{"id":"887d1820-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:39.869Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.451Z","created_by":"elastic","name":"Kernel Module Removal [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Defense Evasion","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Kernel modules are pieces of code that can be loaded and unloaded into the kernel upon demand. They extend the functionality of the kernel without the need to reboot the system. This rule identifies attempts to remove a kernel module.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["There is usually no reason to remove modules, but some buggy modules require it. These can be exempted by username. Note that some Linux distributions are not built to support the removal of modules at all."],"from":"now-9m","rule_id":"703ef479-a956-4a81-ad90-bd962f3b1176","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1562/","name":"Impair Defenses","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1562/001/","name":"Disable or Modify Tools","id":"T1562.001"}],"id":"T1562"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0005/","name":"Defense Evasion","id":"TA0005"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1547/","name":"Boot or Logon Autostart Execution","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1547/006/","name":"Kernel Modules and Extensions","id":"T1547.006"}],"id":"T1547"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}}],"to":"now","references":["http://man7.org/linux/man-pages/man8/modprobe.8.html"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"event.category:process and event.type:(start or process_started) and\n  process.args:((rmmod and sudo) or (modprobe and sudo and (\"--remove\" or \"-r\")))\n","actions":[]}
{"id":"898a6970-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.893Z","updated_by":"elastic","created_at":"2023-03-15T15:32:04.143Z","created_by":"elastic","name":"SSH Authorized Keys File Modification [Duplicate]","tags":["Elastic","Host","Linux","macOS","Threat Detection","Lateral Movement","Persistence"],"interval":"5m","enabled":true,"revision":102,"description":"The Secure Shell (SSH) authorized_keys file specifies which users are allowed to log into a server using public key authentication. Adversaries may modify it to maintain persistence on a victim host by adding their own public key(s).","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"075b68fb-34bb-40e2-a154-8f4155c777d3","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1098/","name":"Account Manipulation","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1098/004/","name":"SSH Authorized Keys","id":"T1098.004"}],"id":"T1098"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1563/","name":"Remote Service Session Hijacking","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1563/001/","name":"SSH Hijacking","id":"T1563.001"}],"id":"T1563"},{"reference":"https://attack.mitre.org/techniques/T1021/","name":"Remote Services","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1021/004/","name":"SSH","id":"T1021.004"}],"id":"T1021"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0008/","name":"Lateral Movement","id":"TA0008"}}],"to":"now","references":[],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*"],"query":"event.category:file and event.type:(change or creation) and\n file.name:(\"authorized_keys\" or \"authorized_keys2\" or \"/etc/ssh/sshd_config\" or \"/root/.ssh\") and\n not process.executable:\n             (/Library/Developer/CommandLineTools/usr/bin/git or\n              /usr/local/Cellar/maven/*/libexec/bin/mvn or\n              /Library/Java/JavaVirtualMachines/jdk*.jdk/Contents/Home/bin/java or\n              /usr/bin/vim or\n              /usr/local/Cellar/coreutils/*/bin/gcat or\n              /usr/bin/bsdtar or\n              /usr/bin/nautilus or\n              /usr/bin/scp or\n              /usr/bin/touch or\n              /var/lib/docker/* or\n              /usr/bin/google_guest_agent or \n              /opt/jc/bin/jumpcloud-agent)\n","actions":[]}
{"id":"898c3e30-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.877Z","updated_by":"elastic","created_at":"2023-03-15T15:32:04.165Z","created_by":"elastic","name":"Bash Shell Profile Modification [Duplicate]","tags":["Elastic","Host","macOS","Linux","Threat Detection","Persistence"],"interval":"5m","enabled":true,"revision":101,"description":"Both ~/.bash_profile and ~/.bashrc are files containing shell commands that are run when Bash is invoked. These files are executed in a user's context, either interactively or non-interactively, when a user logs in so that their environment is set correctly. Adversaries may abuse this to establish persistence by executing malicious content triggered by a user’s shell.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Changes to the Shell Profile tend to be noisy, a tuning per your environment will be required."],"from":"now-9m","rule_id":"f9fe35ed-97df-466c-b3a4-6cf1a8e0902b","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1546/","name":"Event Triggered Execution","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1546/004/","name":"Unix Shell Configuration Modification","id":"T1546.004"}],"id":"T1546"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}}],"to":"now","references":["https://www.anomali.com/blog/pulling-linux-rabbit-rabbot-malware-out-of-a-hat"],"version":101,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["logs-endpoint.events.*","auditbeat-*"],"query":"event.category:file and event.type:change and\n  process.name:(* and not (sudo or\n                           vim or\n                           zsh or\n                           env or\n                           nano or\n                           bash or\n                           Terminal or\n                           xpcproxy or\n                           login or\n                           cat or\n                           cp or\n                           launchctl or\n                           java)) and\n  not process.executable:(/Applications/* or /private/var/folders/* or /usr/local/*) and\n  file.path:(/private/etc/rc.local or\n             /etc/rc.local or\n             /home/*/.profile or\n             /home/*/.profile1 or\n             /home/*/.bash_profile or\n             /home/*/.bash_profile1 or\n             /home/*/.bashrc or\n             /Users/*/.bash_profile or\n             /Users/*/.zshenv)\n","actions":[]}
{"id":"9173cff0-43f8-11ed-b5fa-0d281afe1344","updated_at":"2023-06-08T21:03:44.317Z","updated_by":"elastic","created_at":"2022-10-04T15:23:58.998Z","created_by":"elastic","name":"ESET Malware detection on removable media","tags":["Octava Defence","Custom Rules"],"interval":"5m","enabled":true,"revision":5,"description":"ESET Malware detection on removable media","risk_score":47,"severity":"medium","note":"Виявлене шкідливе програмне забезпечення на знімному носії хоста {host.name}.\nEvents:\ntime_occured, time_ingested, hostname, username, user_displayname, user_division, user_department, user_title, user_mobile, signature, file_path\n{@timestamp}, {event.ingested}, {host.name}, {user.name}, {user_displayname}, {user_division}, {user_department}, {user_title}, {user_mobile}, {rule.name}, {file.path}","license":"","output_index":"","meta":{"from":"1m","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava Defence"],"false_positives":[],"from":"now-360s","rule_id":"0e38f58d-3f81-44dd-97c1-afde412ac444","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","reference":"https://attack.mitre.org/tactics/TA0002","name":"Execution"},"technique":[{"id":"T1203","reference":"https://attack.mitre.org/techniques/T1203","name":"Exploitation for Client Execution","subtechnique":[]}]}],"to":"now","references":[],"version":5,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"event.module:\"eset\" AND file.path:file* AND NOT file.path:file*C\\:* AND NOT file.path:file*https\\:*","filters":[],"threshold":{"field":["host.name"],"value":1,"cardinality":[]},"actions":[]}
{"id":"898ba1f0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.881Z","updated_by":"elastic","created_at":"2023-03-15T15:32:04.157Z","created_by":"elastic","name":"Modification of Standard Authentication Module or Configuration [Duplicate]","tags":["Elastic","Host","macOS","Linux","Threat Detection","Credential Access","Persistence"],"interval":"5m","enabled":true,"revision":101,"description":"Adversaries may modify the standard authentication module for persistence via patching the normal authorization process or modifying the login configuration to allow unauthorized access or elevate privileges.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Trusted system module updates or allowed Pluggable Authentication Module (PAM) daemon configuration changes."],"from":"now-9m","rule_id":"668a2e45-2e8e-44c1-8d92-c3e8486ef03b","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1543/","name":"Create or Modify System Process","id":"T1543"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1556/","name":"Modify Authentication Process","id":"T1556"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0006/","name":"Credential Access","id":"TA0006"}}],"to":"now","references":["https://github.com/zephrax/linux-pam-backdoor","https://github.com/eurialo/pambd","http://0x90909090.blogspot.com/2016/06/creating-backdoor-in-pam-in-5-line-of.html","https://www.trendmicro.com/en_us/research/19/i/skidmap-linux-malware-uses-rootkit-capabilities-to-hide-cryptocurrency-mining-payload.html"],"version":101,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*"],"query":"event.category:file and event.type:change and\n  (file.name:pam_*.so or file.path:(/etc/pam.d/* or /private/etc/pam.d/*)) and\n  process.executable:\n    (* and\n      not\n      (\n        /bin/yum or\n        \"/usr/sbin/pam-auth-update\" or\n        /usr/libexec/packagekitd or\n        /usr/bin/dpkg or\n        /usr/bin/vim or\n        /usr/libexec/xpcproxy or\n        /usr/bin/bsdtar or\n        /usr/local/bin/brew or\n        /usr/bin/rsync or\n        /usr/bin/yum or\n        /var/lib/docker/*/bin/yum or\n        /var/lib/docker/*/bin/dpkg or\n        ./merged/var/lib/docker/*/bin/dpkg or\n        \"/System/Library/PrivateFrameworks/PackageKit.framework/Versions/A/XPCServices/package_script_service.xpc/Contents/MacOS/package_script_service\"\n      )\n    ) and\n  not file.path:\n         (\n           /tmp/snap.rootfs_*/pam_*.so or\n           /tmp/newroot/lib/*/pam_*.so or\n           /private/var/folders/*/T/com.apple.fileprovider.ArchiveService/TemporaryItems/*/lib/security/pam_*.so or\n           /tmp/newroot/usr/lib64/security/pam_*.so\n         )\n","actions":[]}
{"id":"8880c1a0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.885Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.516Z","created_by":"elastic","name":"Potential Shell via Web Server [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Persistence","Investigation Guide","Elastic Endgame"],"interval":"5m","enabled":true,"revision":104,"description":"Identifies suspicious commands executed via a web server, which may suggest a vulnerability and remote shell access.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n\n### Investigating Potential Shell via Web Server\n\nAdversaries may backdoor web servers with web shells to establish persistent access to systems. A web shell is a web script that is placed on an openly accessible web server to allow an adversary to use the web server as a gateway into a network. A web shell may provide a set of functions to execute or a command line interface on the system that hosts the web server.\n\nThis rule detects a web server process spawning script and command line interface programs, potentially indicating attackers executing commands using the web shell.\n\n#### Possible investigation steps\n\n- Investigate abnormal behaviors observed by the subject process such as network connections, file modifications, and\nany other spawned child processes.\n- Examine the command line to determine which commands or scripts were executed.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- If scripts or executables were dropped, retrieve the files and determine if they are malicious:\n  - Use a private sandboxed malware analysis system to perform analysis.\n    - Observe and collect information about the following activities:\n      - Attempts to contact external domains and addresses.\n        - Check if the domain is newly registered or unexpected.\n        - Check the reputation of the domain or IP address.\n      - File access, modification, and creation activities.\n      - Cron jobs, services and other persistence mechanisms.\n\n### False positive analysis\n\n- This activity is unlikely to happen legitimately. Any activity that triggered the alert and is not inherently malicious must be monitored by the security team.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- If the triage identified malware, search the environment for additional compromised hosts.\n  - Implement temporary network rules, procedures, and segmentation to contain the malware.\n  - Stop suspicious processes.\n  - Immediately block the identified indicators of compromise (IoCs).\n  - Inspect the affected systems for additional malware backdoors like reverse shells, reverse proxies, or droppers that attackers could use to reinfect the system.\n- Remove and block malicious artifacts identified during triage.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Network monitoring or management products may have a web server component that runs shell commands as part of normal behavior."],"from":"now-9m","rule_id":"4cf80b21-25aa-41fb-971e-a21e6520ffbb","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1505/","name":"Server Software Component","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1505/003/","name":"Web Shell","id":"T1505.003"}],"id":"T1505"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}}],"to":"now","references":["https://pentestlab.blog/tag/web-shell/","https://www.elastic.co/security-labs/elastic-response-to-the-the-spring4shell-vulnerability-cve-2022-22965"],"version":104,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"event.category:process and event.type:(start or process_started) and\nprocess.name:(bash or dash or ash or zsh or \"python*\" or \"perl*\" or \"php*\") and\nprocess.parent.name:(\"apache\" or \"nginx\" or \"www\" or \"apache2\" or \"httpd\" or \"www-data\")\n","actions":[]}
{"id":"8eafd7e0-5083-11ed-b5fa-0d281afe1344","updated_at":"2023-06-08T21:03:44.310Z","updated_by":"elastic","created_at":"2022-10-20T14:29:08.322Z","created_by":"elastic","name":"MSSQL multiple failed authentication attempts of one service user account","tags":["Octava Defence","prod","Custom Rules"],"interval":"5m","enabled":true,"revision":7,"description":"MSSQL multiple failed authentication attempts of one service user account","risk_score":47,"severity":"medium","license":"","output_index":"","meta":{"from":"2h","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":[],"false_positives":[],"from":"now-7500s","rule_id":"8e11ef16-5784-4ab5-abd7-990a42df6e1f","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[],"to":"now","references":[],"version":7,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"agent.name:\"DWH-SQLC\" AND event.code:\"18456\" AND NOT winlog.event_data.param1:AKU0*","filters":[],"threshold":{"field":["winlog.event_data.param1"],"value":1,"cardinality":[]},"actions":[]}
{"id":"887b1c50-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:39.865Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.380Z","created_by":"elastic","name":"Namespace Manipulation Using Unshare [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Privilege Escalation","Elastic Endgame"],"interval":"5m","enabled":true,"revision":3,"description":"Identifies suspicious usage of unshare to manipulate system namespaces. Unshare can be utilized to escalate privileges or escape container security boundaries. Threat actors have utilized this binary to allow themselves to escape to the host and access other resources or escalate privileges.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":"","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"28d21cd6-8dba-44e8-b413-1279f98fc57a","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1543/","name":"Create or Modify System Process","id":"T1543"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0004/","name":"Privilege Escalation","id":"TA0004"}}],"to":"now","references":["https://man7.org/linux/man-pages/man1/unshare.1.html","https://www.crowdstrike.com/blog/cve-2022-0185-kubernetes-container-escape-using-linux-kernel-exploit/"],"version":3,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"process where event.type == \"start\" and event.action : (\"exec\", \"exec_event\") and\nprocess.executable: \"/usr/bin/unshare\" and\nnot process.parent.executable: (\"/usr/bin/udevadm\", \"*/lib/systemd/systemd-udevd\", \"/usr/bin/unshare\") and\nnot process.args : \"/usr/bin/snap\"\n","actions":[]}
{"id":"88780f10-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T15:34:55.601Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.394Z","created_by":"elastic","name":"File Permission Modification in Writable Directory [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Defense Evasion"],"interval":"5m","enabled":true,"revision":101,"description":"Identifies file permission modifications in common writable directories by a non-root user. Adversaries often drop files or payloads into a writable directory and change permissions prior to execution.","risk_score":21,"severity":"low","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Certain programs or applications may modify files or change ownership in writable directories. These can be exempted by username."],"from":"now-9m","rule_id":"54869f28-113a-4b91-8fa8-3df8f4697464","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1222/","name":"File and Directory Permissions Modification","id":"T1222"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0005/","name":"Defense Evasion","id":"TA0005"}}],"to":"now","references":[],"version":101,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*"],"query":"event.category:process and event.type:(start or process_started) and\n  process.name:(chmod or chown or chattr or chgrp) and\n  process.working_directory:(/tmp or /var/tmp or /dev/shm) and\n  not user.name:root\n","actions":[]}
{"id":"591389f0-4418-11ed-b5fa-0d281afe1344","updated_at":"2023-06-08T21:03:44.316Z","updated_by":"elastic","created_at":"2022-10-04T19:11:28.977Z","created_by":"elastic","name":"Fortigate IPS Internal Server Detection to External Direction","tags":["Octava Defence","prod","Custom Rules"],"interval":"5m","enabled":true,"revision":5,"description":"Fortigate IPS Internal Server Detection to External Direction","risk_score":47,"severity":"medium","license":"","output_index":"","meta":{"from":"1m","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava Defence"],"false_positives":[],"from":"now-360s","rule_id":"aaf76de5-7a53-4e52-a2a2-948965c5deb0","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","reference":"https://attack.mitre.org/tactics/TA0002","name":"Execution"},"technique":[{"id":"T1203","reference":"https://attack.mitre.org/techniques/T1203","name":"Exploitation for Client Execution","subtechnique":[]}]}],"to":"now","references":[],"version":5,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"fortinet.firewall.subtype:\"ips\" AND NOT source.as.number:* AND destination.as.number:* AND NOT fortinet.firewall.severity:\"low\" AND (source.ip:[172.16.0.0 TO 172.16.0.255] OR source.ip:[172.16.5.0 TO 172.16.5.255] OR source.ip:[192.168.220.0 TO 192.168.220.255]) AND NOT (source.ip: \"172.16.5.100\" AND fortinet.firewall.attack: \"TCP.Split.Handshake\")","filters":[],"threshold":{"field":["fortinet.firewall.attack"],"value":1,"cardinality":[]},"actions":[]}
{"id":"b25e3ce0-447b-11ed-b5fa-0d281afe1344","updated_at":"2023-06-08T21:03:44.306Z","updated_by":"elastic","created_at":"2022-10-05T07:02:38.868Z","created_by":"elastic","name":"ESET Malware detection on email","tags":["Octava Defence","prod","Custom Rules"],"interval":"5m","enabled":true,"revision":4,"description":"ESET Malware detection on email","risk_score":47,"severity":"medium","license":"","output_index":"","meta":{"from":"3m","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava Defence"],"false_positives":[],"from":"now-480s","rule_id":"514a5eef-f193-40e5-aaeb-c1659db93193","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"id":"TA0002","reference":"https://attack.mitre.org/tactics/TA0002","name":"Execution"},"technique":[{"id":"T1203","reference":"https://attack.mitre.org/techniques/T1203","name":"Exploitation for Client Execution","subtechnique":[]}]}],"to":"now","references":[],"version":4,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"event.module:\"eset\" AND rule.ruleset:(\"Email IMAP filter\" OR \"Email application filter\")","filters":[],"threshold":{"field":["rule.name"],"value":1,"cardinality":[]},"actions":[]}
{"id":"8ec123e1-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.153Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.885Z","created_by":"elastic","name":"Startup/Logon Script added to Group Policy Object [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Privilege Escalation","Active Directory","Investigation Guide"],"interval":"5m","enabled":true,"revision":104,"description":"Detects the modification of Group Policy Objects (GPO) to add a startup/logon script to users or computer objects.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n\n### Investigating Scheduled Task Execution at Scale via GPO\n\nGroup Policy Objects (GPOs) can be used by attackers to instruct arbitrarily large groups of clients to execute specified commands at startup, logon, shutdown, and logoff. This is done by creating or modifying the `scripts.ini` or `psscripts.ini` files. The scripts are stored in the following paths:\n  - `<GPOPath>\\Machine\\Scripts\\`\n  - `<GPOPath>\\User\\Scripts\\`\n\n#### Possible investigation steps\n\n- This attack abuses a legitimate mechanism of Active Directory, so it is important to determine whether the activity is legitimate and the administrator is authorized to perform this operation.\n- Retrieve the contents of the `ScheduledTasks.xml` file, and check the `<Command>` and `<Arguments>` XML tags for any potentially malicious commands or binaries.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Scope which objects may be compromised by retrieving information about which objects are controlled by the GPO.\n\n### False positive analysis\n\n- Verify if the execution is legitimately authorized and executed under a change management process.\n\n### Related rules\n\n- Group Policy Abuse for Privilege Addition - b9554892-5e0e-424b-83a0-5aef95aa43bf\n- Scheduled Task Execution at Scale via GPO - 15a8ba77-1c13-4274-88fe-6bd14133861e\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- The investigation and containment must be performed in every computer controlled by the GPO, where necessary.\n- Remove the script from the GPO.\n- Check if other GPOs have suspicious scripts attached.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Legitimate Administrative Activity"],"from":"now-6m","rule_id":"4f58ad35-afe6-4f37-b170-7d219aac7f58","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1484/","name":"Domain Policy Modification","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1484/001/","name":"Group Policy Modification","id":"T1484.001"}],"id":"T1484"},{"reference":"https://attack.mitre.org/techniques/T1547/","name":"Boot or Logon Autostart Execution","id":"T1547"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0004/","name":"Privilege Escalation","id":"TA0004"}}],"to":"now","references":["https://github.com/atc-project/atc-data/blob/master/docs/Logging_Policies/LP_0025_windows_audit_directory_service_changes.md","https://github.com/atc-project/atc-data/blob/f2bbb51ecf68e2c9f488e3c70dcdd3df51d2a46b/docs/Logging_Policies/LP_0029_windows_audit_detailed_file_share.md","https://labs.f-secure.com/tools/sharpgpoabuse"],"version":104,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["winlogbeat-*","logs-system.*","logs-windows.*"],"query":"(\n event.code:5136 and winlog.event_data.AttributeLDAPDisplayName:(gPCMachineExtensionNames or gPCUserExtensionNames) and\n   winlog.event_data.AttributeValue:(*42B5FAAE-6536-11D2-AE5A-0000F87571E3* and\n                                      (*40B66650-4972-11D1-A7CA-0000F87571E3* or *40B6664F-4972-11D1-A7CA-0000F87571E3*))\n)\nor\n(\n event.code:5145 and winlog.event_data.ShareName:\\\\\\\\*\\\\SYSVOL and\n   winlog.event_data.RelativeTargetName:(*\\\\scripts.ini or *\\\\psscripts.ini) and\n   (message:WriteData or winlog.event_data.AccessList:*%%4417*)\n)\n","actions":[]}
{"id":"887b4360-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T15:34:55.600Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.376Z","created_by":"elastic","name":"Suspicious File Creation in /etc for Persistence [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Persistence","Orbit","Lightning Framework","Elastic Endgame"],"interval":"5m","enabled":true,"revision":103,"description":"Detects the manual creation of files in specific etc directories, via user root, used by Linux malware to persist and elevate privileges on compromised systems. File creation in these directories should not be entirely common and could indicate a malicious binary or script installing persistence for long term access.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"3173ea95-2cd2-4ac7-8165-6899fa088af4","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1037/","name":"Boot or Logon Initialization Scripts","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1037/004/","name":"RC Scripts","id":"T1037.004"}],"id":"T1037"},{"reference":"https://attack.mitre.org/techniques/T1574/","name":"Hijack Execution Flow","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1574/006/","name":"Dynamic Linker Hijacking","id":"T1574.006"}],"id":"T1574"},{"reference":"https://attack.mitre.org/techniques/T1543/","name":"Create or Modify System Process","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1543/002/","name":"Systemd Service","id":"T1543.002"}],"id":"T1543"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1053/","name":"Scheduled Task/Job","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1053/003/","name":"Cron","id":"T1053.003"}],"id":"T1053"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002/","name":"Execution","id":"TA0002"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1548/","name":"Abuse Elevation Control Mechanism","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1548/003/","name":"Sudo and Sudo Caching","id":"T1548.003"}],"id":"T1548"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0004/","name":"Privilege Escalation","id":"TA0004"}}],"to":"now","references":["https://www.intezer.com/blog/incident-response/orbit-new-undetected-linux-threat/","https://www.intezer.com/blog/research/lightning-framework-new-linux-threat/"],"version":103,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["logs-endpoint.events.*","endgame-*"],"query":"file where event.type == \"creation\" and user.name == \"root\" and\nfile.path : (\"/etc/ld.so.conf.d/*\", \"/etc/cron.d/*\", \"/etc/sudoers.d/*\", \"/etc/rc.d/init.d/*\", \"/etc/systemd/system/*\")\nand not process.executable : (\"*/dpkg\", \"*/yum\", \"*/apt\", \"*/dnf\", \"*/systemd\", \"*/snapd\", \"*/dnf-automatic\",\n \"*/yum-cron\", \"*/elastic-agent\", \"*/dnfdaemon-system\")\n","actions":[]}
{"id":"415eaee0-d962-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.146Z","updated_by":"elastic","created_at":"2023-04-12T18:45:54.515Z","created_by":"elastic","name":"Scheduled Task Execution at Scale via GPO [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Privilege Escalation","Active Directory","Investigation Guide"],"interval":"5m","enabled":true,"revision":104,"description":"Detects the modification of Group Policy Object attributes to execute a scheduled task in the objects controlled by the GPO.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n\n### Investigating Scheduled Task Execution at Scale via GPO\n\nGroup Policy Objects (GPOs) can be used by attackers to execute scheduled tasks at scale to compromise objects controlled by a given GPO. This is done by changing the contents of the `<GPOPath>\\Machine\\Preferences\\ScheduledTasks\\ScheduledTasks.xml` file.\n\n#### Possible investigation steps\n\n- This attack abuses a legitimate mechanism of Active Directory, so it is important to determine whether the activity is legitimate and the administrator is authorized to perform this operation.\n- Retrieve the contents of the `ScheduledTasks.xml` file, and check the `<Command>` and `<Arguments>` XML tags for any potentially malicious commands or binaries.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Scope which objects may be compromised by retrieving information about which objects are controlled by the GPO.\n\n### False positive analysis\n\n- Verify if the execution is allowed and done under change management, and if the execution is legitimate.\n\n### Related rules\n\n- Group Policy Abuse for Privilege Addition - b9554892-5e0e-424b-83a0-5aef95aa43bf\n- Startup/Logon Script added to Group Policy Object - 16fac1a1-21ee-4ca6-b720-458e3855d046\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- The investigation and containment must be performed in every computer controlled by the GPO, where necessary.\n- Remove the script from the GPO.\n- Check if other GPOs have suspicious scheduled tasks attached.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-6m","rule_id":"d8787938-0e5e-4e52-b108-5ab9c6ac37b7","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1053/","name":"Scheduled Task/Job","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1053/005/","name":"Scheduled Task","id":"T1053.005"}],"id":"T1053"},{"reference":"https://attack.mitre.org/techniques/T1484/","name":"Domain Policy Modification","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1484/001/","name":"Group Policy Modification","id":"T1484.001"}],"id":"T1484"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0004/","name":"Privilege Escalation","id":"TA0004"}}],"to":"now","references":["https://github.com/atc-project/atc-data/blob/master/docs/Logging_Policies/LP_0025_windows_audit_directory_service_changes.md","https://github.com/atc-project/atc-data/blob/f2bbb51ecf68e2c9f488e3c70dcdd3df51d2a46b/docs/Logging_Policies/LP_0029_windows_audit_detailed_file_share.md","https://labs.f-secure.com/tools/sharpgpoabuse","https://twitter.com/menasec1/status/1106899890377052160","https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/security/win_gpo_scheduledtasks.yml"],"version":104,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["winlogbeat-*","logs-system.*","logs-windows.*"],"query":"(event.code: \"5136\" and winlog.event_data.AttributeLDAPDisplayName:(\"gPCMachineExtensionNames\" or \"gPCUserExtensionNames\") and\n   winlog.event_data.AttributeValue:(*CAB54552-DEEA-4691-817E-ED4A4D1AFC72* and *AADCED64-746C-4633-A97C-D61349046527*))\nor\n(event.code: \"5145\" and winlog.event_data.ShareName: \"\\\\\\\\*\\\\SYSVOL\" and winlog.event_data.RelativeTargetName: *ScheduledTasks.xml and\n  (message: WriteData or winlog.event_data.AccessList: *%%4417*))\n","actions":[]}
{"id":"887724b0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:39.868Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.419Z","created_by":"elastic","name":"Creation of Hidden Files and Directories via CommandLine [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Defense Evasion"],"interval":"5m","enabled":true,"revision":101,"description":"Users can mark specific files as hidden simply by putting a \".\" as the first character in the file or folder name. Adversaries can use this to their advantage to hide files and folders on the system for persistence and defense evasion. This rule looks for hidden files or folders in common writable directories.","risk_score":47,"severity":"medium","note":"","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Certain tools may create hidden temporary files or directories upon installation or as part of their normal behavior. These events can be filtered by the process arguments, username, or process name values."],"from":"now-9m","rule_id":"e6b1e390-f821-4299-9ebd-882499ff9a81","max_signals":33,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1564/","name":"Hide Artifacts","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1564/001/","name":"Hidden Files and Directories","id":"T1564.001"}],"id":"T1564"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0005/","name":"Defense Evasion","id":"TA0005"}},{"framework":"MITRE ATT&CK","technique":[],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}}],"to":"now","references":[],"version":101,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-endpoint.events.*"],"query":"process where event.type in (\"start\", \"process_started\") and\n  process.working_directory in (\"/tmp\", \"/var/tmp\", \"/dev/shm\") and\n  process.args regex~ \"\"\"\\.[a-z0-9_\\-][a-z0-9_\\-\\.]{1,254}\"\"\" and\n  not process.name in (\"ls\", \"find\", \"grep\")\n","actions":[]}
{"id":"88802560-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:42.903Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.494Z","created_by":"elastic","name":"Abnormal Process ID or Lock File Created [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Execution","BPFDoor","Investigation Guide","Elastic Endgame"],"interval":"5m","enabled":true,"revision":104,"description":"Identifies the creation of a Process ID (PID), lock or reboot file created in temporary file storage paradigm (tmpfs) directory /var/run. On Linux, the PID files typically hold the process ID to track previous copies running and manage other tasks. Certain Linux malware use the /var/run directory for holding data, executables and other tasks, disguising itself or these files as legitimate PID files.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n\n### Investigating Abnormal Process ID or Lock File Created\n\nLinux applications may need to save their process identification number (PID) for various purposes: from signaling that a program is running to serving as a signal that a previous instance of an application didn't exit successfully. PID files contain its creator process PID in an integer value.\n\nLinux lock files are used to coordinate operations in files so that conflicts and race conditions are prevented.\n\nThis rule identifies the creation of PID, lock, or reboot files in the /var/run/ directory. Attackers can masquerade malware, payloads, staged data for exfiltration, and more as legitimate PID files.\n\n#### Possible investigation steps\n\n- Retrieve the file and determine if it is malicious:\n    - Check the contents of the PID files. They should only contain integer strings.\n    - Check the file type of the lock and PID files to determine if they are executables. This is only observed in     malicious files.\n    - Check the size of the subject file. Legitimate PID files should be under 10 bytes.\n    - Check if the lock or PID file has high entropy. This typically indicates an encrypted payload.\n        - Analysts can use tools like `ent` to measure entropy.\n    - Examine the reputation of the SHA-256 hash in the PID file. Use a database like VirusTotal to identify additional pivots and artifacts for investigation.\n- Trace the file's creation to ensure it came from a legitimate or authorized process.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Investigate any abnormal account behavior, such as command executions, file creations or modifications, and network connections.\n- Investigate any abnormal behavior by the subject process such as network connections, file modifications, and any spawned child processes.\n\n### False positive analysis\n\n- False positives can appear if the PID file is legitimate and holding a process ID as intended. If the PID file is an executable or has a file size that's larger than 10 bytes, it should be ruled suspicious.\n- If this activity is expected and noisy in your environment, consider adding exceptions — preferably with a combination of file name and process executable conditions.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved host to prevent further post-compromise behavior.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Block the identified indicators of compromise (IoCs).\n- Take actions to terminate processes and connections used by the attacker.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).\n","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["False-Positives (FP) can appear if the PID file is legitimate and holding a process ID as intended. To differentiate, if the PID file is an executable or larger than 10 bytes, it should be ruled suspicious."],"from":"now-9m","rule_id":"c28177f4-ac4a-4b36-813f-50077d6389e2","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1106/","name":"Native API","id":"T1106"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002/","name":"Execution","id":"TA0002"}}],"to":"now","references":["https://www.sandflysecurity.com/blog/linux-file-masquerading-and-malicious-pids-sandfly-1-2-6-update/","https://twitter.com/GossiTheDog/status/1522964028284411907","https://exatrack.com/public/Tricephalic_Hellkeeper.pdf","https://www.elastic.co/security-labs/a-peek-behind-the-bpfdoor"],"version":104,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["logs-endpoint.events.*","endgame-*"],"query":"/* add file size filters when data is available */\nfile where event.type == \"creation\" and user.id == \"0\" and\n    file.path regex~ \"\"\"/var/run/\\w+\\.(pid|lock|reboot)\"\"\" and file.extension in (\"pid\",\"lock\",\"reboot\") and\n\n    /* handle common legitimate files */\n\n    not file.name in (\n    \"auditd.pid\",\n    \"python*\",\n    \"apport.pid\",\n    \"apport.lock\",\n    \"kworker*\",\n    \"gdm3.pid\",\n    \"sshd.pid\",\n    \"acpid.pid\",\n    \"unattended-upgrades.lock\",\n    \"unattended-upgrades.pid\",\n    \"cmd.pid\",\n    \"cron*.pid\",\n    \"yum.pid\",\n    \"netconfig.pid\",\n    \"docker.pid\",\n    \"atd.pid\",\n    \"lfd.pid\",\n    \"atop.pid\",\n    \"nginx.pid\",\n    \"dhclient.pid\",\n    \"smtpd.pid\",\n    \"stunnel.pid\",\n    \"1_waagent.pid\"\n    )\n","actions":[]}
{"id":"887c54d0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:42.909Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.444Z","created_by":"elastic","name":"File made Immutable by Chattr [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Defense Evasion","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Detects a file being made immutable using the chattr binary. Making a file immutable means it cannot be deleted or renamed, no link can be created to this file, most of the file's metadata can not be modified, and the file can not be opened in write mode. Threat actors will commonly utilize this to prevent tampering or modification of their malicious files or any system files they have modified for purposes of persistence (e.g .ssh, /etc/passwd, etc.).","risk_score":47,"severity":"medium","note":"","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"8bf72122-a709-4f6b-ad58-5b82bc88fb22","max_signals":33,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1222/","name":"File and Directory Permissions Modification","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1222/002/","name":"Linux and Mac File and Directory Permissions Modification","id":"T1222.002"}],"id":"T1222"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0005/","name":"Defense Evasion","id":"TA0005"}}],"to":"now","references":[],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"process where event.type == \"start\" and user.name == \"root\" and process.executable : \"/usr/bin/chattr\" and process.args : (\"-*i*\", \"+*i*\") and not process.parent.executable: \"/lib/systemd/systemd\"\n","actions":[]}
{"id":"898b53d0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T15:34:55.597Z","updated_by":"elastic","created_at":"2023-03-15T15:32:04.152Z","created_by":"elastic","name":"Suspicious JAVA Child Process [Duplicate]","tags":["Elastic","Host","Linux","macOS","Threat Detection","Execution","Investigation Guide"],"interval":"5m","enabled":true,"revision":103,"description":"Identifies suspicious child processes of the Java interpreter process. This may indicate an attempt to execute a malicious JAR file or an exploitation attempt via a JAVA specific vulnerability.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n\n### Investigating Suspicious Java Child Process\n\nThis rule identifies a suspicious child process of the Java interpreter process. It may indicate an attempt to execute a malicious JAR file or an exploitation attempt via a Java specific vulnerability.\n\n#### Possible investigation steps\n\n- Investigate the process execution chain (parent process tree) for unknown processes. Examine their executable files for prevalence and whether they are located in expected locations.\n- Investigate other alerts associated with the user/host during the past 48 hours.\n- Investigate any abnormal account behavior, such as command executions, file creations or modifications, and network connections.\n- Investigate any abnormal behavior by the subject process such as network connections, file modifications, and any spawned child processes.\n- Examine the command line to determine if the command executed is potentially harmful or malicious.\n- Inspect the host for suspicious or abnormal behavior in the alert timeframe.\n\n### False positive analysis\n\n- If this activity is expected and noisy in your environment, consider adding exceptions — preferably with a combination of process and command line conditions.\n\n### Response and remediation\n\n- Initiate the incident response process based on the outcome of the triage.\n- Isolate the involved hosts to prevent further post-compromise behavior.\n- Remove and block malicious artifacts identified during triage.\n- Investigate credential exposure on systems compromised or used by the attacker to ensure all compromised accounts are identified. Reset passwords for these accounts and other potentially compromised credentials, such as email, business systems, and web services.\n- Run a full antimalware scan. This may reveal additional artifacts left in the system, persistence mechanisms, and malware components.\n- Determine the initial vector abused by the attacker and take action to prevent reinfection through the same vector.\n- Using the incident response data, update logging and audit policies to improve the mean time to detect (MTTD) and the mean time to respond (MTTR).","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"3608b504-010c-4a7d-bd3c-495d14ebfa80","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1059/","name":"Command and Scripting Interpreter","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1059/007/","name":"JavaScript","id":"T1059.007"}],"id":"T1059"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002/","name":"Execution","id":"TA0002"}}],"to":"now","references":["https://www.lunasec.io/docs/blog/log4j-zero-day/","https://github.com/christophetd/log4shell-vulnerable-app","https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE.pdf","https://www.elastic.co/security-labs/detecting-log4j2-with-elastic-security","https://www.elastic.co/security-labs/analysis-of-log4shell-cve-2021-45046"],"version":103,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-endpoint.events.*"],"query":"process where event.type in (\"start\", \"process_started\") and\n  process.parent.name : \"java\" and\n  process.name : (\"sh\", \"bash\", \"dash\", \"ksh\", \"tcsh\", \"zsh\", \"curl\", \"wget\")\n","actions":[]}
{"id":"898adea0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:39.871Z","updated_by":"elastic","created_at":"2023-03-15T15:32:04.149Z","created_by":"elastic","name":"EggShell Backdoor Execution [Duplicate]","tags":["Elastic","Host","Linux","macOS","Threat Detection","Execution"],"interval":"5m","enabled":true,"revision":101,"description":"Identifies the execution of and EggShell Backdoor. EggShell is a known post exploitation tool for macOS and Linux.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"46addafc-ced1-407a-81a0-f3018ded5e78","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1059/","name":"Command and Scripting Interpreter","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1059/006/","name":"Python","id":"T1059.006"}],"id":"T1059"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0002/","name":"Execution","id":"TA0002"}}],"to":"now","references":["https://github.com/neoneggplant/EggShell"],"version":101,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*"],"query":"event.category:process and event.type:(start or process_started) and process.name:espl and process.args:eyJkZWJ1ZyI6*\n","actions":[]}
{"id":"898b2cc0-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.890Z","updated_by":"elastic","created_at":"2023-03-15T15:32:04.155Z","created_by":"elastic","name":"Modification of OpenSSH Binaries [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Credential Access","Persistence","Lateral Movement","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Adversaries may modify SSH related binaries for persistence or credential access by patching sensitive functions to enable unauthorized access or by logging SSH credentials for exfiltration.","risk_score":47,"severity":"medium","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Trusted OpenSSH executable updates. It's recommended to verify the integrity of OpenSSH binary changes."],"from":"now-9m","rule_id":"73dc4479-4bdf-4996-91b2-ce4e9525f0ac","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1543/","name":"Create or Modify System Process","id":"T1543"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0003/","name":"Persistence","id":"TA0003"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1556/","name":"Modify Authentication Process","id":"T1556"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0006/","name":"Credential Access","id":"TA0006"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1563/","name":"Remote Service Session Hijacking","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1563/001/","name":"SSH Hijacking","id":"T1563.001"}],"id":"T1563"},{"reference":"https://attack.mitre.org/techniques/T1021/","name":"Remote Services","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1021/004/","name":"SSH","id":"T1021.004"}],"id":"T1021"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0008/","name":"Lateral Movement","id":"TA0008"}}],"to":"now","references":["https://blog.angelalonso.es/2016/09/anatomy-of-real-linux-intrusion-part-ii.html"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"event.category:file and event.type:change and\n process.name:* and\n (file.path:(/usr/sbin/sshd or /usr/bin/ssh or /usr/bin/sftp or /usr/bin/scp) or file.name:libkeyutils.so) and\n not process.name:(\"dpkg\" or \"yum\" or \"dnf\" or \"dnf-automatic\")\n","actions":[]}
{"id":"886a5370-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:39.865Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.285Z","created_by":"elastic","name":"Creation of Hidden Shared Object File [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Defense Evasion","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Identifies the creation of a hidden shared object (.so) file. Users can mark specific files as hidden simply by putting a \".\" as the first character in the file or folder name. Adversaries can use this to their advantage to hide files and folders on the system for persistence and defense evasion.","risk_score":47,"severity":"medium","note":"","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"87452669-3350-4d69-8369-a113ecc4b7b4","max_signals":33,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1564/","name":"Hide Artifacts","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1564/001/","name":"Hidden Files and Directories","id":"T1564.001"}],"id":"T1564"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0005/","name":"Defense Evasion","id":"TA0005"}}],"to":"now","references":[],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"file where event.type : \"creation\" and file.extension == \"so\" and file.name : \".*.so\"\n","actions":[]}
{"id":"886bb300-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-05-18T22:48:35.089Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.265Z","created_by":"elastic","name":"Suspicious Network Connection Attempt by Root [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Command and Control"],"interval":"5m","enabled":true,"revision":102,"description":"Identifies an outbound network connection attempt followed by a session id change as the root user by the same process entity. This particular instantiation of a network connection is abnormal and should be investigated as it may indicate a potential reverse shell activity via a privileged process.","risk_score":47,"severity":"medium","note":"## Triage and analysis\n### Investigating Connection Attempt by Non-SSH Root Session\nDetection alerts from this rule indicate a strange or abnormal outbound connection attempt by a privileged process.  Here are some possible avenues of investigation:\n- Examine unusual and active sessions using commands such as 'last -a', 'netstat -a', and 'w -a'.\n- Analyze processes and command line arguments to detect anomalous process execution that may be acting as a listener.\n- Analyze anomalies in the use of files that do not normally initiate connections.\n- Examine processes utilizing the network that do not normally have network communication.\n","license":"Elastic License v2","output_index":".siem-signals-default","author":["Elastic"],"false_positives":["False-Positives (FP) can appear if another remote terminal service is being used to connect to it's listener but typically SSH is used in these scenarios."],"from":"now-9m","rule_id":"9b6009d6-9275-4f97-8019-facae45d8c38","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"reference":"https://attack.mitre.org/tactics/TA0011/","name":"Command and Control","id":"TA0011"},"technique":[{"reference":"https://attack.mitre.org/techniques/T1095/","name":"Non-Application Layer Protocol","id":"T1095"}]},{"framework":"MITRE ATT&CK","tactic":{"reference":"https://attack.mitre.org/tactics/TA0004/","name":"Privilege Escalation","id":"TA0004"},"technique":[{"reference":"https://attack.mitre.org/techniques/T1548/","name":"Abuse Elevation Control Mechanism","id":"T1548","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1548/003/","name":"Sudo and Sudo Caching","id":"T1548.003"}]}]}],"to":"now","references":["https://www.sandflysecurity.com/blog/linux-file-masquerading-and-malicious-pids-sandfly-1-2-6-update/","https://twitter.com/GossiTheDog/status/1522964028284411907","https://exatrack.com/public/Tricephalic_Hellkeeper.pdf"],"version":102,"exceptions_list":[{"id":"1e0007e0-f5ce-11ed-b363-f33eee164a22","list_id":"56f6ebbb-62c3-4216-b6c3-80f2c8503593","type":"detection","namespace_type":"single"}],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["logs-endpoint.events.*"],"query":"sequence by process.entity_id with maxspan=1m\n[network where event.type == \"start\" and event.action == \"connection_attempted\" and user.id == \"0\" and\n    not process.executable : (\"/bin/ssh\", \"/sbin/ssh\", \"/usr/lib/systemd/systemd\", \"/usr/sbin/sshd\")]\n[process where event.action == \"session_id_change\" and user.id == \"0\" and\n    not process.executable : (\"/bin/ssh\", \"/sbin/ssh\", \"/usr/lib/systemd/systemd\", \"/usr/sbin/sshd\")]\n","actions":[]}
{"id":"88809a90-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.884Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.499Z","created_by":"elastic","name":"File Deletion via Shred [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Defense Evasion","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Malware or other files dropped or created on a system by an adversary may leave traces behind as to what was done within a network and how. Adversaries may remove these files over the course of an intrusion to keep their footprint low or remove them at the end as part of the post-intrusion cleanup process.","risk_score":21,"severity":"low","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"06fa510a-7daf-4103-8eb0-529c59c8c82e","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1070/","name":"Indicator Removal","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1070/004/","name":"File Deletion","id":"T1070.004"}],"id":"T1070"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0005/","name":"Defense Evasion","id":"TA0005"}}],"to":"now","references":[],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"event.category:process and event.type:(start or process_started) and process.name:shred and\n  process.args:(\"-u\" or \"--remove\" or \"-z\" or \"--zero\")\n","actions":[]}
{"id":"887f3b00-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:40.887Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.471Z","created_by":"elastic","name":"Base16 or Base32 Encoding/Decoding Activity [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Defense Evasion","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Adversaries may encode/decode data in an attempt to evade detection by host- or network-based security controls.","risk_score":21,"severity":"low","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":["Automated tools such as Jenkins may encode or decode files as part of their normal behavior. These events can be filtered by the process executable or username values."],"from":"now-9m","rule_id":"fce936ab-bcc0-434e-8c14-5447bf4cc2cd","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1027/","name":"Obfuscated Files or Information","id":"T1027"},{"reference":"https://attack.mitre.org/techniques/T1140/","name":"Deobfuscate/Decode Files or Information","id":"T1140"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0005/","name":"Defense Evasion","id":"TA0005"}}],"to":"now","references":[],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"query","language":"kuery","index":["auditbeat-*","logs-endpoint.events.*","endgame-*"],"query":"event.category:process and event.type:(start or process_started) and\n  process.name:(base16 or base32 or base32plain or base32hex)\n","actions":[]}
{"id":"887a8010-c346-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-03-15T19:51:39.881Z","updated_by":"elastic","created_at":"2023-03-15T15:32:02.385Z","created_by":"elastic","name":"Potential Privilege Escalation via PKEXEC [Duplicate]","tags":["Elastic","Host","Linux","Threat Detection","Privilege Escalation","Elastic Endgame"],"interval":"5m","enabled":true,"revision":102,"description":"Identifies an attempt to exploit a local privilege escalation in polkit pkexec (CVE-2021-4034) via unsecure environment variable injection. Successful exploitation allows an unprivileged user to escalate to the root user.","risk_score":73,"severity":"high","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"6b707f52-a975-49e9-af05-6501e34c4a8f","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1068/","name":"Exploitation for Privilege Escalation","id":"T1068"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0004/","name":"Privilege Escalation","id":"TA0004"}},{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1574/","name":"Hijack Execution Flow","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1574/007/","name":"Path Interception by PATH Environment Variable","id":"T1574.007"}],"id":"T1574"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0005/","name":"Defense Evasion","id":"TA0005"}}],"to":"now","references":["https://seclists.org/oss-sec/2022/q1/80","https://haxx.in/files/blasty-vs-pkexec.c"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"eql","language":"eql","index":["logs-endpoint.events.*","endgame-*"],"query":"file where file.path : \"/*GCONV_PATH*\"\n","actions":[]}
{"id":"d4300ce0-455c-11ed-b5fa-0d281afe1344","updated_at":"2023-06-08T21:03:44.315Z","updated_by":"elastic","created_at":"2022-10-06T09:54:12.170Z","created_by":"elastic","name":"Fortigate Virus Internal Server Detection to External Direction","tags":["Octava Defence","Custom Rules"],"interval":"5m","enabled":true,"revision":3,"description":"Fortigate Virus Internal Server Detection to External Direction","risk_score":47,"severity":"medium","license":"","output_index":"","meta":{"from":"3m","kibana_siem_app_url":"https://172.16.160.2:5601/app/security"},"timestamp_override":"event.ingested","timestamp_override_fallback_disabled":false,"author":["Octava Defence"],"false_positives":[],"from":"now-480s","rule_id":"299c0344-81f5-43b2-8fe6-4574a7721ebd","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","tactic":{"reference":"https://attack.mitre.org/tactics/TA0002","name":"Execution","id":"TA0002"},"technique":[{"reference":"https://attack.mitre.org/techniques/T1203","name":"Exploitation for Client Execution","id":"T1203","subtechnique":[]}]}],"to":"now","references":[],"version":3,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"lucene","index":["apm-*-transaction*","auditbeat-*","endgame-*","filebeat-*","logs-*","packetbeat-*","traces-apm*","winlogbeat-*","-*elastic-cloud-logs-*"],"query":"fortinet.firewall.subtype:\"virus\" AND NOT source.as.number:* AND destination.as.number:* AND NOT fortinet.firewall.severity:\"low\"  AND (source.ip:[172.16.0.0 TO 172.16.0.255] OR source.ip:[172.16.5.0 TO 172.16.5.255] OR source.ip:[192.168.220.0 TO 192.168.220.255])","filters":[],"threshold":{"field":["fortinet.firewall.virus"],"value":1,"cardinality":[]},"actions":[]}
{"id":"8ebe8bd0-d965-11ed-9bbb-69b1ad2deb7a","updated_at":"2023-04-12T19:15:16.163Z","updated_by":"elastic","created_at":"2023-04-12T19:09:32.822Z","created_by":"elastic","name":"Potential LSASS Memory Dump via PssCaptureSnapShot [Duplicate]","tags":["Elastic","Host","Windows","Threat Detection","Credential Access","Sysmon Only"],"interval":"5m","enabled":true,"revision":102,"description":"Identifies suspicious access to an LSASS handle via PssCaptureSnapShot where two successive process accesses are performed by the same process and target two different instances of LSASS. This may indicate an attempt to evade detection and dump LSASS memory for credential access.","risk_score":73,"severity":"high","note":"","license":"Elastic License v2","output_index":".siem-signals-default","timestamp_override":"event.ingested","author":["Elastic"],"false_positives":[],"from":"now-9m","rule_id":"27c792e9-c185-4808-8ed9-c3bb232936bf","max_signals":100,"risk_score_mapping":[],"severity_mapping":[],"threat":[{"framework":"MITRE ATT&CK","technique":[{"reference":"https://attack.mitre.org/techniques/T1003/","name":"OS Credential Dumping","subtechnique":[{"reference":"https://attack.mitre.org/techniques/T1003/001/","name":"LSASS Memory","id":"T1003.001"}],"id":"T1003"}],"tactic":{"reference":"https://attack.mitre.org/tactics/TA0006/","name":"Credential Access","id":"TA0006"}}],"to":"now","references":["https://www.matteomalvica.com/blog/2019/12/02/win-defender-atp-cred-bypass/","https://twitter.com/sbousseaden/status/1280619931516747777?lang=en"],"version":102,"exceptions_list":[],"immutable":false,"related_integrations":[],"required_fields":[],"setup":"","type":"threshold","language":"kuery","index":["winlogbeat-*","logs-windows.*"],"query":"event.category:process and event.code:10 and\n winlog.event_data.TargetImage:(\"C:\\\\Windows\\\\system32\\\\lsass.exe\" or\n                                 \"c:\\\\Windows\\\\system32\\\\lsass.exe\" or\n                                 \"c:\\\\Windows\\\\System32\\\\lsass.exe\")\n","threshold":{"field":["process.entity_id"],"value":2,"cardinality":[{"field":"winlog.event_data.TargetProcessId","value":2}]},"actions":[]}
{"_version":"Wzg4MywyXQ==","created_at":"2023-06-01T21:21:17.120Z","created_by":"elastic","description":"The following analytic identifies one source endpoint failing to authenticate with multiple users using the NTLM protocol. This behavior could represent an adversary performing a Password Spraying attack against an Active Directory environment using NTLM to obtain initial access or elevate privileges.","id":"3ebbbb10-00c2-11ee-82b6-b1835b5ce684","immutable":false,"list_id":"0cd2bb26-20e5-4b41-a193-ce83f8ecb017","name":"Multiple Users Failing To Authenticate From Host Using NTLM [Duplicate]","namespace_type":"single","os_types":[],"tags":[],"tie_breaker_id":"633af6da-0a99-4273-a63c-0f61b45d657e","type":"detection","updated_at":"2023-06-01T21:21:17.127Z","updated_by":"elastic","version":1}
{"_version":"Wzg4NCwyXQ==","comments":[],"created_at":"2023-06-01T21:23:19.695Z","created_by":"elastic","description":"Multiple Users Failing To Authenticate From Host Using NTLM [Duplicate] - exception list item","entries":[{"field":"host.name","operator":"included","type":"match","value":"lt-dc2.aku.com"},{"field":"winlog.event_data.Workstation","operator":"included","type":"match","value":"LT-DC2"}],"id":"87cb09f0-00c2-11ee-82b6-b1835b5ce684","item_id":"95919d70-0870-4733-a986-e0af205942b6","list_id":"0cd2bb26-20e5-4b41-a193-ce83f8ecb017","name":"Multiple Users Failing To Authenticate From Host Using NTLM [Duplicate] - exception list item","namespace_type":"single","os_types":[],"tags":[],"tie_breaker_id":"f7d5385c-6fe6-4d37-86b5-87d55eec2003","type":"simple","updated_at":"2023-06-01T21:23:19.698Z","updated_by":"elastic"}
{"_version":"Wzg1MSwyXQ==","created_at":"2022-09-27T07:38:16.440Z","created_by":"elastic","description":"Fortigate IPS detection where source IP address from private networks and not from srv networks 172.16.0.0/24, 172.16.5.0/24, 192.168.220.0/24 and more 5 alerts with the same thread in the last 24 hours","id":"59858780-3e37-11ed-b5fa-0d281afe1344","immutable":false,"list_id":"3ccd3bda-228c-4156-9ced-560bcfeab7e7","name":"Fortigate Outbreak IPS Internal Detection to External Direction","namespace_type":"single","os_types":[],"tags":[],"tie_breaker_id":"ee8fd3a6-380b-4782-8a95-569065af6925","type":"detection","updated_at":"2022-09-27T07:38:16.448Z","updated_by":"elastic","version":1}
{"_version":"Wzg1MywyXQ==","created_at":"2023-04-13T12:51:34.929Z","created_by":"elastic","description":"This rule identifies when a User Account starts the Active Directory Replication Process. Attackers can use the DCSync technique to get credential information of individual accounts or the entire domain, thus compromising the entire domain.","id":"ec15d010-d9f9-11ed-9bbb-69b1ad2deb7a","immutable":false,"list_id":"445acd60-d009-4723-9bf6-b241c7b9ad5c","name":"Potential Credential Access via DCSync [Duplicate]","namespace_type":"single","os_types":[],"tags":[],"tie_breaker_id":"f2d4c787-9ef9-45de-a743-cb8821748424","type":"detection","updated_at":"2023-04-13T12:51:34.932Z","updated_by":"elastic","version":1}
{"_version":"Wzg1NCwyXQ==","comments":[],"created_at":"2023-04-13T12:51:56.157Z","created_by":"elastic","description":"Potential Credential Access via DCSync [Duplicate] - exception list item","entries":[{"field":"winlog.event_data.SubjectUserName","operator":"included","type":"match","value":"SP-Technical-user"}],"id":"f8bcf2d0-d9f9-11ed-9bbb-69b1ad2deb7a","item_id":"dcd6508d-fa97-4101-b0cc-200bb12e4b6c","list_id":"445acd60-d009-4723-9bf6-b241c7b9ad5c","name":"Potential Credential Access via DCSync [Duplicate] - exception list item","namespace_type":"single","os_types":[],"tags":[],"tie_breaker_id":"3c93b2a6-2fe4-4d06-902d-e8f49286acde","type":"simple","updated_at":"2023-04-13T12:51:56.161Z","updated_by":"elastic"}
{"_version":"WzE2NjYsMl0=","created_at":"2023-06-19T10:35:29.048Z","created_by":"elastic","description":"Fortigate IPS Internal Detection to Internal Direction","id":"02848180-0e8d-11ee-82b6-b1835b5ce684","immutable":false,"list_id":"1ae9c0fa-ca31-4ede-8b0f-a2e6461d5f4e","name":"Fortigate IPS Internal Detection to Internal Direction","namespace_type":"single","os_types":[],"tags":[],"tie_breaker_id":"c87cb41d-fdfd-428a-b26d-01493119068e","type":"detection","updated_at":"2023-06-19T10:35:29.050Z","updated_by":"elastic","version":1}
{"_version":"WzYxMDQsMl0=","created_at":"2023-06-29T11:19:38.394Z","created_by":"elastic","description":"Exception list containing exceptions for rule with id: 93095b40-4480-11ed-b5fa-0d281afe1344","id":"d5c81fa0-166e-11ee-ad8e-610914274334","immutable":false,"list_id":"d4d8d782-e4b1-48c2-9126-cabee5f2130a","name":"Exceptions for rule - Fortigate IPS Internal Detection to Internal Direction","namespace_type":"single","os_types":[],"tags":["default_rule_exception_list"],"tie_breaker_id":"ad2e5acd-3dea-4a62-a2e2-4dba6c3d03ee","type":"rule_default","updated_at":"2023-06-29T11:19:38.394Z","updated_by":"elastic","version":1}
{"_version":"WzYxMDUsMl0=","comments":[],"created_at":"2023-06-29T11:19:40.625Z","created_by":"elastic","description":"Exception list item","entries":[{"field":"fortinet.firewall.attack","operator":"included","type":"match","value":"Apple.QuickTime.JPEG.2000.Marker.Size.Heap.Overflow"}],"id":"d71c8c10-166e-11ee-ad8e-610914274334","item_id":"2cd21bee-e370-4547-a61a-7d42a2236196","list_id":"d4d8d782-e4b1-48c2-9126-cabee5f2130a","name":"Apple.QuickTime exception","namespace_type":"single","os_types":[],"tags":[],"tie_breaker_id":"b20913b2-fb17-4c43-9e20-efc2fbe5e040","type":"simple","updated_at":"2023-06-29T11:19:40.625Z","updated_by":"elastic"}
{"_version":"Wzg1NiwyXQ==","created_at":"2023-04-13T12:30:29.830Z","created_by":"elastic","description":"Identifies the creation of a Windows service by an unusual client process. Services may be created with administrator privileges but are executed under SYSTEM privileges, so an adversary may also use a service to escalate privileges from administrator to SYSTEM.","id":"fa070660-d9f6-11ed-9bbb-69b1ad2deb7a","immutable":false,"list_id":"cc6dce54-1d5c-4d5c-92d6-6fe44dec55c9","name":"Windows Service Installed via an Unusual Client [Duplicate]","namespace_type":"single","os_types":[],"tags":[],"tie_breaker_id":"64dc698d-800a-492e-a6c2-22863f03f93a","type":"detection","updated_at":"2023-04-13T12:30:29.836Z","updated_by":"elastic","version":1}
{"_version":"Wzg1NSwyXQ==","comments":[],"created_at":"2023-04-13T12:30:48.751Z","created_by":"elastic","description":"Windows Service Installed via an Unusual Client [Duplicate] - exception list item","entries":[{"field":"service.name","operator":"included","type":"match","value":"VeeamVssSupport"}],"id":"054e23f0-d9f7-11ed-9bbb-69b1ad2deb7a","item_id":"12a68645-1774-49e5-868a-3b0215213eb6","list_id":"cc6dce54-1d5c-4d5c-92d6-6fe44dec55c9","name":"Windows Service Installed via an Unusual Client [Duplicate] - exception list item","namespace_type":"single","os_types":[],"tags":[],"tie_breaker_id":"6eee7a16-6693-4941-a51c-7c110b31917c","type":"simple","updated_at":"2023-04-13T12:30:48.755Z","updated_by":"elastic"}
{"_version":"Wzg3NywyXQ==","created_at":"2023-05-18T22:48:33.374Z","created_by":"elastic","description":"Identifies an outbound network connection attempt followed by a session id change as the root user by the same process entity. This particular instantiation of a network connection is abnormal and should be investigated as it may indicate a potential reverse shell activity via a privileged process.","id":"1e0007e0-f5ce-11ed-b363-f33eee164a22","immutable":false,"list_id":"56f6ebbb-62c3-4216-b6c3-80f2c8503593","name":"Suspicious Network Connection Attempt by Root [Duplicate]","namespace_type":"single","os_types":[],"tags":[],"tie_breaker_id":"0d77d6a1-9bd3-4e2a-9654-591bc8ca8fb3","type":"detection","updated_at":"2023-05-18T22:48:33.381Z","updated_by":"elastic","version":1}
{"_version":"Wzg4MCwyXQ==","comments":[],"created_at":"2023-05-18T22:49:12.700Z","created_by":"elastic","description":"Suspicious Network Connection Attempt by Root [Duplicate] - exception list item","entries":[{"field":"process.name","operator":"included","type":"match","value":"redis-cli"}],"id":"3570dad0-f5ce-11ed-b363-f33eee164a22","item_id":"e7760167-2a21-478d-991c-2cd984808604","list_id":"56f6ebbb-62c3-4216-b6c3-80f2c8503593","name":"Suspicious Network Connection Attempt by Root [Duplicate] - exception list item","namespace_type":"single","os_types":[],"tags":[],"tie_breaker_id":"395b36be-c096-4919-bc60-05ee0d65f388","type":"simple","updated_at":"2023-05-18T22:49:12.704Z","updated_by":"elastic"}
{"exported_count":159,"exported_rules_count":147,"missing_rules":[],"missing_rules_count":0,"exported_exception_list_count":7,"exported_exception_list_item_count":5,"missing_exception_list_item_count":0,"missing_exception_list_items":[],"missing_exception_lists":[],"missing_exception_lists_count":0,"exported_action_connector_count":0,"missing_action_connection_count":0,"missing_action_connections":[],"excluded_action_connection_count":0,"excluded_action_connections":[]}
